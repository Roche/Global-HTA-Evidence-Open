<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian FE &amp; RE NMA using piecewise exponential model • gemtcPlus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian FE &amp; RE NMA using piecewise exponential model">
<meta property="og:description" content="gemtcPlus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gemtcPlus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/building-reports.html">Building Reports into the Package</a>
    </li>
    <li>
      <a href="../articles/building-tests.html">Building tests for your functions</a>
    </li>
    <li>
      <a href="../articles/documenting-functions.html">Documenting Functions</a>
    </li>
    <li>
      <a href="../articles/example-nma-binary-data.html">NMA for Binary data (2-arm trials)</a>
    </li>
    <li>
      <a href="../articles/example-nma-groupedTTE-FP-RE.html">Bayesian RE fractional polynomial NMA for grouped survival data</a>
    </li>
    <li>
      <a href="../articles/example-nma-groupedTTE-FP.html">Bayesian FE fractional polynomial NMA for grouped survival data</a>
    </li>
    <li>
      <a href="../articles/example-nma-groupedTTE-PWE.html">Bayesian FE &amp; RE NMA using piecewise exponential model</a>
    </li>
    <li>
      <a href="../articles/example-nma-hr-data.html">Bayesian FE &amp; RE NMA for HR data (via gemtc package) - Result Generation</a>
    </li>
    <li>
      <a href="../articles/general-development-workflow.html">General Development Workflow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example-nma-groupedTTE-PWE_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bayesian FE &amp; RE NMA using piecewise exponential model</h1>
                        <h4 class="author">Sandro Gsteiger</h4>
            
            <h4 class="date">2020-09-18</h4>
      
      
      <div class="hidden name"><code>example-nma-groupedTTE-PWE.Rmd</code></div>

    </div>

    
    
<p><em>“Minimal” example that might serve as template</em></p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This vignette provides a short example of a Bayesian piecewise exponential (PWE) NMA for grouped survival data. The model fit calls jags via the <code>R2jags</code> package. Pre- and post-processing is done with <code>gemtcPlus</code>.</p>
</div>
<div id="prepare-the-environment" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-the-environment" class="anchor"></a>Prepare the environment</h2>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/gertvv/gemtc">gemtc</a></span>)        
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">gemtcPlus</span>)     
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://xavier-fim.net/packages/ggmcmc">ggmcmc</a></span>)       
</pre></div>
</div>
<div id="load-input-data" class="section level1">
<h1 class="hasAnchor">
<a href="#load-input-data" class="anchor"></a>Load input data</h1>
<p>The PWE NMA for grouped survival data requires columns “study”, “treatment”, “t.start” and “t.end” (identifying the time interval), “n.event”, “n.censored”, and “n.risk” (identifying the observed events, numbers of censorings, and patients at risk for the given interval).</p>
<p>The <code>gemtcPlus</code> package contains such an example data set.</p>
<div id="load-in-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-in-the-data" class="anchor"></a>Load in the data</h2>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"grouped_TTE"</span>)
</pre></div>
</div>
<div id="plan-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#plan-the-model" class="anchor"></a>Plan the model</h2>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">model_plan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plan_pwe.html">plan_pwe</a></span>(model.pars = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(cut.pts =  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">10</span>)),
                       bth.model = <span class="st">"FE"</span>, ref.std = <span class="st">"STUDY2"</span>, nma.ref.trt = <span class="st">"B"</span>,
                       n.chains = <span class="fl">2</span>,
                       n.iter = <span class="fl">6000</span>,
                       n.burnin = <span class="fl">1000</span>,
                       n.thin = <span class="fl">1</span>)
</pre></div>
</div>
<div id="ready-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#ready-the-data" class="anchor"></a>Ready the data</h2>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co"># Returns list list contaiing a jags list ready for input to `nma_fit` and a network object</span>
<span class="kw">model_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma_pre_proc.html">nma_pre_proc</a></span>(<span class="kw">grouped_TTE</span>, <span class="kw">model_plan</span>)
</pre></div>
</div>
<div id="fit-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-the-model" class="anchor"></a>Fit the model</h2>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">model</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma_fit.html">nma_fit</a></span>(model_input = <span class="kw">model_input</span>)
</pre></div>
<pre><code>## module glm loaded</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 675
##    Unobserved stochastic nodes: 36
##    Total graph size: 4409
## 
## Initializing model</code></pre>
<p>JAGS summary. Check convergence by inspecting Rhat (should be at least &lt;1.05), and see whether the effective sample size is large enough to allow for inference (rule of thumb: n.eff &gt;1000, though this may be demanding).</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">model</span>
</pre></div>
<pre><code>## Inference for Bugs model at "/private/var/folders/kh/jm6hx9bx0lj7h82xc9tv8rfc0000gn/T/Rtmpxs0fBj/temp_libpath86b5a9da7/gemtcPlus/BUGScode/gsd_piece-wise-cst_fe.txt", fit using jags,
##  2 chains, each with 6000 iterations (first 1000 discarded)
##  n.sims = 10000 iterations saved
##           mu.vect sd.vect     2.5%      25%      50%      75%    97.5%  Rhat
## d[1,1]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000
## d[2,1]     -0.241   0.298   -0.831   -0.441   -0.241   -0.042    0.348 1.001
## d[3,1]     -0.401   0.333   -1.066   -0.623   -0.399   -0.181    0.254 1.001
## d[4,1]      0.956   0.372    0.255    0.708    0.943    1.182    1.765 1.013
## d[5,1]      0.616   0.435   -0.213    0.328    0.601    0.899    1.520 1.010
## d[6,1]     -0.616   0.713   -2.035   -1.081   -0.616   -0.150    0.799 1.003
## d[1,2]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000
## d[2,2]     -0.257   0.142   -0.538   -0.352   -0.259   -0.162    0.025 1.001
## d[3,2]      0.174   0.198   -0.202    0.037    0.175    0.307    0.564 1.004
## d[4,2]      0.171   0.190   -0.201    0.043    0.169    0.300    0.545 1.001
## d[5,2]     -0.099   0.220   -0.534   -0.249   -0.099    0.051    0.336 1.003
## d[6,2]      0.963   0.366    0.258    0.715    0.961    1.211    1.689 1.002
## d[1,3]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000
## d[2,3]      0.003   0.092   -0.176   -0.059    0.002    0.065    0.185 1.002
## d[3,3]      0.033   0.151   -0.266   -0.067    0.033    0.132    0.337 1.005
## d[4,3]      0.088   0.134   -0.178   -0.001    0.089    0.179    0.346 1.001
## d[5,3]      0.050   0.155   -0.255   -0.054    0.051    0.155    0.347 1.001
## d[6,3]     -0.050   0.230   -0.500   -0.203   -0.048    0.105    0.394 1.004
## mu[1,1]    -3.678   0.252   -4.202   -3.843   -3.667   -3.504   -3.216 1.001
## mu[2,1]    -3.611   0.169   -3.948   -3.724   -3.607   -3.496   -3.288 1.002
## mu[3,1]    -3.856   0.196   -4.254   -3.987   -3.851   -3.722   -3.485 1.001
## mu[4,1]    -4.669   0.315   -5.362   -4.863   -4.650   -4.452   -4.102 1.012
## mu[5,1]    -4.568   0.420   -5.471   -4.831   -4.538   -4.276   -3.824 1.002
## mu[6,1]    -4.684   0.240   -5.167   -4.839   -4.676   -4.516   -4.238 1.001
## mu[7,1]    -3.641   0.243   -4.136   -3.801   -3.637   -3.470   -3.185 1.001
## mu[1,2]    -3.720   0.173   -4.066   -3.838   -3.713   -3.599   -3.394 1.001
## mu[2,2]    -3.042   0.092   -3.229   -3.103   -3.041   -2.979   -2.865 1.002
## mu[3,2]    -3.275   0.103   -3.478   -3.344   -3.275   -3.206   -3.072 1.002
## mu[4,2]    -3.682   0.134   -3.956   -3.770   -3.677   -3.591   -3.431 1.001
## mu[5,2]    -4.331   0.252   -4.853   -4.494   -4.322   -4.157   -3.863 1.001
## mu[6,2]    -3.783   0.110   -4.003   -3.857   -3.782   -3.709   -3.573 1.001
## mu[7,2]    -3.698   0.173   -4.039   -3.812   -3.698   -3.579   -3.367 1.003
## mu[1,3]    -3.783   0.129   -4.044   -3.868   -3.781   -3.694   -3.538 1.003
## mu[2,3]    -3.382   0.067   -3.515   -3.427   -3.381   -3.336   -3.254 1.001
## mu[3,3]    -3.498   0.072   -3.642   -3.545   -3.497   -3.450   -3.359 1.001
## mu[4,3]    -3.622   0.093   -3.812   -3.682   -3.621   -3.559   -3.444 1.001
## mu[5,3]    -3.779   0.119   -4.018   -3.860   -3.778   -3.697   -3.548 1.002
## mu[6,3]    -3.715   0.065   -3.844   -3.758   -3.714   -3.671   -3.588 1.001
## mu[7,3]    -3.597   0.131   -3.858   -3.684   -3.596   -3.508   -3.344 1.002
## deviance 2629.317   8.504 2614.625 2623.282 2628.734 2634.664 2647.734 1.002
##          n.eff
## d[1,1]       1
## d[2,1]    6700
## d[3,1]    5400
## d[4,1]     220
## d[5,1]     290
## d[6,1]     700
## d[1,2]       1
## d[2,2]    5400
## d[3,2]     570
## d[4,2]    2700
## d[5,2]     920
## d[6,2]    1800
## d[1,3]       1
## d[2,3]    1500
## d[3,3]     380
## d[4,3]    9500
## d[5,3]    5000
## d[6,3]     500
## mu[1,1]  10000
## mu[2,1]   2400
## mu[3,1]  10000
## mu[4,1]    250
## mu[5,1]   1700
## mu[6,1]   4800
## mu[7,1]   3800
## mu[1,2]   7300
## mu[2,2]   2000
## mu[3,2]   1500
## mu[4,2]  10000
## mu[5,2]  10000
## mu[6,2]  10000
## mu[7,2]    820
## mu[1,3]    660
## mu[2,3]  10000
## mu[3,3]   7300
## mu[4,3]  10000
## mu[5,3]   2500
## mu[6,3]  10000
## mu[7,3]   2000
## deviance   950
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = Dbar-Dhat)
## pD = 36.0 and DIC = 2665.3
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
</div>
<div id="post-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#post-processing" class="anchor"></a>Post processing</h2>
<p>Produce diagnostic plots to further assess convergence. Here: select the contrasts trt 2 vs trt 1 for visibility.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co"># Prepare plot data</span>
<span class="kw">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="fu">as.mcmc</span>(<span class="kw">model</span>)[[<span class="fl">1</span>]])
<span class="kw">sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span>(<span class="st">"d[2,"</span>, <span class="kw">nodes</span>, fixed = <span class="fl">TRUE</span>)
<span class="kw">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html">ggs</a></span>(<span class="fu">as.mcmc</span>(<span class="kw">model</span>)[, <span class="kw">sel</span>])
</pre></div>
<p><strong>Figure</strong> Traceplot</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_traceplot.html">ggs_traceplot</a></span>(<span class="kw">plot_data</span>)
</pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<p><strong>Figure</strong> Densityplot</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_density.html">ggs_density</a></span>(<span class="kw">plot_data</span>)
</pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<p><strong>Figure</strong> Auto-correlation plot</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_autocorrelation.html">ggs_autocorrelation</a></span>(<span class="kw">plot_data</span>)
</pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p><strong>Figure</strong> Running means</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_running.html">ggs_running</a></span>(<span class="kw">plot_data</span>)
</pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>Save the FE results for later use.</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">fixed_effect_model</span> <span class="op">&lt;-</span> <span class="kw">model</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">model</span>)
</pre></div>
<div id="random-effects-model" class="section level3">
<h3 class="hasAnchor">
<a href="#random-effects-model" class="anchor"></a>Random effects model</h3>
<p><strong>Informative prior by Turner et al. LN(-4.2, 1.4^2)</strong> Create a new plan and run-run the fit for the random effects model.</p>
</div>
</div>
<div id="plan-the-model-1" class="section level2">
<h2 class="hasAnchor">
<a href="#plan-the-model-1" class="anchor"></a>Plan the model</h2>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">model_plan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plan_pwe.html">plan_pwe</a></span>(model.pars = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(cut.pts =  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">10</span>)),
                       bth.model = <span class="st">"RE"</span>, ref.std = <span class="st">"STUDY2"</span>, nma.ref.trt = <span class="st">"B"</span>,
                    
                       n.chains = <span class="fl">2</span>,
                       n.iter = <span class="fl">6000</span>,
                       n.burnin = <span class="fl">1000</span>,
                       n.thin = <span class="fl">1</span>,
                       bth.prior = <span class="fu"><a href="../reference/bth_prior.html">bth_prior</a></span>(type = <span class="st">"var"</span>, distr = <span class="st">"ln"</span>, param = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(mean = <span class="fl">1</span>, prec = <span class="fl">1.5</span>)))
</pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="co"># Returns list list contaiing a jags list ready for input to `nma_fit` and a network object</span>
<span class="kw">model_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma_pre_proc.html">nma_pre_proc</a></span>(<span class="kw">grouped_TTE</span>, <span class="kw">model_plan</span>)
</pre></div>
</div>
<div id="fit-the-model-1" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-the-model-1" class="anchor"></a>Fit the model</h2>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">model</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma_fit.html">nma_fit</a></span>(model_input = <span class="kw">model_input</span>)
</pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 675
##    Unobserved stochastic nodes: 58
##    Total graph size: 4477
## 
## Initializing model</code></pre>
<p>JAGS summary. Inspect Rhat and n.eff.</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">model</span>
</pre></div>
<pre><code>## Inference for Bugs model at "/private/var/folders/kh/jm6hx9bx0lj7h82xc9tv8rfc0000gn/T/Rtmpxs0fBj/temp_libpath86b5a9da7/gemtcPlus/BUGScode/gsd_piece-wise-cst_re-var-ln.txt", fit using jags,
##  2 chains, each with 6000 iterations (first 1000 discarded)
##  n.sims = 10000 iterations saved
##           mu.vect sd.vect     2.5%      25%      50%      75%    97.5%  Rhat
## d[1,1]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000
## d[2,1]     -0.273   0.734   -1.747   -0.709   -0.261    0.166    1.181 1.001
## d[3,1]     -0.426   0.754   -1.940   -0.886   -0.410    0.029    1.047 1.002
## d[4,1]      0.927   0.900   -0.903    0.384    0.929    1.464    2.707 1.002
## d[5,1]      0.591   1.103   -1.675   -0.048    0.596    1.244    2.783 1.001
## d[6,1]     -0.635   1.280   -3.213   -1.429   -0.635    0.163    1.863 1.001
## d[1,2]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000
## d[2,2]     -0.261   0.686   -1.652   -0.653   -0.259    0.138    1.123 1.002
## d[3,2]      0.162   0.698   -1.260   -0.241    0.165    0.569    1.585 1.001
## d[4,2]      0.178   0.834   -1.517   -0.306    0.163    0.656    1.869 1.004
## d[5,2]     -0.095   1.027   -2.134   -0.694   -0.114    0.487    2.035 1.003
## d[6,2]      0.959   1.127   -1.383    0.303    0.963    1.629    3.199 1.001
## d[1,3]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000
## d[2,3]     -0.001   0.679   -1.389   -0.392    0.004    0.395    1.346 1.002
## d[3,3]      0.030   0.688   -1.347   -0.362    0.027    0.433    1.428 1.002
## d[4,3]      0.096   0.831   -1.574   -0.375    0.085    0.576    1.808 1.001
## d[5,3]      0.058   1.011   -2.013   -0.520    0.057    0.623    2.115 1.002
## d[6,3]     -0.054   1.094   -2.249   -0.676   -0.058    0.573    2.147 1.002
## mu[1,1]    -3.609   0.257   -4.139   -3.774   -3.600   -3.433   -3.134 1.002
## mu[2,1]    -3.610   0.183   -3.989   -3.726   -3.603   -3.483   -3.267 1.001
## mu[3,1]    -3.869   0.219   -4.325   -4.014   -3.861   -3.715   -3.461 1.002
## mu[4,1]    -4.653   0.307   -5.295   -4.856   -4.637   -4.437   -4.092 1.005
## mu[5,1]    -4.574   0.417   -5.479   -4.833   -4.548   -4.282   -3.842 1.002
## mu[6,1]    -4.617   0.245   -5.122   -4.774   -4.612   -4.451   -4.158 1.001
## mu[7,1]    -3.721   0.273   -4.290   -3.901   -3.711   -3.530   -3.225 1.002
## mu[1,2]    -3.718   0.198   -4.121   -3.848   -3.713   -3.582   -3.350 1.002
## mu[2,2]    -3.045   0.104   -3.255   -3.115   -3.043   -2.973   -2.848 1.003
## mu[3,2]    -3.272   0.115   -3.504   -3.348   -3.269   -3.192   -3.055 1.001
## mu[4,2]    -3.680   0.130   -3.945   -3.765   -3.678   -3.588   -3.434 1.001
## mu[5,2]    -4.342   0.257   -4.878   -4.507   -4.332   -4.165   -3.863 1.003
## mu[6,2]    -3.777   0.113   -4.004   -3.852   -3.775   -3.699   -3.564 1.001
## mu[7,2]    -3.704   0.199   -4.120   -3.830   -3.698   -3.569   -3.332 1.001
## mu[1,3]    -3.776   0.147   -4.071   -3.873   -3.771   -3.673   -3.502 1.002
## mu[2,3]    -3.382   0.076   -3.535   -3.434   -3.380   -3.331   -3.234 1.002
## mu[3,3]    -3.495   0.085   -3.666   -3.551   -3.492   -3.435   -3.331 1.004
## mu[4,3]    -3.626   0.092   -3.812   -3.688   -3.624   -3.562   -3.452 1.003
## mu[5,3]    -3.779   0.115   -4.013   -3.856   -3.776   -3.700   -3.560 1.001
## mu[6,3]    -3.716   0.064   -3.843   -3.760   -3.716   -3.673   -3.590 1.001
## mu[7,3]    -3.603   0.152   -3.912   -3.704   -3.601   -3.500   -3.313 1.002
## sd          0.759   0.301    0.340    0.542    0.703    0.915    1.495 1.003
## deviance 2633.656   9.005 2617.935 2627.314 2632.974 2639.345 2652.835 1.001
##          n.eff
## d[1,1]       1
## d[2,1]   10000
## d[3,1]   10000
## d[4,1]    1700
## d[5,1]   10000
## d[6,1]    3800
## d[1,2]       1
## d[2,2]   10000
## d[3,2]   10000
## d[4,2]    2400
## d[5,2]    4800
## d[6,2]    5900
## d[1,3]       1
## d[2,3]    2100
## d[3,3]    1500
## d[4,3]    9600
## d[5,3]   10000
## d[6,3]    2000
## mu[1,1]   1800
## mu[2,1]  10000
## mu[3,1]   1200
## mu[4,1]    340
## mu[5,1]   1100
## mu[6,1]   4100
## mu[7,1]   1000
## mu[1,2]   2300
## mu[2,2]    630
## mu[3,2]   2700
## mu[4,2]  10000
## mu[5,2]    840
## mu[6,2]  10000
## mu[7,2]  10000
## mu[1,3]   2000
## mu[2,3]   1400
## mu[3,3]    520
## mu[4,3]    810
## mu[5,3]  10000
## mu[6,3]   4400
## mu[7,3]   1500
## sd         700
## deviance 10000
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = Dbar-Dhat)
## pD = 41.2 and DIC = 2675.0
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
</div>
<div id="post-processing-1" class="section level2">
<h2 class="hasAnchor">
<a href="#post-processing-1" class="anchor"></a>Post processing</h2>
<p>Produce diagnostic plots to further assess convergence. Here, let’s select the random effects standard deviation. <strong>Figure</strong> Traceplot</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_traceplot.html">ggs_traceplot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html">ggs</a></span>(<span class="fu">as.mcmc</span>(<span class="kw">model</span>), family = <span class="st">"sd"</span>))
</pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-17-1.png" width="576"></p>
<p><strong>Figure</strong> Densityplot</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_density.html">ggs_density</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html">ggs</a></span>(<span class="fu">as.mcmc</span>(<span class="kw">model</span>), family = <span class="st">"sd"</span>))
</pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
<p>Save the FE results for later use.</p>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="kw">random_effects_model</span> <span class="op">&lt;-</span> <span class="kw">model</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">model</span>)
</pre></div>
</div>
</div>
<div id="produce-outputs-of-interest" class="section level1">
<h1 class="hasAnchor">
<a href="#produce-outputs-of-interest" class="anchor"></a>Produce outputs of interest</h1>
<p>Start with an object collecting all fits done.</p>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="kw">all_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">fixed_effect_model</span>, <span class="kw">random_effects_model</span>)
</pre></div>
<div id="model-comparison" class="section level2">
<h2 class="hasAnchor">
<a href="#model-comparison" class="anchor"></a>Model comparison</h2>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="kw">dcompare</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pwe_comparison.html">get_pwe_comparison</a></span>(<span class="kw">all_res</span>)
<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw">dcompare</span>, caption = <span class="st">"__Table__ Model comparison"</span>)
</pre></div>
<table class="table">
<caption>
<strong>Table</strong> Model comparison</caption>
<thead><tr class="header">
<th align="left">Model</th>
<th align="left">CutPoints</th>
<th align="left">DIC</th>
<th align="left">pD</th>
<th align="left">meanDev</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PWE</td>
<td align="left">3, 10</td>
<td align="left">2665.3</td>
<td align="left">36</td>
<td align="left">2629.3</td>
</tr>
<tr class="even">
<td align="left">PWE</td>
<td align="left">3, 10</td>
<td align="left">2675</td>
<td align="left">41.2</td>
<td align="left">2633.7</td>
</tr>
</tbody>
</table>
</div>
<div id="hazard-ratio-estimates" class="section level2">
<h2 class="hasAnchor">
<a href="#hazard-ratio-estimates" class="anchor"></a>Hazard ratio estimates</h2>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="co"># loop through fits</span>
<span class="co">for</span>(<span class="kw">i</span> <span class="co">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="kw">all_res</span>)){
  <span class="kw">res_i</span> <span class="op">&lt;-</span> <span class="kw">all_res</span>[[<span class="kw">i</span>]]
  <span class="kw">title</span> <span class="op">&lt;-</span> <span class="kw">res_i</span><span class="op">$</span><span class="kw">descr</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"### "</span>, <span class="kw">title</span>, <span class="st">"  \n"</span>)
  
  <span class="co">## Tables: Hazard ratio estimates for each segment</span>
  <span class="kw">HR_rev</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pwe_contrasts.html">get_pwe_contrasts</a></span>(fit = <span class="kw">res_i</span>, 
                             ref = <span class="st">"A"</span>,  
                             digits = <span class="fl">3</span>,
                             exponentiate = <span class="fl">TRUE</span>, 
                             reverse = <span class="fl">TRUE</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw">HR_rev</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span><span class="kw">x</span>, <span class="op">-</span><span class="kw">xend</span>), caption = <span class="st">"__Table__ Hazard ratio estimates of A vs other treatments"</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"\n\n"</span>)

  
  <span class="co">## Graphs (needs the HR data calculated above)</span>
  <span class="kw">ymax</span> <span class="op">&lt;-</span> <span class="fl">10</span>
  <span class="kw">dhr</span> <span class="op">&lt;-</span> <span class="kw">HR_rev</span>
  <span class="kw">drib</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(x = <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw">dhr</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"x"</span>, <span class="st">"xend"</span>)])),           <span class="co"># data structure for ribbons</span>
                     ylo = <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw">dhr</span><span class="op">$</span><span class="kw">lCrI</span>, each = <span class="fl">2</span>),                   <span class="co">#  cap ribbon at ymax</span>
                     yup = <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw">dhr</span><span class="op">$</span><span class="kw">uCrI</span>, each = <span class="fl">2</span>),
                     Comparison = <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw">dhr</span><span class="op">$</span><span class="kw">Comparison</span>, each = <span class="fl">2</span>)) <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(yup = <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">yup</span> <span class="op">&gt;</span> <span class="kw">ymax</span>, <span class="kw">ymax</span>, <span class="kw">yup</span>))

  <span class="kw">fig</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span>(data = <span class="kw">dhr</span>) <span class="op">+</span> 
    <span class="fu">geom_ribbon</span>(data = <span class="kw">drib</span>, <span class="fu">aes</span>(x = <span class="kw">x</span>, ymin = <span class="kw">ylo</span>, ymax = <span class="kw">yup</span>), fill = <span class="st">"lightblue"</span>, alpha = <span class="fl">0.8</span>) <span class="op">+</span>
    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(yintercept = <span class="fl">1</span>), col = <span class="st">"darkgrey"</span>) <span class="op">+</span>
    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(x = <span class="kw">x</span>, xend = <span class="kw">xend</span>, y = <span class="kw">Median</span>, yend = <span class="kw">Median</span>)) <span class="op">+</span>
    <span class="fu">facet_wrap</span>(<span class="op">~</span><span class="kw">Comparison</span>, ncol = <span class="fl">2</span>) <span class="op">+</span>
    <span class="fu">scale_y_log10</span>(breaks = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">10</span>)) <span class="op">+</span>
    <span class="fu">coord_cartesian</span>(ylim = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="kw">ymax</span>)) <span class="op">+</span>
    <span class="fu">xlab</span>(<span class="st">"Month"</span>) <span class="op">+</span> <span class="fu">ylab</span>(<span class="st">"Hazard ratio"</span>) <span class="op">+</span>
    <span class="fu">theme_bw</span>()
  
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"__Figure__ Hazard ratio estimates A vs other treatments\n"</span>)
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">fig</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"\n\n"</span>)
  
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">res_i</span>)
}
</pre></div>
<div id="piecewise-exponential-model" class="section level3">
<h3 class="hasAnchor">
<a href="#piecewise-exponential-model" class="anchor"></a>Piecewise Exponential model</h3>
<table class="table">
<caption>
<strong>Table</strong> Hazard ratio estimates of A vs other treatments</caption>
<thead><tr class="header">
<th align="left">Comparison</th>
<th align="left">Segment</th>
<th align="right">Median</th>
<th align="right">lCrI</th>
<th align="right">uCrI</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A vs B</td>
<td align="left">[0,3)</td>
<td align="right">0.786</td>
<td align="right">0.436</td>
<td align="right">1.416</td>
</tr>
<tr class="even">
<td align="left">A vs B</td>
<td align="left">[3,10)</td>
<td align="right">0.772</td>
<td align="right">0.584</td>
<td align="right">1.026</td>
</tr>
<tr class="odd">
<td align="left">A vs B</td>
<td align="left">[10,Inf)</td>
<td align="right">1.002</td>
<td align="right">0.839</td>
<td align="right">1.204</td>
</tr>
<tr class="even">
<td align="left">A vs C</td>
<td align="left">[0,3)</td>
<td align="right">1.175</td>
<td align="right">0.630</td>
<td align="right">2.174</td>
</tr>
<tr class="odd">
<td align="left">A vs C</td>
<td align="left">[3,10)</td>
<td align="right">0.650</td>
<td align="right">0.441</td>
<td align="right">0.957</td>
</tr>
<tr class="even">
<td align="left">A vs C</td>
<td align="left">[10,Inf)</td>
<td align="right">0.971</td>
<td align="right">0.717</td>
<td align="right">1.313</td>
</tr>
<tr class="odd">
<td align="left">A vs D</td>
<td align="left">[0,3)</td>
<td align="right">0.303</td>
<td align="right">0.117</td>
<td align="right">0.757</td>
</tr>
<tr class="even">
<td align="left">A vs D</td>
<td align="left">[3,10)</td>
<td align="right">0.653</td>
<td align="right">0.406</td>
<td align="right">1.031</td>
</tr>
<tr class="odd">
<td align="left">A vs D</td>
<td align="left">[10,Inf)</td>
<td align="right">0.918</td>
<td align="right">0.666</td>
<td align="right">1.267</td>
</tr>
<tr class="even">
<td align="left">A vs E</td>
<td align="left">[0,3)</td>
<td align="right">0.428</td>
<td align="right">0.150</td>
<td align="right">1.198</td>
</tr>
<tr class="odd">
<td align="left">A vs E</td>
<td align="left">[3,10)</td>
<td align="right">0.855</td>
<td align="right">0.514</td>
<td align="right">1.421</td>
</tr>
<tr class="even">
<td align="left">A vs E</td>
<td align="left">[10,Inf)</td>
<td align="right">0.953</td>
<td align="right">0.673</td>
<td align="right">1.362</td>
</tr>
<tr class="odd">
<td align="left">A vs F</td>
<td align="left">[0,3)</td>
<td align="right">1.445</td>
<td align="right">0.368</td>
<td align="right">5.822</td>
</tr>
<tr class="even">
<td align="left">A vs F</td>
<td align="left">[3,10)</td>
<td align="right">0.296</td>
<td align="right">0.144</td>
<td align="right">0.596</td>
</tr>
<tr class="odd">
<td align="left">A vs F</td>
<td align="left">[10,Inf)</td>
<td align="right">1.052</td>
<td align="right">0.672</td>
<td align="right">1.660</td>
</tr>
</tbody>
</table>
<p><strong>Figure</strong> Hazard ratio estimates A vs other treatments <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-22-1.png" width="576"></p>
</div>
<div id="piecewise-exponential-model-1" class="section level3">
<h3 class="hasAnchor">
<a href="#piecewise-exponential-model-1" class="anchor"></a>Piecewise Exponential model</h3>
<table class="table">
<caption>
<strong>Table</strong> Hazard ratio estimates of A vs other treatments</caption>
<thead><tr class="header">
<th align="left">Comparison</th>
<th align="left">Segment</th>
<th align="right">Median</th>
<th align="right">lCrI</th>
<th align="right">uCrI</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A vs B</td>
<td align="left">[0,3)</td>
<td align="right">0.771</td>
<td align="right">0.174</td>
<td align="right">3.257</td>
</tr>
<tr class="even">
<td align="left">A vs B</td>
<td align="left">[3,10)</td>
<td align="right">0.772</td>
<td align="right">0.192</td>
<td align="right">3.073</td>
</tr>
<tr class="odd">
<td align="left">A vs B</td>
<td align="left">[10,Inf)</td>
<td align="right">1.004</td>
<td align="right">0.249</td>
<td align="right">3.841</td>
</tr>
<tr class="even">
<td align="left">A vs C</td>
<td align="left">[0,3)</td>
<td align="right">1.190</td>
<td align="right">0.261</td>
<td align="right">5.025</td>
</tr>
<tr class="odd">
<td align="left">A vs C</td>
<td align="left">[3,10)</td>
<td align="right">0.651</td>
<td align="right">0.160</td>
<td align="right">2.734</td>
</tr>
<tr class="even">
<td align="left">A vs C</td>
<td align="left">[10,Inf)</td>
<td align="right">0.970</td>
<td align="right">0.239</td>
<td align="right">3.918</td>
</tr>
<tr class="odd">
<td align="left">A vs D</td>
<td align="left">[0,3)</td>
<td align="right">0.305</td>
<td align="right">0.028</td>
<td align="right">3.029</td>
</tr>
<tr class="even">
<td align="left">A vs D</td>
<td align="left">[3,10)</td>
<td align="right">0.653</td>
<td align="right">0.072</td>
<td align="right">5.682</td>
</tr>
<tr class="odd">
<td align="left">A vs D</td>
<td align="left">[10,Inf)</td>
<td align="right">0.905</td>
<td align="right">0.105</td>
<td align="right">7.930</td>
</tr>
<tr class="even">
<td align="left">A vs E</td>
<td align="left">[0,3)</td>
<td align="right">0.420</td>
<td align="right">0.029</td>
<td align="right">6.013</td>
</tr>
<tr class="odd">
<td align="left">A vs E</td>
<td align="left">[3,10)</td>
<td align="right">0.863</td>
<td align="right">0.068</td>
<td align="right">9.486</td>
</tr>
<tr class="even">
<td align="left">A vs E</td>
<td align="left">[10,Inf)</td>
<td align="right">0.943</td>
<td align="right">0.079</td>
<td align="right">10.624</td>
</tr>
<tr class="odd">
<td align="left">A vs F</td>
<td align="left">[0,3)</td>
<td align="right">1.428</td>
<td align="right">0.110</td>
<td align="right">18.665</td>
</tr>
<tr class="even">
<td align="left">A vs F</td>
<td align="left">[3,10)</td>
<td align="right">0.295</td>
<td align="right">0.031</td>
<td align="right">2.988</td>
</tr>
<tr class="odd">
<td align="left">A vs F</td>
<td align="left">[10,Inf)</td>
<td align="right">1.054</td>
<td align="right">0.117</td>
<td align="right">9.603</td>
</tr>
</tbody>
</table>
<p><strong>Figure</strong> Hazard ratio estimates A vs other treatments <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-22-2.png" width="576"></p>
</div>
</div>
<div id="survivor-function-estimates" class="section level2">
<h2 class="hasAnchor">
<a href="#survivor-function-estimates" class="anchor"></a>Survivor function estimates</h2>
<p>The NMA baseline estimate from the <code>ref_trt</code> arm from <code>ref_std</code> is used. The contrast estimates from the NMA are then added to obtain the survivor functions for the other interventions.</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="kw">ref_trt</span> <span class="op">&lt;-</span> <span class="st">"B"</span>
<span class="kw">ref_std</span> <span class="op">&lt;-</span> <span class="st">"STUDY2"</span>
<span class="kw">hor</span> <span class="op">&lt;-</span> <span class="fl">60</span>

<span class="co"># loop through fits</span>
<span class="co">for</span>(<span class="kw">i</span> <span class="co">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="kw">all_res</span>)){
  <span class="kw">res_i</span> <span class="op">&lt;-</span> <span class="kw">all_res</span>[[<span class="kw">i</span>]]
  <span class="kw">title</span> <span class="op">&lt;-</span> <span class="kw">res_i</span><span class="op">$</span><span class="kw">descr</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"### "</span>, <span class="kw">title</span>, <span class="st">"  \n"</span>)
  
  <span class="co">## Plots of survivor functions over time ("NMA result"), ref study/arm and timehorizons specified in settings function</span>
  <span class="kw">sel_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="kw">res_i</span><span class="op">$</span><span class="kw">data.jg</span>, <span class="st">"d_arms"</span>)<span class="op">$</span><span class="kw">study</span> <span class="op">==</span> <span class="kw">ref_std</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="kw">res_i</span><span class="op">$</span><span class="kw">data.jg</span>, <span class="st">"d_arms"</span>)<span class="op">$</span><span class="kw">treatment</span> <span class="op">==</span> <span class="kw">ref_trt</span>)
  <span class="kw">id_ref_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="kw">res_i</span><span class="op">$</span><span class="kw">data.jg</span>, <span class="st">"d_arms"</span>)<span class="op">$</span><span class="kw">studyn</span>[<span class="kw">sel_ref</span>]
  <span class="kw">id_ref_arm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="kw">res_i</span><span class="op">$</span><span class="kw">data.jg</span>, <span class="st">"d_arms"</span>)<span class="op">$</span><span class="kw">arm</span>[<span class="kw">sel_ref</span>]

  <span class="kw">S_extrap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pwe_S.html">get_pwe_S</a></span>(fit = <span class="kw">res_i</span>,  
                        ref.std = <span class="kw">id_ref_std</span>, 
                        ref.arm = <span class="kw">id_ref_arm</span>,  
                        time = <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="kw">hor</span>, <span class="fl">0.1</span>))
  
  <span class="kw">fig</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span>(data = <span class="kw">S_extrap</span>) <span class="op">+</span>        
    <span class="fu">geom_line</span>(<span class="fu">aes</span>(x = <span class="kw">time</span>, y = <span class="kw">S</span>, col = <span class="kw">treatment</span>, linetype = <span class="kw">treatment</span>)) <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">1</span>) <span class="op">+</span>
    <span class="fu">xlab</span>(<span class="st">"Month"</span>) <span class="op">+</span> <span class="fu">ylab</span>(<span class="st">"Survival probability"</span>) <span class="op">+</span>
    <span class="fu">theme_bw</span>() <span class="op">+</span>
    <span class="fu">theme</span>(legend.title = <span class="fu">element_blank</span>())
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"__Figure__ Survivor function estimates (time horizon:"</span>, <span class="kw">hor</span>, <span class="st">"months) \n"</span>)
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">fig</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"\n\n"</span>)
  
  <span class="kw">fig</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span>(data = <span class="kw">S_extrap</span>) <span class="op">+</span> 
    <span class="fu">facet_wrap</span>(<span class="op">~</span><span class="kw">treatment</span>) <span class="op">+</span>
    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(x = <span class="kw">time</span>, ymin = <span class="kw">lCrI</span>, ymax = <span class="kw">uCrI</span>), fill = <span class="st">"lightblue"</span>, alpha = <span class="fl">0.8</span>) <span class="op">+</span>
    <span class="fu">geom_line</span>(<span class="fu">aes</span>(x = <span class="kw">time</span>, y = <span class="kw">S</span>)) <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">1</span>) <span class="op">+</span>
    <span class="fu">xlab</span>(<span class="st">"Month"</span>) <span class="op">+</span> <span class="fu">ylab</span>(<span class="st">"Survival probability"</span>) <span class="op">+</span>
    <span class="fu">theme_bw</span>()
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"__Figure__ Survivor function estimates by treatment (time horizon:"</span>, <span class="kw">hor</span>, <span class="st">"months) \n"</span>)
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">fig</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"\n\n"</span>)
  
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(list = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"S_extrap"</span>, <span class="st">"fig"</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">res_i</span>)
}
</pre></div>
<div id="piecewise-exponential-model-2" class="section level3">
<h3 class="hasAnchor">
<a href="#piecewise-exponential-model-2" class="anchor"></a>Piecewise Exponential model</h3>
<p><strong>Figure</strong> Survivor function estimates (time horizon: 60 months) <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-23-1.png" width="576"></p>
<p><strong>Figure</strong> Survivor function estimates by treatment (time horizon: 60 months) <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-23-2.png" width="576"></p>
</div>
<div id="piecewise-exponential-model-3" class="section level3">
<h3 class="hasAnchor">
<a href="#piecewise-exponential-model-3" class="anchor"></a>Piecewise Exponential model</h3>
<p><strong>Figure</strong> Survivor function estimates (time horizon: 60 months) <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-23-3.png" width="576"></p>
<p><strong>Figure</strong> Survivor function estimates by treatment (time horizon: 60 months) <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-23-4.png" width="576"></p>
</div>
</div>
<div id="model-fit-observed-km-data-vs-estimated-st" class="section level2">
<h2 class="hasAnchor">
<a href="#model-fit-observed-km-data-vs-estimated-st" class="anchor"></a>Model fit: observed KM data vs estimated S(t)</h2>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="co"># loop through fits</span>
<span class="co">for</span>(<span class="kw">i</span> <span class="co">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="kw">all_res</span>)){
  <span class="kw">res_i</span> <span class="op">&lt;-</span> <span class="kw">all_res</span>[[<span class="kw">i</span>]]
  <span class="kw">title</span> <span class="op">&lt;-</span> <span class="kw">res_i</span><span class="op">$</span><span class="kw">descr</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"### "</span>, <span class="kw">title</span>, <span class="st">"  \n"</span>)

  <span class="kw">gof</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pwe_GoF.html">get_pwe_GoF</a></span>(fit = <span class="kw">res_i</span>, 
                     data.arms = <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="kw">res_i</span><span class="op">$</span><span class="kw">data.jg</span>, <span class="st">"d_arms"</span>),
                     data.jg = <span class="kw">res_i</span><span class="op">$</span><span class="kw">data.jg</span>)
   
  <span class="kw">fig</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span>() <span class="op">+</span> 
    <span class="fu">geom_line</span>(data = <span class="kw">gof</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">type</span> <span class="op">==</span> <span class="st">"nma"</span>), <span class="fu">aes</span>(x = <span class="kw">time</span>, y = <span class="kw">S</span>, col = <span class="kw">treatment</span>)) <span class="op">+</span>
    <span class="fu">geom_line</span>(data = <span class="kw">gof</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">type</span> <span class="op">==</span> <span class="st">"obs"</span>), <span class="fu">aes</span>(x = <span class="kw">time</span>, y = <span class="kw">S</span>, col = <span class="kw">treatment</span>), linetype = <span class="st">"dashed"</span>) <span class="op">+</span>
    <span class="fu">facet_wrap</span>(<span class="op">~</span><span class="kw">study</span>, ncol = <span class="fl">2</span>) <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">1</span>) <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span>(<span class="fl">0</span>, <span class="fl">36</span>) <span class="op">+</span>
    <span class="fu">xlab</span>(<span class="st">"Month"</span>) <span class="op">+</span> <span class="fu">ylab</span>(<span class="st">"Survival probability"</span>) <span class="op">+</span>
    <span class="fu">theme_bw</span>() <span class="op">+</span>
    <span class="fu">theme</span>(legend.position = <span class="st">"top"</span>, legend.title = <span class="fu">element_blank</span>())

  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"__Figure__ Goodness-of-fit: estimated (solid lines) and observed (dashed) survivor functions for each study\n"</span>)
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">fig</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"\n\n"</span>)
  
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(list = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"gof"</span>, <span class="st">"fig"</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">out</span>)
}  
</pre></div>
<div id="piecewise-exponential-model-4" class="section level3">
<h3 class="hasAnchor">
<a href="#piecewise-exponential-model-4" class="anchor"></a>Piecewise Exponential model</h3>
<p><strong>Figure</strong> Goodness-of-fit: estimated (solid lines) and observed (dashed) survivor functions for each study <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-24-1.png" width="576"></p>
</div>
<div id="piecewise-exponential-model-5" class="section level3">
<h3 class="hasAnchor">
<a href="#piecewise-exponential-model-5" class="anchor"></a>Piecewise Exponential model</h3>
<p><strong>Figure</strong> Goodness-of-fit: estimated (solid lines) and observed (dashed) survivor functions for each study <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-24-2.png" width="576"></p>
</div>
</div>
</div>
<div id="appendix" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix" class="anchor"></a>Appendix</h1>
<div class="sourceCode" id="cb30"><pre class="downlit">
<span class="co"># loop through fits</span>
<span class="co">for</span>(<span class="kw">i</span> <span class="co">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="kw">all_res</span>)){
  <span class="kw">res_i</span> <span class="op">&lt;-</span> <span class="kw">all_res</span>[[<span class="kw">i</span>]]
  <span class="kw">title</span> <span class="op">&lt;-</span> <span class="kw">res_i</span><span class="op">$</span><span class="kw">descr</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"## "</span>, <span class="kw">title</span>, <span class="st">"  \n\n"</span>)

  <span class="kw">jginfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_jags_info.html">get_jags_info</a></span>(<span class="kw">res_i</span>, include.comments = <span class="fl">TRUE</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"```\n"</span>, <span class="kw">jginfo</span>, <span class="st">"\n```\n\n"</span>)
  
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">jginfo</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">out</span>)
}  
</pre></div>
<div id="piecewise-exponential-model-6" class="section level2">
<h2 class="hasAnchor">
<a href="#piecewise-exponential-model-6" class="anchor"></a>Piecewise Exponential model</h2>
<pre><code> ##############################################
# DATA                                       #
##############################################
list(
 Na  =  c(2, 2, 2, 2, 2, 2, 2) ,
 Ncuts  =  2 ,
 Nobs  =  675 ,
 Ns  =  7 ,
 Ntrt  =  6 ,
 a  =  c(2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2) ,
 dt  =  c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1) ,
 feprior_mean  =  0 ,
 feprior_prec  =  1e-04 ,
 n  =  c(182, 177, 172, 164, 155, 148, 143, 138, 132, 128, 125, 120, 117, 110, 108, 106, 101, 98, 96, 90, 87, 83, 79, 75, 70, 66, 59, 56, 53, 50, 47, 45, 39, 37, 34, 32, 31, 26, 25, 24, 23, 21, 19, 16, 14, 13, 11, 10, 8, 6, 5, 3, 1, 183, 179, 172, 159, 152, 147, 139, 133, 131, 124, 119, 115, 110, 104, 101, 95, 93, 92, 88, 83, 80, 76, 73, 68, 62, 59, 53, 50, 43, 40, 37, 35, 33, 31, 30, 29, 26, 24, 22, 19, 18, 18, 18, 18, 17, 17, 15, 14, 12, 10, 8, 4, 2, 322, 319, 309, 301, 288, 277, 262, 255, 248, 238, 229, 
226, 216, 206, 200, 195, 189, 183, 176, 171, 163, 160, 150, 148, 142, 136, 130, 127, 121, 116, 113, 112, 108, 105, 101, 101, 96, 95, 91, 89, 86, 84, 327, 324, 318, 307, 297, 283, 275, 263, 256, 248, 241, 235, 225, 217, 212, 201, 194, 184, 178, 169, 161, 156, 149, 142, 134, 131, 125, 117, 115, 107, 101, 96, 93, 89, 83, 79, 76, 74, 70, 68, 65, 63, 375, 374, 368, 360, 352, 339, 326, 319, 315, 308, 295, 289, 283, 271, 262, 259, 247, 238, 229, 225, 213, 203, 197, 190, 180, 161, 135, 121, 98, 78, 61, 55, 
52, 45, 39, 35, 375, 372, 356, 338, 319, 308, 295, 282, 276, 269, 260, 251, 242, 228, 221, 210, 203, 200, 187, 180, 172, 168, 161, 155, 149, 132, 115, 104, 82, 66, 53, 48, 43, 39, 34, 30, 181, 181, 180, 176, 172, 169, 167, 158, 153, 145, 143, 141, 137, 133, 129, 126, 123, 121, 118, 113, 112, 108, 105, 101, 99, 99, 98, 95, 92, 90, 88, 87, 86, 83, 82, 82, 78, 78, 78, 78, 181, 179, 176, 175, 173, 172, 169, 166, 165, 164, 159, 155, 150, 144, 140, 135, 132, 132, 132, 129, 127, 126, 123, 121, 116, 109, 
107, 105, 105, 104, 101, 97, 94, 93, 93, 90, 557, 552, 541, 532, 521, 505, 487, 473, 462, 452, 436, 423, 409, 388, 377, 368, 357, 348, 338, 328, 320, 312, 305, 295, 280, 273, 262, 255, 243, 235, 230, 226, 219, 215, 208, 204, 197, 184, 171, 156, 147, 147, 114, 114, 99, 99, 80, 77, 57, 48, 38, 27, 21, 20, 17, 14, 8, 6, 6, 1, 1, 553, 544, 530, 518, 501, 480, 468, 448, 435, 420, 406, 387, 377, 366, 354, 348, 339, 329, 321, 315, 304, 295, 283, 280, 272, 263, 254, 247, 237, 230, 224, 218, 212, 203, 192, 
187, 180, 174, 162, 149, 138, 131, 120, 111, 100, 92, 80, 63, 56, 48, 38, 31, 20, 17, 14, 11, 9, 7, 5, 5, 1, 189, 184, 178, 166, 156, 144, 138, 131, 123, 117, 111, 106, 103, 98, 93, 88, 85, 79, 74, 68, 64, 59, 55, 50, 46, 43, 40, 37, 35, 31, 28, 26, 25, 20, 19, 15, 15, 12, 10, 9, 9, 3, 3, 3, 3, 188, 179, 175, 167, 159, 151, 141, 136, 131, 127, 123, 117, 112, 106, 101, 96, 94, 88, 84, 77, 70, 64, 57, 52, 44, 39, 39, 30, 30, 26, 23, 21, 20, 16, 16, 12, 11, 11, 10, 8, 7, 4, 4, 2, 2, 2, 363, 360, 344, 
332, 314, 305, 286, 269, 261, 248, 236, 226, 220, 214, 199, 197, 188, 180, 177, 168, 162, 155, 151, 150, 148, 144, 140, 136, 128, 122, 118, 116, 113, 113, 109, 105, 98, 94, 87, 83, 75, 69, 64, 57, 53, 49, 46, 40, 37, 31, 25, 22, 18, 14, 10, 9, 7, 6, 3, 2, 1, 369, 366, 358, 347, 333, 322, 314, 302, 294, 277, 267, 254, 240, 236, 225, 218, 210, 197, 190, 179, 179, 173, 166, 163, 160, 154, 152, 148, 145, 143, 139, 136, 127, 123, 119, 118, 116, 112, 109, 106, 102, 99, 94, 85, 74, 66, 58, 50, 42, 35, 31, 
28, 25, 20, 17, 15, 13, 11, 6, 3, 2, 1, 1) ,
 r  =  c(2, 2, 4, 6, 4, 5, 4, 4, 4, 2, 5, 1, 7, 1, 1, 3, 1, 0, 3, 2, 1, 3, 2, 2, 2, 3, 1, 0, 0, 0, 1, 4, 1, 1, 1, 0, 4, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 4, 10, 4, 2, 6, 4, 0, 5, 3, 3, 3, 5, 1, 5, 1, 0, 3, 3, 3, 0, 0, 2, 2, 0, 3, 1, 3, 0, 1, 2, 0, 0, 0, 0, 2, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 3, 10, 7, 13, 10, 15, 7, 7, 9, 9, 3, 9, 10, 5, 5, 6, 5, 7, 5, 7, 3, 10, 1, 6, 6, 5, 3, 5, 5, 3, 0, 4, 3, 3, 0, 4, 1, 4, 1, 3, 2, 3, 2, 4, 9, 8, 12, 7, 11, 5, 7, 5, 4, 8, 7, 2, 10, 
6, 8, 4, 8, 6, 3, 5, 5, 6, 2, 5, 5, 1, 6, 5, 3, 1, 2, 5, 2, 1, 1, 2, 1, 1, 0, 0, 0, 5, 6, 7, 11, 12, 7, 3, 6, 12, 5, 6, 11, 8, 1, 11, 8, 8, 3, 10, 9, 4, 5, 9, 2, 6, 3, 2, 1, 2, 1, 0, 3, 0, 0, 0, 0, 13, 14, 15, 7, 10, 12, 5, 6, 7, 8, 8, 14, 7, 10, 7, 3, 13, 5, 5, 2, 4, 4, 3, 3, 1, 2, 5, 1, 1, 0, 2, 0, 0, 0, 0, 0, 1, 4, 4, 3, 2, 9, 5, 8, 2, 2, 4, 4, 4, 3, 3, 2, 3, 5, 1, 4, 3, 4, 2, 0, 1, 3, 3, 2, 2, 1, 1, 3, 1, 0, 4, 0, 0, 0, 0, 2, 3, 1, 2, 1, 3, 3, 1, 1, 5, 4, 5, 6, 4, 5, 3, 0, 0, 3, 2, 1, 3, 2, 5, 
7, 2, 2, 0, 1, 3, 4, 3, 1, 0, 3, 2, 3, 8, 6, 9, 14, 15, 10, 9, 8, 13, 11, 12, 21, 9, 8, 11, 9, 10, 9, 8, 6, 4, 6, 12, 4, 8, 4, 10, 6, 3, 1, 4, 2, 3, 2, 5, 5, 4, 6, 1, 0, 0, 0, 15, 0, 0, 3, 4, 1, 0, 0, 1, 0, 2, 0, 4, 0, 0, 0, 0, 0, 4, 8, 6, 12, 19, 9, 17, 11, 15, 12, 18, 10, 11, 11, 5, 9, 9, 6, 4, 10, 7, 9, 0, 5, 6, 6, 5, 7, 5, 5, 4, 3, 8, 9, 2, 6, 0, 5, 7, 3, 0, 3, 3, 6, 0, 3, 5, 1, 0, 0, 0, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 2, 2, 10, 7, 8, 3, 6, 4, 5, 4, 4, 0, 3, 3, 1, 1, 4, 3, 2, 2, 2, 2, 1, 1, 2, 
2, 0, 1, 3, 2, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 6, 2, 5, 5, 3, 8, 2, 4, 1, 2, 4, 3, 4, 4, 0, 2, 0, 3, 4, 1, 1, 0, 2, 3, 3, 0, 0, 0, 2, 0, 1, 1, 0, 0, 2, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 3, 15, 11, 18, 8, 19, 17, 8, 13, 11, 10, 6, 6, 15, 2, 8, 8, 3, 9, 6, 7, 4, 1, 2, 4, 4, 3, 8, 6, 4, 2, 3, 0, 4, 4, 7, 2, 4, 2, 4, 4, 3, 4, 1, 0, 0, 3, 0, 3, 2, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 3, 7, 11, 14, 10, 8, 12, 8, 17, 10, 13, 14, 4, 11, 7, 8, 13, 7, 11, 0, 6, 7, 3, 3, 6, 2, 3, 3, 2, 4, 3, 9, 4, 3, 
1, 2, 3, 1, 2, 2, 2, 4, 3, 5, 1, 2, 2, 2, 4, 0, 0, 0, 1, 0, 1, 1, 0, 3, 2, 0, 0, 0, 0) ,
 s  =  c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 
5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 
7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2) ,
 segment  =  c(1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3) ,
 t  = structure(.Data =  c(1, 3, 4, 5, 4, 5, 1, 4, 3, 6, 2, 1, 2, 3) ,.Dim =  c(7, 2) ) 
)

##############################################
# MODEL                                      #
##############################################
# Piecewise constant hazard model (=piecewise exponential) for digitized KM data, fixed effects
# -----------------------------------------------------------------------------------------------
# Apr 2017, Sandro Gsteiger

model{

## Sampling model (likelihood)
for (i in 1:Nobs){

  # likelihood: digitized KM curves
  r[i] ~ dbin(p[i], n[i])
  p[i] &lt;- 1 - exp(-h[i] * dt[i])  # cumulative hazard over interval [t,t+dt] expressed as deaths per person-month

  # piecewise constant model
  log(h[i]) &lt;- Beta[s[i], a[i], segment[i]]
}


## Arm level parameters = study effect + trt effect (consistency eq)
for (i in 1:Ns){
  for (j in 1:Na[i]){
    for (k in 1:(Ncuts + 1)){
      Beta[i, j, k] &lt;- mu[i, k] + d[t[i, j], k] - d[t[i, 1], k]
    }
  }
}
     
## Priors
for (i in 1:Ns){
  for (k in 1:(Ncuts + 1)){
    mu[i, k] ~ dnorm(feprior_mean, feprior_prec) 
  }
}

for (k in 1:(Ncuts + 1)){
  d[1, k] &lt;- 0
  for (i in 2:Ntrt){
    d[i, k] ~ dnorm(feprior_mean, feprior_prec) 
  }
}

} # end of model
############################################## </code></pre>
</div>
<div id="piecewise-exponential-model-7" class="section level2">
<h2 class="hasAnchor">
<a href="#piecewise-exponential-model-7" class="anchor"></a>Piecewise Exponential model</h2>
<pre><code> ##############################################
# DATA                                       #
##############################################
list(
 Na  =  c(2, 2, 2, 2, 2, 2, 2) ,
 Ncuts  =  2 ,
 Nobs  =  675 ,
 Ns  =  7 ,
 Ntrt  =  6 ,
 a  =  c(2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2) ,
 dt  =  c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1) ,
 feprior_mean  =  0 ,
 feprior_prec  =  1e-04 ,
 n  =  c(182, 177, 172, 164, 155, 148, 143, 138, 132, 128, 125, 120, 117, 110, 108, 106, 101, 98, 96, 90, 87, 83, 79, 75, 70, 66, 59, 56, 53, 50, 47, 45, 39, 37, 34, 32, 31, 26, 25, 24, 23, 21, 19, 16, 14, 13, 11, 10, 8, 6, 5, 3, 1, 183, 179, 172, 159, 152, 147, 139, 133, 131, 124, 119, 115, 110, 104, 101, 95, 93, 92, 88, 83, 80, 76, 73, 68, 62, 59, 53, 50, 43, 40, 37, 35, 33, 31, 30, 29, 26, 24, 22, 19, 18, 18, 18, 18, 17, 17, 15, 14, 12, 10, 8, 4, 2, 322, 319, 309, 301, 288, 277, 262, 255, 248, 238, 229, 
226, 216, 206, 200, 195, 189, 183, 176, 171, 163, 160, 150, 148, 142, 136, 130, 127, 121, 116, 113, 112, 108, 105, 101, 101, 96, 95, 91, 89, 86, 84, 327, 324, 318, 307, 297, 283, 275, 263, 256, 248, 241, 235, 225, 217, 212, 201, 194, 184, 178, 169, 161, 156, 149, 142, 134, 131, 125, 117, 115, 107, 101, 96, 93, 89, 83, 79, 76, 74, 70, 68, 65, 63, 375, 374, 368, 360, 352, 339, 326, 319, 315, 308, 295, 289, 283, 271, 262, 259, 247, 238, 229, 225, 213, 203, 197, 190, 180, 161, 135, 121, 98, 78, 61, 55, 
52, 45, 39, 35, 375, 372, 356, 338, 319, 308, 295, 282, 276, 269, 260, 251, 242, 228, 221, 210, 203, 200, 187, 180, 172, 168, 161, 155, 149, 132, 115, 104, 82, 66, 53, 48, 43, 39, 34, 30, 181, 181, 180, 176, 172, 169, 167, 158, 153, 145, 143, 141, 137, 133, 129, 126, 123, 121, 118, 113, 112, 108, 105, 101, 99, 99, 98, 95, 92, 90, 88, 87, 86, 83, 82, 82, 78, 78, 78, 78, 181, 179, 176, 175, 173, 172, 169, 166, 165, 164, 159, 155, 150, 144, 140, 135, 132, 132, 132, 129, 127, 126, 123, 121, 116, 109, 
107, 105, 105, 104, 101, 97, 94, 93, 93, 90, 557, 552, 541, 532, 521, 505, 487, 473, 462, 452, 436, 423, 409, 388, 377, 368, 357, 348, 338, 328, 320, 312, 305, 295, 280, 273, 262, 255, 243, 235, 230, 226, 219, 215, 208, 204, 197, 184, 171, 156, 147, 147, 114, 114, 99, 99, 80, 77, 57, 48, 38, 27, 21, 20, 17, 14, 8, 6, 6, 1, 1, 553, 544, 530, 518, 501, 480, 468, 448, 435, 420, 406, 387, 377, 366, 354, 348, 339, 329, 321, 315, 304, 295, 283, 280, 272, 263, 254, 247, 237, 230, 224, 218, 212, 203, 192, 
187, 180, 174, 162, 149, 138, 131, 120, 111, 100, 92, 80, 63, 56, 48, 38, 31, 20, 17, 14, 11, 9, 7, 5, 5, 1, 189, 184, 178, 166, 156, 144, 138, 131, 123, 117, 111, 106, 103, 98, 93, 88, 85, 79, 74, 68, 64, 59, 55, 50, 46, 43, 40, 37, 35, 31, 28, 26, 25, 20, 19, 15, 15, 12, 10, 9, 9, 3, 3, 3, 3, 188, 179, 175, 167, 159, 151, 141, 136, 131, 127, 123, 117, 112, 106, 101, 96, 94, 88, 84, 77, 70, 64, 57, 52, 44, 39, 39, 30, 30, 26, 23, 21, 20, 16, 16, 12, 11, 11, 10, 8, 7, 4, 4, 2, 2, 2, 363, 360, 344, 
332, 314, 305, 286, 269, 261, 248, 236, 226, 220, 214, 199, 197, 188, 180, 177, 168, 162, 155, 151, 150, 148, 144, 140, 136, 128, 122, 118, 116, 113, 113, 109, 105, 98, 94, 87, 83, 75, 69, 64, 57, 53, 49, 46, 40, 37, 31, 25, 22, 18, 14, 10, 9, 7, 6, 3, 2, 1, 369, 366, 358, 347, 333, 322, 314, 302, 294, 277, 267, 254, 240, 236, 225, 218, 210, 197, 190, 179, 179, 173, 166, 163, 160, 154, 152, 148, 145, 143, 139, 136, 127, 123, 119, 118, 116, 112, 109, 106, 102, 99, 94, 85, 74, 66, 58, 50, 42, 35, 31, 
28, 25, 20, 17, 15, 13, 11, 6, 3, 2, 1, 1) ,
 r  =  c(2, 2, 4, 6, 4, 5, 4, 4, 4, 2, 5, 1, 7, 1, 1, 3, 1, 0, 3, 2, 1, 3, 2, 2, 2, 3, 1, 0, 0, 0, 1, 4, 1, 1, 1, 0, 4, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 4, 10, 4, 2, 6, 4, 0, 5, 3, 3, 3, 5, 1, 5, 1, 0, 3, 3, 3, 0, 0, 2, 2, 0, 3, 1, 3, 0, 1, 2, 0, 0, 0, 0, 2, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 3, 10, 7, 13, 10, 15, 7, 7, 9, 9, 3, 9, 10, 5, 5, 6, 5, 7, 5, 7, 3, 10, 1, 6, 6, 5, 3, 5, 5, 3, 0, 4, 3, 3, 0, 4, 1, 4, 1, 3, 2, 3, 2, 4, 9, 8, 12, 7, 11, 5, 7, 5, 4, 8, 7, 2, 10, 
6, 8, 4, 8, 6, 3, 5, 5, 6, 2, 5, 5, 1, 6, 5, 3, 1, 2, 5, 2, 1, 1, 2, 1, 1, 0, 0, 0, 5, 6, 7, 11, 12, 7, 3, 6, 12, 5, 6, 11, 8, 1, 11, 8, 8, 3, 10, 9, 4, 5, 9, 2, 6, 3, 2, 1, 2, 1, 0, 3, 0, 0, 0, 0, 13, 14, 15, 7, 10, 12, 5, 6, 7, 8, 8, 14, 7, 10, 7, 3, 13, 5, 5, 2, 4, 4, 3, 3, 1, 2, 5, 1, 1, 0, 2, 0, 0, 0, 0, 0, 1, 4, 4, 3, 2, 9, 5, 8, 2, 2, 4, 4, 4, 3, 3, 2, 3, 5, 1, 4, 3, 4, 2, 0, 1, 3, 3, 2, 2, 1, 1, 3, 1, 0, 4, 0, 0, 0, 0, 2, 3, 1, 2, 1, 3, 3, 1, 1, 5, 4, 5, 6, 4, 5, 3, 0, 0, 3, 2, 1, 3, 2, 5, 
7, 2, 2, 0, 1, 3, 4, 3, 1, 0, 3, 2, 3, 8, 6, 9, 14, 15, 10, 9, 8, 13, 11, 12, 21, 9, 8, 11, 9, 10, 9, 8, 6, 4, 6, 12, 4, 8, 4, 10, 6, 3, 1, 4, 2, 3, 2, 5, 5, 4, 6, 1, 0, 0, 0, 15, 0, 0, 3, 4, 1, 0, 0, 1, 0, 2, 0, 4, 0, 0, 0, 0, 0, 4, 8, 6, 12, 19, 9, 17, 11, 15, 12, 18, 10, 11, 11, 5, 9, 9, 6, 4, 10, 7, 9, 0, 5, 6, 6, 5, 7, 5, 5, 4, 3, 8, 9, 2, 6, 0, 5, 7, 3, 0, 3, 3, 6, 0, 3, 5, 1, 0, 0, 0, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 2, 2, 10, 7, 8, 3, 6, 4, 5, 4, 4, 0, 3, 3, 1, 1, 4, 3, 2, 2, 2, 2, 1, 1, 2, 
2, 0, 1, 3, 2, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 6, 2, 5, 5, 3, 8, 2, 4, 1, 2, 4, 3, 4, 4, 0, 2, 0, 3, 4, 1, 1, 0, 2, 3, 3, 0, 0, 0, 2, 0, 1, 1, 0, 0, 2, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 3, 15, 11, 18, 8, 19, 17, 8, 13, 11, 10, 6, 6, 15, 2, 8, 8, 3, 9, 6, 7, 4, 1, 2, 4, 4, 3, 8, 6, 4, 2, 3, 0, 4, 4, 7, 2, 4, 2, 4, 4, 3, 4, 1, 0, 0, 3, 0, 3, 2, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 3, 7, 11, 14, 10, 8, 12, 8, 17, 10, 13, 14, 4, 11, 7, 8, 13, 7, 11, 0, 6, 7, 3, 3, 6, 2, 3, 3, 2, 4, 3, 9, 4, 3, 
1, 2, 3, 1, 2, 2, 2, 4, 3, 5, 1, 2, 2, 2, 4, 0, 0, 0, 1, 0, 1, 1, 0, 3, 2, 0, 0, 0, 0) ,
 reprior_var_ln_mean  =  1 ,
 reprior_var_ln_prec  =  1.5 ,
 s  =  c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 
5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 
7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2) ,
 segment  =  c(1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3) ,
 t  = structure(.Data =  c(1, 3, 4, 5, 4, 5, 1, 4, 3, 6, 2, 1, 2, 3) ,.Dim =  c(7, 2) ) 
)

##############################################
# MODEL                                      #
##############################################
# Piecewise constant hazard model (=piecewise exponential) for digitized KM data, random effects
# Prior for between-trial-heterogeneity: log-normal for RE variance
# -----------------------------------------------------------------------------------------------
# Apr 2017, Sandro Gsteiger

model{

## Sampling model (likelihood)
for (i in 1:Nobs){

  # likelihood: digitized KM curves
  r[i] ~ dbin(p[i], n[i])
  p[i] &lt;- 1 - exp(-h[i] * dt[i])  # cumulative hazard over interval [t,t+dt] expressed as deaths per person-month

  # piecewise constant model
  log(h[i]) &lt;- Beta[s[i], a[i], segment[i]]
}


## Arm level parameters = study effect + trt effect (i.e. contrast)
for (i in 1:Ns){
  for (j in 1:Na[i]){
    for (k in 1:(Ncuts + 1)){
      Beta[i, j, k] &lt;- mu[i, k] + delta[i, j, k]
    }
  }
}


## Random effects (multi-arm correction; consistency eq for population parameters)
for (i in 1:Ns){
  # j=1
    for (k in 1:(Ncuts + 1)){
      w[i, 1, k] &lt;- 0
      delta[i, 1, k] &lt;- 0
    }

  # j&gt;1
  for (j in 2:Na[i]){
    for (k in 1:(Ncuts + 1)){
      delta[i, j, k] ~ dnorm(md[i, j, k], re.prec.d[i, j, k])
      md[i, j, k] &lt;- d[t[i, j], k] - d[t[i, 1], k] + sw[i, j, k]
      w[i, j, k] &lt;- (delta[i, j, k] - d[t[i, j], k] + d[t[i, 1], k])
      sw[i, j, k] &lt;- sum(w[i, 1:(j - 1), k]) / (j - 1) 
      re.prec.d[i, j, k] &lt;- re.prec * 2 * (j - 1) / j 
    }
  }
}




## Priors
for (i in 1:Ns){
  for (k in 1:(Ncuts + 1)){
    mu[i, k] ~ dnorm(feprior_mean, feprior_prec) 
  }
}

for (k in 1:(Ncuts + 1)){
  d[1, k] &lt;- 0
  for (i in 2:Ntrt){
    d[i, k] ~ dnorm(feprior_mean, feprior_prec) 
  }
}

sd2 ~ dlnorm(reprior_var_ln_mean, reprior_var_ln_prec)
re.prec &lt;- 1/sd2
sd &lt;- sqrt(sd2)

} # end of model
############################################## </code></pre>
</div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/date.html">date</a></span>()
</pre></div>
<pre><code>## [1] "Fri Sep 18 08:56:52 2020"</code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()
</pre></div>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.6
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] ggmcmc_1.5.0    ggplot2_3.3.2   tidyr_1.1.2     gemtcPlus_1.0.0
## [5] R2jags_0.6-1    rjags_4-10      gemtc_0.8-7     coda_0.19-3    
## [9] dplyr_1.0.2    
## 
## loaded via a namespace (and not attached):
##  [1] network_1.16.0     tidyselect_1.1.0   xfun_0.17          purrr_0.3.4       
##  [5] lattice_0.20-41    colorspace_1.4-1   vctrs_0.3.4        generics_0.0.2    
##  [9] htmltools_0.5.0    yaml_2.2.1         rlang_0.4.7        pkgdown_1.6.1     
## [13] pillar_1.4.6       glue_1.4.2         withr_2.2.0        RColorBrewer_1.1-2
## [17] lifecycle_0.2.0    plyr_1.8.6         stringr_1.4.0      munsell_0.5.0     
## [21] gtable_0.3.0       ragg_0.3.1         memoise_1.1.0      evaluate_0.14     
## [25] labeling_0.3       knitr_1.29         GGally_2.0.0       parallel_4.0.2    
## [29] highr_0.8          Rcpp_1.0.5         backports_1.1.10   scales_1.1.1      
## [33] desc_1.2.0         cpp11_0.2.1        abind_1.4-5        farver_2.0.3      
## [37] systemfonts_0.3.1  fs_1.5.0           digest_0.6.25      stringi_1.5.3     
## [41] grid_4.0.2         rprojroot_1.3-2    tools_4.0.2        magrittr_1.5      
## [45] tibble_3.0.3       crayon_1.3.4       pkgconfig_2.0.3    ellipsis_0.3.1    
## [49] assertthat_0.2.1   rmarkdown_2.3      reshape_0.8.8      rstudioapi_0.11   
## [53] R6_2.4.1           boot_1.3-25        R2WinBUGS_2.1-21   igraph_1.2.5      
## [57] compiler_4.0.2</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sandro Gsteiger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
