<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Building Reports into the Package • gemtcPlus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Building Reports into the Package">
<meta property="og:description" content="gemtcPlus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-181075487-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-181075487-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gemtcPlus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/MAIC/docs/index.html">MAIC</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/gemtcPlus/docs/index.html">gemtcPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/rpsftmPlus/docs/index.html">rpsftmPlus</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Roche/Global-HTA-Evidence-Open/tree/master/Rpackages/gemtcPlus">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><link href="building-reports_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="building-reports_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Building Reports into the Package</h1>
                        <h4 class="author">Nick Howlett, Sandro Gsteiger</h4>
            
            <h4 class="date">2020-10-22</h4>
      
      
      <div class="hidden name"><code>building-reports.Rmd</code></div>

    </div>

    
    
<div id="building-reports-into-the-package" class="section level2">
<h2 class="hasAnchor">
<a href="#building-reports-into-the-package" class="anchor"></a>Building Reports into the Package</h2>
<p>Example usage reports are built into this package (as vignettes) with the aim to make the analysis more accessible to new users. Developers can add to the collection of reports by creating a new vignette using devtools</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">use_vignette</span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"Report title"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"gemtcPlus"</span>)</pre></body></html></div>
<p>Executing the line above will create an R Markdown file in the <code>vingettes</code> directory of the package root. All R Markdown files in this directory are built as vignettes when the package is built by running</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/build.html">build</a></span>(<span class="kw">vignettes</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>This document will not cover the details of R Markdown, for a good reference I recommend <a href="http://r-pkgs.had.co.nz/vignettes.html">this</a> resource.</p>
<p>During a <code>build</code> (with argument <code>vignettes = TRUE</code>) the package is first installed, so the code can be used, and then the vignettes are built. This means that in order to access the functions/datasets that come with the package in the vignette you will need to make a call to <code><a href="https://rdrr.io/pkg/gemtcPlus/man">library(gemtcPlus)</a></code> at the start of the document.</p>
<p>However there are two conventions which are specific to the vignette building used in this package. The conventions concern reading/writing files. NMAs may involve running very long MCMCs. This can take some time and can have outputs of sizes larger than 100Mb. For this reason it’s practical to break the generation of results and presentation of them into separate steps. It’s also a good idea to break the output objects required to do so into smaller chunks. Another requirement of running NMA analyses here is the use of <code>BUGS</code> code which is most conveniently loaded in from a text file. This necessitates a process to read/write files when building the package vignettes. To handle this properly there are two functions you need to use.</p>
<p>For reading system files the <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> function which will produce a directory path string. Here is an example of loading a <code>BUGS</code> file using <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code></p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu">jags</span>(<span class="kw">model.file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"BUGScode"</span>,
                                     <span class="st">"tte_piece-wise-cst_fe.txt"</span>,
                                     <span class="kw">package</span> <span class="kw">=</span> <span class="st">"gemtcRoche"</span>),
            <span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">dat_jg</span>,
                     <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">prior_mean</span> <span class="kw">=</span> <span class="fl">0</span>),
                     <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">prior_prec</span> <span class="kw">=</span> <span class="fl">0.0001</span>)),
            <span class="kw">parameters</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"d"</span>, <span class="st">"mu"</span>),
            <span class="kw">n.chains</span> <span class="kw">=</span> <span class="no">n.chains</span>,
            <span class="kw">n.iter</span> <span class="kw">=</span> <span class="no">n.iter</span>,
            <span class="kw">n.burnin</span> <span class="kw">=</span> <span class="no">n.burnin</span>,
            <span class="kw">n.thin</span> <span class="kw">=</span> <span class="no">n.thin</span>)</pre></body></html></div>
<p>The call to <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> bases it’s root around the <code>inst</code> directory which is in the package root. So here the <code>.txt</code> files have been previously placed into the <code>inst/BUGScode</code> directory.</p>
<p>This solves the file read issue but unfortunately <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> only generates a path to a file that already exists and can not be used to create a path to an output file. Instead we use the <code>here()</code> function from the <code>here</code> package. Here is an example of the usage when writing output files from a results generation script.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">out_all</span>)){
  <span class="no">out</span> <span class="kw">&lt;-</span> <span class="no">out_all</span><span class="kw">[[</span><span class="no">i</span>]]
  <span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="no">out</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"inst"</span>,
                              <span class="st">"extdata"</span>,
                              <span class="st">"results"</span>,
                              <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"fit-pwe-"</span>, <span class="no">i</span>, <span class="st">".RData"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>)))
}</pre></body></html></div>
<p>The syntax is very similar to <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> however the root is actually the package root and not <code>inst</code>. Output files are therefore stored in the <code>inst/extdata/results/</code> directory and are read from there when building the output reports using <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code>.</p>
<p>This means that any output results are built into the package. Users should be careful not to save many large files here.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sandro Gsteiger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
