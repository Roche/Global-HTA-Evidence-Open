<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Estimate MAIC propensity weights — estimate_weights • MAIC</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Estimate MAIC propensity weights — estimate_weights" />
<meta property="og:description" content="Estimate propensity weights for matching-adjusted indirect comparison (MAIC)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-181075487-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-181075487-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MAIC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/MAIC.html">Vignette</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/MAIC/docs/index.html">MAIC</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/gemtcPlus/docs/index.html">gemtcPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/rpsftmPlus/docs/index.html">rpsftmPlus</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Roche/Global-HTA-Evidence-Open/tree/master/Rpackages/MAIC">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimate MAIC propensity weights</h1>
    
    <div class="hidden name"><code>estimate_weights.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimate propensity weights for matching-adjusted indirect comparison (MAIC).</p>
    </div>

    <pre class="usage"><span class='fu'>estimate_weights</span>(<span class='no'>intervention_data</span>, <span class='no'>matching_vars</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>intervention_data</th>
      <td><p>A data frame containing individual patient data from
the intervention study.</p></td>
    </tr>
    <tr>
      <th>matching_vars</th>
      <td><p>A character vector giving the names of the covariates to
use in matching. These names must match the column names in
intervention_data.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments to be passed to optimisation functions such
as the method for maximum likelihood optimisation. The default is method =
"BFGS". Refer to <code><a href='https://rdrr.io/r/stats/optim.html'>optim</a></code> for options.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list containing 2 objects. First, a data frame named analysis_data
  containing intervention_data with additional columns named wt (weights) and
  wt_rs (rescaled weights). Second, a vector called matching_vars of the
  names of the centered matching variables used.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The premise of MAIC methods is to adjust for between-trial
  differences in patient demographic or disease characteristics at baseline.
  When a common treatment comparator or ‘linked network’ are unavailable, a
  MAIC assumes that differences between absolute outcomes that would be
  observed in each trial are entirely explained by imbalances in prognostic
  variables and treatment effect modifiers.</p>
<p>The aim of the MAIC method is to estimate a set of propensity weights based
  on prognostic variables and treatment effect modifiers. These weights can
  be used in subsequent statistical analysis to adjust for differences in
  patient characteristics between the population in the intervention trial
  and the population in a comparator study. For additional details on the
  statistical methods, refer to the package vignette.</p>
<p>The data required for an unanchored MAIC are:</p>
<p></p><ul>
<li><p>Individual patient data from a single arm study of 'intervention'</p></li>
<li><p>Aggregate summary data for 'comparator'. This could be from a
    single arm study of the comparator or from one arm of a randomized
    controlled trial.</p></li>
<li><p>Psuedo patient data from the comparator study. This is not required
    for the matching process but is needed to derive the relative treatment
    effects between the intervention and comparator.</p></li>
</ul>

<p>For the matching process:</p>
<p></p><ol>
<li><p>All binary variables to be used in the matching should be coded 1
      and 0</p></li>
<li><p>The variable names need to be listed in a character vector called
      match_cov</p></li>
<li><p>Aggregate baseline characteristics (number of patients, mean and
      SD for continuous variables and proportion for binary variables) from
      the comparator trial are needed as a data frame. Naming of the
      covariates in this data frame should be consistent with variable names
      in the intervention data.</p></li>
<li><p>Patient baseline characteristics in the intervention study are
      centered on the value of the aggregate data from the comparator study</p></li>
<li><p>The estimate_weights function can then be used to estimate
      propensity weights for each patient in the intervention study</p></li>
</ol>

<p>For full details refer to the example below and the package vignette</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>NICE DSU TECHNICAL SUPPORT DOCUMENT 18: METHODS FOR
  POPULATION-ADJUSTED INDIRECT COMPARISONS IN SUBMSISSIONS TO NICE, REPORT BY
  THE DECISION SUPPORT UNIT, December 2016</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/r/stats/optim.html'>optim</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># This example code estimates weights for individual patient data from a single</span>
<span class='co'># arm study of 'intervention' based on aggregate baseline characteristics from</span>
<span class='co'># the comparator trial</span>

<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dplyr</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>MAIC</span>)


<span class='co'>#### Prepare the data ----------------------------------------------------------</span>

<span class='co'>### Intervention data</span>

<span class='co'># Read in relevant ADaM data and rename variables of interest</span>
<span class='no'>adsl</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"extdata"</span>, <span class='st'>"adsl.csv"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"MAIC"</span>,
                             <span class='kw'>mustWork</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))
<span class='no'>adrs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"extdata"</span>, <span class='st'>"adrs.csv"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"MAIC"</span>,
                             <span class='kw'>mustWork</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))
<span class='no'>adtte</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"extdata"</span>, <span class='st'>"adtte.csv"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"MAIC"</span>,
                              <span class='kw'>mustWork</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))

<span class='no'>adsl</span> <span class='kw'>&lt;-</span> <span class='no'>adsl</span> <span class='kw'>%&gt;%</span> <span class='co'># Data containing the matching variables</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span>(<span class='kw'>SEX</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='no'>SEX</span><span class='kw'>==</span><span class='st'>"Male"</span>, <span class='fl'>1</span>, <span class='fl'>0</span>)) <span class='co'># Coded 1 for males and 0 for females</span>

<span class='no'>adrs</span> <span class='kw'>&lt;-</span> <span class='no'>adrs</span> <span class='kw'>%&gt;%</span> <span class='co'># Response data</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>PARAM</span><span class='kw'>==</span><span class='st'>"Response"</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>transmute</a></span>(<span class='no'>USUBJID</span>, <span class='no'>ARM</span>, <span class='kw'>response</span><span class='kw'>=</span><span class='no'>AVAL</span>)

<span class='no'>adtte</span> <span class='kw'>&lt;-</span> <span class='no'>adtte</span> <span class='kw'>%&gt;%</span> <span class='co'># Time to event data (overall survival)</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>PARAMCD</span><span class='kw'>==</span><span class='st'>"OS"</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span>(<span class='kw'>Event</span><span class='kw'>=</span><span class='fl'>1</span>-<span class='no'>CNSR</span>) <span class='kw'>%&gt;%</span> <span class='co'>#Set up coding as Event = 1, Censor = 0</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>transmute</a></span>(<span class='no'>USUBJID</span>, <span class='no'>ARM</span>, <span class='kw'>Time</span><span class='kw'>=</span><span class='no'>AVAL</span>, <span class='no'>Event</span>)

<span class='co'># Combine all intervention data</span>
<span class='no'>intervention_input</span> <span class='kw'>&lt;-</span> <span class='no'>adsl</span> <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>full_join</a></span>(<span class='no'>adrs</span>, <span class='kw'>by</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"USUBJID"</span>, <span class='st'>"ARM"</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>full_join</a></span>(<span class='no'>adtte</span>, <span class='kw'>by</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"USUBJID"</span>, <span class='st'>"ARM"</span>))

<span class='co'># List out the variables in the intervention data that have been identified as</span>
<span class='co'># prognostic factors or treatment effect modifiers and will be used in the</span>
<span class='co'># matching</span>
<span class='no'>match_cov</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"AGE"</span>,
               <span class='st'>"SEX"</span>,
               <span class='st'>"SMOKE"</span>,
               <span class='st'>"ECOG0"</span>)

<span class='co'>## Baseline data from the comparator trial</span>
<span class='co'># Baseline aggregate data for the comparator population</span>
<span class='no'>target_pop</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"extdata"</span>, <span class='st'>"Aggregate data.csv"</span>,
                                     <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"MAIC"</span>, <span class='kw'>mustWork</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))

<span class='co'># Rename target population cols to be consistent with match_cov</span>
<span class='no'>target_pop_standard</span> <span class='kw'>&lt;-</span> <span class='no'>target_pop</span> <span class='kw'>%&gt;%</span>
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span>(
           <span class='kw'>N</span><span class='kw'>=</span><span class='no'>N</span>,
           <span class='kw'>Treatment</span><span class='kw'>=</span><span class='no'>ARM</span>,
           <span class='kw'>AGE</span><span class='kw'>=</span><span class='no'>age.mean</span>,
           <span class='kw'>SEX</span><span class='kw'>=</span><span class='no'>prop.male</span>,
           <span class='kw'>SMOKE</span><span class='kw'>=</span><span class='no'>prop.smoke</span>,
           <span class='kw'>ECOG0</span><span class='kw'>=</span><span class='no'>prop.ecog0</span>
              ) <span class='kw'>%&gt;%</span>
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>transmute</a></span>(<span class='no'>N</span>, <span class='no'>Treatment</span>, <span class='no'>AGE</span>, <span class='no'>SEX</span>, <span class='no'>SMOKE</span>, <span class='no'>ECOG0</span>)


<span class='co'>#### Estimate weights ----------------------------------------------------------</span>

<span class='co'>### Center baseline characteristics</span>
<span class='co'># (subtract the aggregate comparator data from the corresponding column of</span>
<span class='co'># intervention PLD)</span>
<span class='no'>intervention_data</span> <span class='kw'>&lt;-</span> <span class='no'>intervention_input</span> <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span>(
     <span class='kw'>Age_centered</span> <span class='kw'>=</span> <span class='no'>AGE</span> - <span class='no'>target_pop</span>$<span class='no'>age.mean</span>,
     <span class='co'># matching on both mean and standard deviation for continuous variables (optional)</span>
     <span class='kw'>Age_squared_centered</span> <span class='kw'>=</span> (<span class='no'>AGE</span>^<span class='fl'>2</span>) - (<span class='no'>target_pop</span>$<span class='no'>age.mean</span>^<span class='fl'>2</span> + <span class='no'>target_pop</span>$<span class='no'>age.sd</span>^<span class='fl'>2</span>),
     <span class='kw'>Sex_centered</span> <span class='kw'>=</span> <span class='no'>SEX</span> - <span class='no'>target_pop</span>$<span class='no'>prop.male</span>,
     <span class='kw'>Smoke_centered</span> <span class='kw'>=</span> <span class='no'>SMOKE</span> - <span class='no'>target_pop</span>$<span class='no'>prop.smoke</span>,
     <span class='kw'>ECOG0_centered</span> <span class='kw'>=</span> <span class='no'>ECOG0</span> - <span class='no'>target_pop</span>$<span class='no'>prop.ecog0</span>)

<span class='co'>## Define the matching covariates</span>
<span class='no'>cent_match_cov</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Age_centered"</span>,
                    <span class='st'>"Age_squared_centered"</span>,
                    <span class='st'>"Sex_centered"</span>,
                    <span class='st'>"Smoke_centered"</span>,
                    <span class='st'>"ECOG0_centered"</span>)

<span class='co'>## Optimization procedure</span>
<span class='co'># Following the centering of the baseline characteristics of the intervention</span>
<span class='co'># study, patient weights can be estimated using estimate_weights</span>
<span class='co'># The function output is a list containing (1) a data set of the individual</span>
<span class='co'># patient data with the assigned weights "analysis_data" and (2) a vector</span>
<span class='co'># containing the matching variables "matching_vars"</span>
<span class='no'>est_weights</span> <span class='kw'>&lt;-</span> <span class='fu'>estimate_weights</span>(<span class='kw'>intervention_data</span> <span class='kw'>=</span> <span class='no'>intervention_data</span>,
                                <span class='kw'>matching_vars</span> <span class='kw'>=</span> <span class='no'>cent_match_cov</span>)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Iain Bennett, Jo Gregory, Sarah Smith, Richard Birnie.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


