<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Structural and Parametric Uncertainty • descem</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Structural and Parametric Uncertainty">
<meta property="og:description" content="descem">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-200791953-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-200791953-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">descem</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/descem/docs/articles/example_ssd.html">Example in a Sick-Sicker-Dead Model</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/descem/docs/articles/example_eBC.html">Example in Early Breast Cancer</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/descem/docs/articles/example_markov.html">Example in a Markov Model</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/descem/docs/articles/example_uncertainty.html">Structural and Parametric Uncertainty</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/flexsurvPlus/docs/index.html">flexsurvPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/gemtcPlus/docs/index.html">gemtcPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/MAIC/docs/index.html">MAIC</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/rpsftmPlus/docs/index.html">rpsftmPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/descem/docs/index.html">descem</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Roche/Global-HTA-Evidence-Open/tree/master/Rpackages/descem">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example_uncertainty_files/header-attrs-2.5/header-attrs.js"></script><script src="example_uncertainty_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="example_uncertainty_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="example_uncertainty_files/anchor-sections-1.0/anchor-sections.js"></script><script src="example_uncertainty_files/kePrint-0.0.1/kePrint.js"></script><link href="example_uncertainty_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Structural and Parametric Uncertainty</h1>
                        <h4 class="author">Javier Sanchez Alvarez and Valerie Aponte Ribero</h4>
            
            <h4 class="date">August 27, 2021</h4>
      
      
      <div class="hidden name"><code>example_uncertainty.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This document runs a discrete event simulation model in the context of early breast cancer to show how uncertainty behaves in a simulation setting and how it complements with a standard PSA. As the model is extremely similar to the example in early breast cancer, the user can check the original model for details on functions, parameters etc.</p>
<div id="main-options" class="section level2">
<h2 class="hasAnchor">
<a href="#main-options" class="anchor"></a>Main options</h2>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">descem</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/flexsurv-dev">flexsurv</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: survival</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'kableExtra'</span>
<span class="co">#&gt; The following object is masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     group_rows</span></pre></div>
</div>
<div id="load-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load Data</h2>
<p>The dummy data for costs and utility is generated below.</p>
</div>
</div>
<div id="general-inputs-with-delayed-execution" class="section level1">
<h1 class="hasAnchor">
<a href="#general-inputs-with-delayed-execution" class="anchor"></a>General inputs with delayed execution</h1>
<p>Initial inputs and flags that will be used in the model can be defined below. This is exactly the same as in the original model, the only difference is that now we are adding an extra chunk which reflects the uncertainty of parameters to draw distributions. Furthermore, utilities and costs also have a distribution.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co">#Each patient is identified through "i"</span>
<span class="co">#Items used in the model should be unnamed numeric/vectors! otherwise if they are processed by model it can lead to strangely named outcomes</span>
<span class="co">#In this case, util_v is a named vector, but it's not processed by the model. We extract unnamed numerics from it.</span>

<span class="co">#Put objects here that do not change on any patient or intervention loop</span>
<span class="va">common_all_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span> <span class="co">#utilities</span>
    util_v <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">psa_bool</span><span class="op">)</span><span class="op">{</span>
                     <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">util.data</span><span class="op">$</span><span class="va">value</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">util.data</span><span class="op">$</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,<span class="va">util.data</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="co">#in this case I choose a multivariate normal with no correlation</span>
             <span class="op">}</span> <span class="kw">else</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">util.data</span><span class="op">$</span><span class="va">value</span>,<span class="va">util.data</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">}</span>,
    util.idfs.ontx <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.idfs.ontx"</span><span class="op">]</span><span class="op">]</span>, 
    util.idfs.offtx  <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.idfs.offtx"</span><span class="op">]</span><span class="op">]</span>,
    util.remission <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.remission"</span><span class="op">]</span><span class="op">]</span>,
    util.recurrence <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.recurrence"</span><span class="op">]</span><span class="op">]</span>,
    util.mbc.progression.mbc <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.mbc.progression.mbc"</span><span class="op">]</span><span class="op">]</span>,
    util.mbc.pps <span class="op">=</span> <span class="va">util_v</span><span class="op">[[</span><span class="st">"util.mbc.pps"</span><span class="op">]</span><span class="op">]</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span> <span class="co">#costs</span>
    cost_v <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">psa_bool</span><span class="op">)</span><span class="op">{</span>
                     <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="../reference/draw.rgamma.html">draw.rgamma</a></span><span class="op">(</span><span class="va">cost.data</span><span class="op">$</span><span class="va">value</span>,<span class="va">cost.data</span><span class="op">$</span><span class="va">se</span><span class="op">)</span>,<span class="va">cost.data</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="co">#in this case I choose a gamma distribution</span>
             <span class="op">}</span> <span class="kw">else</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">cost.data</span><span class="op">$</span><span class="va">value</span>,<span class="va">cost.data</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">}</span>,
    cost.idfs.tx  <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.idfs.tx"</span><span class="op">]</span><span class="op">]</span>,
    cost.recurrence  <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.recurrence"</span><span class="op">]</span><span class="op">]</span>,
    cost.mbc.tx  <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.mbc.tx"</span><span class="op">]</span><span class="op">]</span>,
    cost.tx.beva  <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.tx.beva"</span><span class="op">]</span><span class="op">]</span>,
    cost.idfs.txnoint <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.idfs.txnoint"</span><span class="op">]</span><span class="op">]</span>,
    cost.idfs <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.idfs"</span><span class="op">]</span><span class="op">]</span>,
    cost.mbc.progression.mbc <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.mbc.progression.mbc"</span><span class="op">]</span><span class="op">]</span>,
    cost.mbc.pps <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.mbc.pps"</span><span class="op">]</span><span class="op">]</span>,
    cost.2ndline <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.2ndline"</span><span class="op">]</span><span class="op">]</span>,
    cost.ae <span class="op">=</span> <span class="va">cost_v</span><span class="op">[[</span><span class="st">"cost.ae"</span><span class="op">]</span><span class="op">]</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span> <span class="co">#parameter uncertainty</span>
    coef11_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0.1</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>,
    coef12_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">0.1</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span>,
    coef13_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.8</span>,<span class="fl">0.05</span><span class="op">)</span>,<span class="fl">0.8</span><span class="op">)</span>,
    coef14_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span>,<span class="fl">0.05</span><span class="op">)</span>,<span class="fl">0.5</span><span class="op">)</span>,
    coef15_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2.3</span>,<span class="fl">0.1</span><span class="op">)</span>,<span class="fl">2.3</span><span class="op">)</span>,
    coef16_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.08</span>,<span class="fl">0.005</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.08</span><span class="op">)</span><span class="op">)</span>,
    coef2_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.2</span>,<span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>,
    hr_psa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">psa_bool</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">1.2</span><span class="op">)</span>,<span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,<span class="fl">1.2</span><span class="op">)</span>
    <span class="op">)</span>

<span class="co">#Put objects here that do not change as we loop through interventions for a patient</span>
<span class="va">common_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>sex_pt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/rbernoulli.html">rbernoulli</a></span><span class="op">(</span><span class="fl">1</span>,p<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,<span class="st">"male"</span>,<span class="st">"female"</span><span class="op">)</span>,
                             nat.os.s <span class="op">=</span> <span class="fu"><a href="../reference/rresgompertz.html">rresgompertz</a></span><span class="op">(</span><span class="fl">1</span>,
                                                     shape<span class="op">=</span><span class="kw">if</span><span class="op">(</span><span class="va">sex_pt</span><span class="op">==</span><span class="st">"male"</span><span class="op">)</span><span class="op">{</span><span class="fl">0.102</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="fl">0.115</span><span class="op">}</span>,
                                                     rate<span class="op">=</span><span class="kw">if</span><span class="op">(</span><span class="va">sex_pt</span><span class="op">==</span><span class="st">"male"</span><span class="op">)</span><span class="op">{</span><span class="fl">0.000016</span><span class="op">}</span><span class="kw">else</span><span class="op">{</span><span class="fl">0.0000041</span><span class="op">}</span>,
                                                     lower_bound <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">)</span> <span class="co">#in years, for a patient who is 50yo</span>

<span class="co">#Put objects here that change as we loop through treatments for each patient (e.g. events can affect fl.tx, but events do not affect nat.os.s)</span>
<span class="co">#common across trt but changes per pt could be implemented here (if (trt==)... )</span>
<span class="va">unique_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>
  fl.idfs.ontx             <span class="op">=</span> <span class="fl">1</span>,
  fl.idfs                  <span class="op">=</span> <span class="fl">1</span>,
  fl.mbcs.ontx             <span class="op">=</span> <span class="fl">1</span>,
  fl.mbcs.progression.mbc  <span class="op">=</span> <span class="fl">1</span>,
  fl.tx.beva               <span class="op">=</span> <span class="fl">1</span>,  
  fl.mbcs                  <span class="op">=</span> <span class="fl">0</span>,
  fl.mbcs_2ndline          <span class="op">=</span> <span class="fl">0</span>,
  fl.recurrence            <span class="op">=</span> <span class="fl">0</span>,
  fl.remission             <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/rbernoulli.html">rbernoulli</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.8</span><span class="op">)</span> <span class="co">#80% probability of going into remission</span>
<span class="op">)</span></pre></div>
</div>
<div id="events" class="section level1">
<h1 class="hasAnchor">
<a href="#events" class="anchor"></a>Events</h1>
<div id="add-initial-events" class="section level2">
<h2 class="hasAnchor">
<a href="#add-initial-events" class="anchor"></a>Add Initial Events</h2>
<p>Events are generated as before, the only difference being that the parameters are not a simple number but the objects created as part of <code>common_all_inputs</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">init_event_list</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/add_tte.html">add_tte</a></span><span class="op">(</span>trt<span class="op">=</span><span class="st">"int"</span>,
               evts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"ttot"</span>, <span class="st">"ttot.beva"</span>,<span class="st">"progression.mbc"</span>, <span class="st">"os"</span>,<span class="st">"idfs"</span>,<span class="st">"ttot.early"</span>,<span class="st">"remission"</span>,<span class="st">"recurrence"</span>,<span class="st">"start.early.mbc"</span><span class="op">)</span>,
               other_inp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"os.early"</span>,<span class="st">"os.mbc"</span><span class="op">)</span>,
               input<span class="op">=</span><span class="op">{</span> <span class="co">#intervention</span>
    <span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">0</span>
    
    <span class="co">#Early</span>
    
    <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> 
    <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span>,<span class="va">idfs</span><span class="op">)</span>
    <span class="va">ttot.beva</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span>

    <span class="va">os.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef12_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> 
    
    <span class="co">#if patient has remission, check when will recurrence happen</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">fl.remission</span><span class="op">)</span> <span class="op">{</span> 
      <span class="va">recurrence</span> <span class="op">&lt;-</span> <span class="va">idfs</span> <span class="op">+</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span>
      <span class="va">remission</span> <span class="op">&lt;-</span> <span class="va">idfs</span>
      
      <span class="co">#if recurrence happens before death</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span><span class="op">&gt;</span><span class="va">recurrence</span><span class="op">)</span> <span class="op">{</span> 
        
        <span class="co">#Late metastatic (after finishing idfs and recurrence)</span>
        
        <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef13_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span>  <span class="op">+</span>  <span class="va">recurrence</span> 
        
        <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span> 
        
        <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span>
        
        
      <span class="op">}</span>
      
    <span class="op">}</span> <span class="kw">else</span><span class="op">{</span> <span class="co">#If early metastatic</span>
      <span class="va">start.early.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef15_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span>
      
      <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span>
      <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span>,<span class="va">ttot.early</span><span class="op">)</span>
      
      <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef13_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span>
      
      <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span>
      
      <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span>
      
    <span class="op">}</span>
    
    <span class="va">os</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">os.mbc</span>,<span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span>
    

  <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="fu"><a href="../reference/add_tte.html">add_tte</a></span><span class="op">(</span>trt<span class="op">=</span><span class="st">"noint"</span>,
                       evts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"ttot"</span>, <span class="st">"ttot.beva"</span>,<span class="st">"progression.mbc"</span>, <span class="st">"os"</span>,<span class="st">"idfs"</span>,<span class="st">"ttot.early"</span>,<span class="st">"remission"</span>,<span class="st">"recurrence"</span>,<span class="st">"start.early.mbc"</span><span class="op">)</span>,
                       other_inp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"os.early"</span>,<span class="st">"os.mbc"</span><span class="op">)</span>,                       
                       input<span class="op">=</span><span class="op">{</span>  <span class="co">#reference strategy</span>
    <span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">0</span>

    <span class="co">#Early</span>
    
    <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span>,hr<span class="op">=</span><span class="va">hr_psa</span><span class="op">)</span> 
    <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span>,hr<span class="op">=</span><span class="va">hr_psa</span><span class="op">)</span>,<span class="va">idfs</span><span class="op">)</span>
    
    <span class="va">os.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef12_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span>,hr<span class="op">=</span><span class="va">hr_psa</span><span class="op">)</span> 
    
    <span class="co">#if patient has remission, check when will recurrence happen</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">fl.remission</span><span class="op">)</span> <span class="op">{</span> 
      <span class="va">recurrence</span> <span class="op">&lt;-</span> <span class="va">idfs</span> <span class="op">+</span><span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef11_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span>
      <span class="va">remission</span> <span class="op">&lt;-</span> <span class="va">idfs</span>
      
      <span class="co">#if recurrence happens before death</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span><span class="op">&gt;</span><span class="va">recurrence</span><span class="op">)</span> <span class="op">{</span> 
        
        <span class="co">#Late metastatic (after finishing idfs and recurrence)</span>
        
        <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef13_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span>  <span class="op">+</span>  <span class="va">recurrence</span> 
        
        <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span> 
        
        <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">idfs</span> <span class="op">+</span>  <span class="va">recurrence</span>
        
      <span class="op">}</span>
      
    <span class="op">}</span> <span class="kw">else</span><span class="op">{</span> <span class="co">#If early metastatic</span>
      <span class="va">start.early.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef15_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span>
      
      <span class="va">idfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span>
      <span class="va">ttot.early</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">start.early.mbc</span><span class="op">&lt;</span><span class="va">idfs</span>,<span class="va">start.early.mbc</span>,<span class="va">idfs</span><span class="op">)</span>,<span class="va">ttot.early</span><span class="op">)</span>
      
      <span class="va">os.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef13_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span>
      
      <span class="va">progression.mbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span>
      
      <span class="va">ttot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'lnorm'</span>,coef1<span class="op">=</span><span class="va">coef14_psa</span>, coef2<span class="op">=</span><span class="va">coef2_psa</span><span class="op">)</span> <span class="op">+</span> <span class="va">start.early.mbc</span>
      
      
    <span class="op">}</span>    
    <span class="va">os</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">os.mbc</span>,<span class="va">os.early</span>,<span class="va">nat.os.s</span><span class="op">)</span>
    
  <span class="op">}</span><span class="op">)</span></pre></div>
</div>
<div id="add-reaction-to-those-events" class="section level2">
<h2 class="hasAnchor">
<a href="#add-reaction-to-those-events" class="anchor"></a>Add Reaction to Those Events</h2>
<p>The reactions are set in the same fashion as in the original model. A small modification has been made in generating the event <code>2ndline_mbc</code>, which now also uses a random parameter if the PSA option is active.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">

<span class="va">evt_react_list</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"start"</span>,
               input <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ttot"</span>,
               input <span class="op">=</span> <span class="op">{</span>
                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"fl.mbcs.ontx"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is now off-treatment</span>
                 
               <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ttot.beva"</span>,
               input <span class="op">=</span> <span class="op">{</span>
                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"fl.tx.beva"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is now off-treatment</span>
                 
               <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"progression.mbc"</span>,
               input <span class="op">=</span> <span class="op">{</span>
                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"fl.mbcs.progression.mbc"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.mbcs_2ndline"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is progressed and going in 2nd line</span>
                 
                 <span class="fu"><a href="../reference/new_event.html">new_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"2ndline_mbc"</span> <span class="op">=</span> <span class="va">curtime</span> <span class="op">+</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">'exp'</span>, <span class="va">coef16_psa</span><span class="op">)</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span>
                 
               <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"idfs"</span>,
               input <span class="op">=</span> <span class="op">{</span>
                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"fl.idfs"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
                 
               <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ttot.early"</span>,
               input <span class="op">=</span> <span class="op">{</span>
                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"fl.idfs.ontx"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.tx.beva"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co">#Flag that patient is now off-treatment</span>
                 
                 <span class="va">n_ae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">1</span>,lambda<span class="op">=</span><span class="fl">0.25</span><span class="op">*</span><span class="op">(</span><span class="va">curtime</span> <span class="op">-</span><span class="va">prevtime</span><span class="op">)</span><span class="op">)</span> <span class="co">#1 AE every 4 years</span>
                 
                 <span class="kw">if</span> <span class="op">(</span><span class="va">n_ae</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
                   <span class="fu"><a href="../reference/new_event.html">new_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"ae"</span> <span class="op">=</span> <span class="va">curtime</span> <span class="op">+</span> <span class="fl">0.0001</span><span class="op">)</span>,<span class="va">n_ae</span><span class="op">)</span><span class="op">)</span>
                 <span class="op">}</span>
               <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"remission"</span>,
               input <span class="op">=</span> <span class="op">{</span>
                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"fl.remission"</span><span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
                 
               <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"recurrence"</span>,
               input <span class="op">=</span> <span class="op">{</span>
                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"fl.recurrence"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"fl.remission"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.mbcs"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"fl.mbcs.progression.mbc"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#ad-hoc for plot</span>
                 
               <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"start.early.mbc"</span>,
               input <span class="op">=</span> <span class="op">{</span>
                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"fl.mbcs"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"fl.mbcs.progression.mbc"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
                 
               <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"2ndline_mbc"</span>,
               input <span class="op">=</span> <span class="op">{</span>
                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"fl.mbcs_2ndline"</span><span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
                 
                 <span class="va">n_ae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">1</span>,lambda<span class="op">=</span><span class="fl">0.25</span><span class="op">*</span><span class="op">(</span><span class="va">curtime</span> <span class="op">-</span><span class="va">prevtime</span><span class="op">)</span><span class="op">)</span> <span class="co">#1 AE every 4 years</span>
                 
                 <span class="kw">if</span> <span class="op">(</span><span class="va">n_ae</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
                   <span class="fu"><a href="../reference/new_event.html">new_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"ae"</span> <span class="op">=</span> <span class="va">curtime</span> <span class="op">+</span> <span class="fl">0.0001</span><span class="op">)</span>,<span class="va">n_ae</span><span class="op">)</span><span class="op">)</span>
                 <span class="op">}</span>
               <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"ae"</span>,
               input <span class="op">=</span> <span class="op">{</span>
                 <span class="fu"><a href="../reference/modify_event.html">modify_event</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"os"</span> <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">cur_evtlist</span><span class="op">[[</span><span class="st">"os"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.125</span>,<span class="va">curtime</span> <span class="op">+</span><span class="fl">0.0001</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="co">#each AE brings forward death by 1.5 months</span>
               <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"os"</span>,
               input <span class="op">=</span> <span class="op">{</span>
                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"fl.tx.beva"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.mbcs.ontx"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.idfs"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"fl.mbcs"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"curtime"</span><span class="op">=</span><span class="cn">Inf</span><span class="op">)</span><span class="op">)</span> 
               <span class="op">}</span><span class="op">)</span> </pre></div>
</div>
</div>
<div id="costs-and-utilities" class="section level1">
<h1 class="hasAnchor">
<a href="#costs-and-utilities" class="anchor"></a>Costs and Utilities</h1>
<p>Costs and utilities are introduced below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">

<span class="va">util_ongoing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_util.html">add_util</a></span><span class="op">(</span>evt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"ttot"</span>,<span class="st">"ttot.beva"</span>,<span class="st">"progression.mbc"</span>,<span class="st">"os"</span>,<span class="st">"idfs"</span>,<span class="st">"ttot.early"</span>,<span class="st">"remission"</span>,<span class="st">"recurrence"</span>,<span class="st">"start.early.mbc"</span>,<span class="st">"2ndline_mbc"</span>,<span class="st">"ae"</span><span class="op">)</span>,
                              trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,
                              util <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
                                <span class="va">util.idfs.ontx</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.idfs.ontx</span><span class="op">)</span> 
                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.idfs</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
                                <span class="va">util.remission</span> <span class="op">*</span> <span class="va">fl.remission</span> <span class="op">+</span> <span class="va">fl.recurrence</span><span class="op">*</span><span class="va">util.recurrence</span>
                              <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">fl.mbcs</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
                                <span class="va">util.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span><span class="op">*</span><span class="va">util.mbc.pps</span>
                              <span class="op">}</span>
<span class="op">)</span>

<span class="va">cost_ongoing</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/add_cost.html">add_cost</a></span><span class="op">(</span>
    evt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"idfs"</span>,<span class="st">"ttot.early"</span><span class="op">)</span> ,
    trt <span class="op">=</span> <span class="st">"noint"</span>,
    cost <span class="op">=</span> <span class="va">cost.idfs.txnoint</span><span class="op">*</span> <span class="va">fl.idfs.ontx</span>  <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_cost.html">add_cost</a></span><span class="op">(</span>
    evt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"idfs"</span>,<span class="st">"ttot.early"</span><span class="op">)</span> ,
    trt <span class="op">=</span> <span class="st">"int"</span>,
    cost <span class="op">=</span> <span class="op">(</span><span class="va">cost.idfs.tx</span><span class="op">)</span> <span class="op">*</span> <span class="va">fl.idfs.ontx</span> <span class="op">+</span> <span class="va">cost.tx.beva</span> <span class="op">*</span> <span class="va">fl.tx.beva</span> <span class="op">+</span> <span class="va">cost.idfs</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_cost.html">add_cost</a></span><span class="op">(</span>
    evt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"remission"</span>,<span class="st">"recurrence"</span>,<span class="st">"start.early.mbc"</span><span class="op">)</span>,
    trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"noint"</span>,<span class="st">"int"</span><span class="op">)</span>,
    cost <span class="op">=</span> <span class="va">cost.recurrence</span> <span class="op">*</span> <span class="va">fl.recurrence</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_cost.html">add_cost</a></span><span class="op">(</span>
    evt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ttot"</span>,<span class="st">"ttot.beva"</span>,<span class="st">"progression.mbc"</span>,<span class="st">"os"</span>,<span class="st">"2ndline_mbc"</span><span class="op">)</span>,
    trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"noint"</span>,<span class="st">"int"</span><span class="op">)</span>,
    cost <span class="op">=</span> <span class="va">cost.mbc.tx</span>  <span class="op">*</span> <span class="va">fl.mbcs.ontx</span> <span class="op">+</span> <span class="va">cost.mbc.progression.mbc</span> <span class="op">*</span> <span class="va">fl.mbcs.progression.mbc</span> <span class="op">+</span> <span class="va">cost.mbc.pps</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.mbcs.progression.mbc</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.2ndline</span><span class="op">*</span><span class="va">fl.mbcs_2ndline</span>  <span class="op">)</span>


<span class="va">cost_instant</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/add_cost.html">add_cost</a></span><span class="op">(</span>
  evt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ae"</span><span class="op">)</span>,
  trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"noint"</span>,<span class="st">"int"</span><span class="op">)</span>,
  cost <span class="op">=</span> <span class="va">cost.ae</span><span class="op">)</span></pre></div>
</div>
<div id="model" class="section level1">
<h1 class="hasAnchor">
<a href="#model" class="anchor"></a>Model</h1>
<p>The model can now be executed as normal. Given that this modeling exercise relies on sampling from distributions and simulating a finite number of patients, there is some randomness involved that can affect the results, even under the assumption that the parameters are fixed. However, running more patients also means the simulation is slower, so there is a trade-off between accuracy and speed. An important question here is to understand how much of the uncertainty we observe when running a PSA comes from the parametric uncertainty and how much comes from the fact that we are simulating a finite sample.</p>
<div id="structural-uncertainty" class="section level2">
<h2 class="hasAnchor">
<a href="#structural-uncertainty" class="anchor"></a>Structural Uncertainty</h2>
<p>One way to test this is to run a few simulations for an increasing number of patients simulated. For example, below we run 50 deterministic simulations for 100, 1,000, 5,000 and 10,000 patients, to show how the model outcome can change depending on the random seed used. Note that this exercise can be very time consuming. It’s important to note that the optimal number of patients simulated will depend on the dispersion of the distributions, the patient pathway, the number of possible outcomes and the difference among these. For example, an event with low probability but high impact and variability implies a higher number of patients simulated in order to obtain stable outcomes.</p>
<p>To do this test, we set <code>psa_bool = FALSE</code> and (optional) we set <code>ipd = FALSE</code>. This last option means that we are not exporting IPD data from all these simulations, but rather the aggregate outcomes (and the last simulation, which is included by default). This is important when simulating a large number of patients with a lot of simulations, which can generate very large objects (&gt;1 GB). This option can also be especially relevant when running a PSA, which would require <code>psa_bool = TRUE</code> and a high number of simulations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">

<span class="va">sample_sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">1000</span>,<span class="fl">2000</span>,<span class="fl">5000</span><span class="op">)</span>

<span class="va">sim_size_df</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">sample_size</span> <span class="kw">in</span> <span class="va">sample_sizes</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span> <span class="co">#run without warnings</span>
      <span class="fu"><a href="../reference/RunSim.html">RunSim</a></span><span class="op">(</span>  
    npats<span class="op">=</span><span class="va">sample_size</span>,                        <span class="co"># number of patients to be simulated</span>
    n_sim<span class="op">=</span><span class="fl">50</span>,                                <span class="co"># number of simulations to run</span>
    psa_bool <span class="op">=</span> <span class="cn">FALSE</span>,                         <span class="co"># use PSA or not. If n_sim &gt; 1 and psa_bool = FALSE, then difference in outcomes is due to sampling (number of pats simulated)</span>
    trt_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             <span class="co"># intervention list</span>
    common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    <span class="co"># inputs common that do not change within a simulation</span>
    common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      <span class="co"># inputs that change within a simulation but are not affected by the intervention</span>
    unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,      <span class="co"># inputs that change within a simulation between interventions</span>
    init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        <span class="co"># initial event list</span>
    evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          <span class="co"># reaction of events</span>
    util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,
    cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,
    cost_instant_list <span class="op">=</span> <span class="va">cost_instant</span>,
    ncores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span>,<span class="fl">30</span><span class="op">)</span>, <span class="co"># number of cores to use, recommended not to use all</span>
    drc <span class="op">=</span> <span class="fl">0.035</span>,                              <span class="co"># discount rate for costs</span>
    drq <span class="op">=</span> <span class="fl">0.035</span>,                              <span class="co"># discount rate for qalys</span>
    ipd<span class="op">=</span><span class="cn">FALSE</span>                                 <span class="co"># Return IPD data through merged_df? Set to FALSE as it's not of interest here and it makes code slower</span>
  <span class="op">)</span><span class="op">)</span> 

  <span class="co">#We're extracting the overall ICER/ICUR and also costs/qalys/lys for the "noint" intervention</span>
  <span class="va">loop_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"costs"</span>,<span class="st">"noint"</span><span class="op">)</span>,
                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"lys"</span>,<span class="st">"noint"</span><span class="op">)</span>,
                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"qalys"</span>,<span class="st">"noint"</span><span class="op">)</span>,
                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"costs"</span>,<span class="st">"int"</span><span class="op">)</span>,
                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"lys"</span>,<span class="st">"int"</span><span class="op">)</span>,
                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"qalys"</span>,<span class="st">"int"</span><span class="op">)</span><span class="op">)</span>
  
    <span class="va">loop_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">loop_df</span>, <span class="va">loop_df</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op">(</span><span class="va">trt</span>,<span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dif <span class="op">=</span> <span class="va">int</span> <span class="op">-</span> <span class="va">noint</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">simulation</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">dif</span><span class="op">[</span><span class="va">element</span><span class="op">==</span><span class="st">"costs"</span><span class="op">]</span><span class="op">/</span><span class="va">dif</span><span class="op">[</span><span class="va">element</span><span class="op">==</span><span class="st">"qalys"</span><span class="op">]</span>,element <span class="op">=</span> <span class="st">"ICUR"</span>, trt<span class="op">=</span><span class="st">"noint"</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">element</span>, <span class="va">trt</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
    

  <span class="va">loop_df</span><span class="op">$</span><span class="va">sample_size</span> <span class="op">=</span> <span class="va">sample_size</span>
  <span class="va">sim_size_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">sim_size_df</span>,<span class="va">loop_df</span><span class="op">)</span>
  
<span class="op">}</span></pre></div>
<p>We can then plot the results (in this case, the costs, lys and qalys are for the “noint” intervention) <img src="example_uncertainty_files/figure-html/struct_uncertainty2-1.png" width="960"></p>
<p>We can also try to understand what is the relative size of the uncertainty provided by the sampling. We compute the coefficient of variation for the outcomes exported (costs, qalys, lys, ICER and ICUR). The first thing to be noticed is that the ICER and ICUR CV is much higher than for costs/lys/qalys. This is because of the incremental nature of ICER/ICUR, which means it’s more sensitive to small variations of these outputs. So while the costs/qalys/lys are quite precise with a reduced number of simulations (~1,000), in order to have a precise ICER/ICUR we need to go higher (~5,000/10,000). However, one can see that the mean is quite stable at ~5,000 patients.</p>
<table class="table table table-striped table-hover table-condensed table-responsive">
<thead><tr>
<th style="text-align:left;">
element
</th>
<th style="text-align:left;">
sample_size
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
CV (%)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
costs
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:right;">
268980.43
</td>
<td style="text-align:right;">
6107.00
</td>
<td style="text-align:right;">
2.27
</td>
</tr>
<tr>
<td style="text-align:left;">
costs
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:right;">
268026.72
</td>
<td style="text-align:right;">
1485.75
</td>
<td style="text-align:right;">
0.55
</td>
</tr>
<tr>
<td style="text-align:left;">
costs
</td>
<td style="text-align:left;">
2000
</td>
<td style="text-align:right;">
267939.00
</td>
<td style="text-align:right;">
1281.26
</td>
<td style="text-align:right;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
costs
</td>
<td style="text-align:left;">
5000
</td>
<td style="text-align:right;">
268127.83
</td>
<td style="text-align:right;">
732.68
</td>
<td style="text-align:right;">
0.27
</td>
</tr>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:right;">
117108.13
</td>
<td style="text-align:right;">
52072.71
</td>
<td style="text-align:right;">
44.47
</td>
</tr>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:right;">
103570.56
</td>
<td style="text-align:right;">
10493.57
</td>
<td style="text-align:right;">
10.13
</td>
</tr>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
2000
</td>
<td style="text-align:right;">
105886.33
</td>
<td style="text-align:right;">
6788.89
</td>
<td style="text-align:right;">
6.41
</td>
</tr>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
5000
</td>
<td style="text-align:right;">
104285.62
</td>
<td style="text-align:right;">
4792.93
</td>
<td style="text-align:right;">
4.60
</td>
</tr>
<tr>
<td style="text-align:left;">
lys
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:right;">
11.86
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
1.80
</td>
</tr>
<tr>
<td style="text-align:left;">
lys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:right;">
11.83
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.49
</td>
</tr>
<tr>
<td style="text-align:left;">
lys
</td>
<td style="text-align:left;">
2000
</td>
<td style="text-align:right;">
11.82
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.41
</td>
</tr>
<tr>
<td style="text-align:left;">
lys
</td>
<td style="text-align:left;">
5000
</td>
<td style="text-align:right;">
11.83
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.26
</td>
</tr>
<tr>
<td style="text-align:left;">
qalys
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:right;">
8.93
</td>
<td style="text-align:right;">
0.23
</td>
<td style="text-align:right;">
2.61
</td>
</tr>
<tr>
<td style="text-align:left;">
qalys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:right;">
8.90
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.79
</td>
</tr>
<tr>
<td style="text-align:left;">
qalys
</td>
<td style="text-align:left;">
2000
</td>
<td style="text-align:right;">
8.91
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.55
</td>
</tr>
<tr>
<td style="text-align:left;">
qalys
</td>
<td style="text-align:left;">
5000
</td>
<td style="text-align:right;">
8.91
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.37
</td>
</tr>
</tbody>
</table>
<p>We can plot the CV to see this more clearly: <img src="example_uncertainty_files/figure-html/struct_uncertainty4-1.png" width="960"></p>
</div>
<div id="parameter-uncertainty" class="section level2">
<h2 class="hasAnchor">
<a href="#parameter-uncertainty" class="anchor"></a>Parameter Uncertainty</h2>
<p>Structural uncertainty is not the only type of uncertainty that the model can have. Parameters can also be changed across simulations by using the <code>psa_bool = TRUE</code> option. Let’s see what happens when we compare the true PSA to the structural uncertainty with 1,000 patients.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">

<span class="va">sample_sizes</span> <span class="op">&lt;-</span> <span class="fl">1000</span>

<span class="va">sim_size_psa_df</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">sample_size</span> <span class="kw">in</span> <span class="va">sample_sizes</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="../reference/RunSim.html">RunSim</a></span><span class="op">(</span>  
    npats<span class="op">=</span><span class="va">sample_size</span>,                        <span class="co"># number of patients to be simulated</span>
    n_sim<span class="op">=</span><span class="fl">50</span>,                                <span class="co"># number of simulations to run</span>
    psa_bool <span class="op">=</span> <span class="cn">TRUE</span>,                         <span class="co"># use PSA or not. If n_sim &gt; 1 and psa_bool = FALSE, then difference in outcomes is due to sampling (number of pats simulated)</span>
    trt_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             <span class="co"># intervention list</span>
    common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    <span class="co"># inputs common that do not change within a simulation</span>
    common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      <span class="co"># inputs that change within a simulation but are not affected by the intervention</span>
    unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,      <span class="co"># inputs that change within a simulation between interventions</span>
    init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        <span class="co"># initial event list</span>
    evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          <span class="co"># reaction of events</span>
    util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,
    cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,
    cost_instant_list <span class="op">=</span> <span class="va">cost_instant</span>,
    ncores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span>,<span class="fl">30</span><span class="op">)</span>,      <span class="co"># number of cores to use, recommended not to use all</span>
    drc <span class="op">=</span> <span class="fl">0.035</span>,                              <span class="co"># discount rate for costs</span>
    drq <span class="op">=</span> <span class="fl">0.035</span>,                              <span class="co"># discount rate for qalys</span>
    ipd<span class="op">=</span><span class="cn">FALSE</span>                                 <span class="co"># Return IPD data through merged_df? Set to FALSE as it's not of interest here and it makes code slower</span>
  <span class="op">)</span><span class="op">)</span>

  <span class="co">#We're extracting the overall ICER/ICUR and also costs/qalys/lys for the "noint" intervention</span>
  <span class="va">loop_psa_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"costs"</span>,<span class="st">"noint"</span><span class="op">)</span>,
                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"lys"</span>,<span class="st">"noint"</span><span class="op">)</span>,
                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"qalys"</span>,<span class="st">"noint"</span><span class="op">)</span>,
                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"costs"</span>,<span class="st">"int"</span><span class="op">)</span>,
                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"lys"</span>,<span class="st">"int"</span><span class="op">)</span>,
                   <span class="fu"><a href="../reference/extract_psa_result.html">extract_psa_result</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>,<span class="st">"qalys"</span>,<span class="st">"int"</span><span class="op">)</span><span class="op">)</span>
  
    <span class="va">loop_psa_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">loop_psa_df</span>, <span class="va">loop_psa_df</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op">(</span><span class="va">trt</span>,<span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dif <span class="op">=</span> <span class="va">int</span> <span class="op">-</span> <span class="va">noint</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">simulation</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">dif</span><span class="op">[</span><span class="va">element</span><span class="op">==</span><span class="st">"costs"</span><span class="op">]</span><span class="op">/</span><span class="va">dif</span><span class="op">[</span><span class="va">element</span><span class="op">==</span><span class="st">"qalys"</span><span class="op">]</span>,element <span class="op">=</span> <span class="st">"ICUR"</span>, trt<span class="op">=</span><span class="st">"noint"</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">element</span>, <span class="va">trt</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">loop_psa_df</span><span class="op">$</span><span class="va">sample_size</span> <span class="op">=</span> <span class="va">sample_size</span>
  <span class="va">sim_size_psa_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">sim_size_psa_df</span>,<span class="va">loop_psa_df</span><span class="op">)</span>
  
<span class="op">}</span></pre></div>
<p>Now the uncertainty is much bigger when compared to the same case with 1,000 iterations and no parameter uncertainty.</p>
<table class="table table table-striped table-hover table-condensed table-responsive">
<thead><tr>
<th style="text-align:left;">
element
</th>
<th style="text-align:left;">
sample_size
</th>
<th style="text-align:left;">
uncertainty
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
CV (%)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
costs
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural
</td>
<td style="text-align:right;">
268026.72
</td>
<td style="text-align:right;">
1485.75
</td>
<td style="text-align:right;">
0.55
</td>
</tr>
<tr>
<td style="text-align:left;">
costs
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural + parameter
</td>
<td style="text-align:right;">
261303.30
</td>
<td style="text-align:right;">
36746.25
</td>
<td style="text-align:right;">
14.06
</td>
</tr>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural
</td>
<td style="text-align:right;">
103570.56
</td>
<td style="text-align:right;">
10493.57
</td>
<td style="text-align:right;">
10.13
</td>
</tr>
<tr>
<td style="text-align:left;">
ICUR
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural + parameter
</td>
<td style="text-align:right;">
107143.78
</td>
<td style="text-align:right;">
45121.40
</td>
<td style="text-align:right;">
42.11
</td>
</tr>
<tr>
<td style="text-align:left;">
lys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural
</td>
<td style="text-align:right;">
11.83
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
0.49
</td>
</tr>
<tr>
<td style="text-align:left;">
lys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural + parameter
</td>
<td style="text-align:right;">
11.79
</td>
<td style="text-align:right;">
0.45
</td>
<td style="text-align:right;">
3.85
</td>
</tr>
<tr>
<td style="text-align:left;">
qalys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural
</td>
<td style="text-align:right;">
8.90
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.79
</td>
</tr>
<tr>
<td style="text-align:left;">
qalys
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
structural + parameter
</td>
<td style="text-align:right;">
8.88
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
3.89
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ceacceaf-and-evpi" class="section level1">
<h1 class="hasAnchor">
<a href="#ceacceaf-and-evpi" class="anchor"></a>CEAC/CEAF and EVPI</h1>
<p>When a PSA is run, additional analyses can be performed to understand the importance and behavior of uncertainty. Let’s run our model for 2,000 patients in 100 simulations.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">

  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="../reference/RunSim.html">RunSim</a></span><span class="op">(</span>  
    npats<span class="op">=</span><span class="fl">2000</span>,                        <span class="co"># number of patients to be simulated</span>
    n_sim<span class="op">=</span><span class="fl">100</span>,                                <span class="co"># number of simulations to run</span>
    psa_bool <span class="op">=</span> <span class="cn">TRUE</span>,                         <span class="co"># use PSA or not. If n_sim &gt; 1 and psa_bool = FALSE, then difference in outcomes is due to sampling (number of pats simulated)</span>
    trt_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             <span class="co"># intervention list</span>
    common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    <span class="co"># inputs common that do not change within a simulation</span>
    common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      <span class="co"># inputs that change within a simulation but are not affected by the intervention</span>
    unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,      <span class="co"># inputs that change within a simulation between interventions</span>
    init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        <span class="co"># initial event list</span>
    evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          <span class="co"># reaction of events</span>
    util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,
    cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,
    cost_instant_list <span class="op">=</span> <span class="va">cost_instant</span>,
    ncores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span>,<span class="fl">30</span><span class="op">)</span>,      <span class="co"># number of cores to use, recommended not to use all</span>
    drc <span class="op">=</span> <span class="fl">0.035</span>,                              <span class="co"># discount rate for costs</span>
    drq <span class="op">=</span> <span class="fl">0.035</span>,                              <span class="co"># discount rate for qalys</span>
    ipd<span class="op">=</span><span class="cn">FALSE</span>                                 <span class="co"># Return IPD data through merged_df? Set to FALSE as it's not of interest here and it makes code slower</span>
  <span class="op">)</span><span class="op">)</span></pre></div>
<div id="ceacceaf" class="section level2">
<h2 class="hasAnchor">
<a href="#ceacceaf" class="anchor"></a>CEAC/CEAF</h2>
<p>We can now use the <code>ceac_des</code> function with a vector of willingness to pay and the results of our PSA to generate the CEAC and CEAF plots.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">

<span class="va">wtp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0</span>,to<span class="op">=</span><span class="fl">150000</span>,by<span class="op">=</span><span class="fl">1000</span><span class="op">)</span>
<span class="va">ceac_out</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/ceac_des.html">ceac_des</a></span><span class="op">(</span><span class="va">wtp</span>,<span class="va">results</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ceac_out</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">wtp</span>,y<span class="op">=</span><span class="va">prob_best</span>,group<span class="op">=</span><span class="va">comparator</span>,col<span class="op">=</span><span class="va">comparator</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Willingness to Pay"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Probability of being cost-effective"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Cost Effectiveness Acceptability Curve (CEAC)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="example_uncertainty_files/figure-html/ceac_ceaf-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit">


<span class="va">ceaf</span> <span class="op">&lt;-</span> <span class="va">ceac_out</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">wtp</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>max_prob<span class="op">=</span><span class="va">prob_best</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">prob_best</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">max_prob</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ceaf</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">wtp</span>,y<span class="op">=</span><span class="va">prob_best</span>,group<span class="op">=</span><span class="va">comparator</span>,col<span class="op">=</span><span class="va">comparator</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Willingness to Pay"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Probability of being cost-effective"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Cost Effectiveness Acceptability Frontier (CEAF)"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="example_uncertainty_files/figure-html/ceac_ceaf-2.png" width="700"></p>
</div>
<div id="evpi" class="section level2">
<h2 class="hasAnchor">
<a href="#evpi" class="anchor"></a>EVPI</h2>
<p>Similarly to <code>ceac_des</code>, the function <code>evpi_des</code> also allows to compute the EVPI.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">

<span class="va">evpi_out</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/evpi_des.html">evpi_des</a></span><span class="op">(</span><span class="va">wtp</span>,<span class="va">results</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">evpi_out</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">wtp</span>,y<span class="op">=</span><span class="va">evpi</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Willingness to Pay"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"EVPI"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Expected Value of Perfect Information (EVPI)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="example_uncertainty_files/figure-html/evpi-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Valerie Aponte Ribero, Javier Sanchez Alvarez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
