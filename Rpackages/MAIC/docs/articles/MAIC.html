<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Matching-Adjusted Indirect Comparison: Example using the <tt>MAIC</tt> package • MAIC</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Matching-Adjusted Indirect Comparison: Example using the &lt;tt&gt;MAIC&lt;/tt&gt; package">
<meta property="og:description" content="MAIC">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-181075487-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-181075487-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MAIC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/MAIC.html">Vignette</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/flexsurvPlus/docs/index.html">flexsurvPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/gemtcPlus/docs/index.html">gemtcPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/MAIC/docs/index.html">MAIC</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/rpsftmPlus/docs/index.html">rpsftmPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/Rpackages/descem/docs/index.html">descem</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Roche/Global-HTA-Evidence-Open/tree/master/Rpackages/MAIC">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MAIC_files/header-attrs-2.5/header-attrs.js"></script><script src="MAIC_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="MAIC_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="MAIC_files/anchor-sections-1.0/anchor-sections.js"></script><link href="MAIC_files/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<script src="MAIC_files/tabwid-1.0.0/tabwid.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Matching-Adjusted Indirect Comparison: Example using the <tt>MAIC</tt> package</h1>
                        <h4 class="author">Roche</h4>
            
            <h4 class="date">2021-07-08</h4>
      
      
      <div class="hidden name"><code>MAIC.Rmd</code></div>

    </div>

    
    
<style type="text/css">

body{ /* Normal  */
      font-size: 14px;
  }
td {  /* Table  */
  font-size: 10px;
}
h1.title {
  font-size: 38px;
}
h1 { /* Header 1 */
  font-size: 28px;
  }
h2 { /* Header 2 */
    font-size: 22px;
}
h3 { /* Header 3 */
  font-size: 18px;
}
code.r{ /* Code block */
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
</style>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This document describes the steps required to perform a matching-adjusted indirect comparison (MAIC) analysis using the <tt>MAIC</tt> package in R for a disconnected treatment network where the endpoint of interest is either time-to-event (e.g. overall survival) or binary (e.g. objective tumor response).</p>
<p>The methods described in this document are based on those originally described by Signorovitch et al. 2012 and described in the National Institute for Health and Care Excellence (NICE) Decision Support Unit (DSU) Technical Support Document (TSD) 18.<span class="citation">[1,2]</span></p>
<p>MAIC methods are often required when:</p>
<ul>
<li>There is no common comparator treatment to link a clinical trial of a new intervention to clinical trials of other treatments in a given disease area. For example if the only study of a new intervention is a single arm trial with no control group. This is commonly referred to as an unanchored MAIC.</li>
<li>A common comparator is available to link a clinical trial of a new intervention to a clinical trial of one other treatment in a given disease area but there are substantial differences in patient demographic or disease characteristics that are believed to be either prognostic or treatment effect modifiers. This is commonly referred to as an anchored MAIC.</li>
</ul>
<p>The premise of MAIC methods is to adjust for between-trial differences in patient demographic or disease characteristics at baseline. When a common treatment comparator or ‘linked network’ are unavailable, a MAIC assumes that differences between absolute outcomes that would be observed in each trial are entirely explained by imbalances in prognostic variables and treatment effect modifiers. Prognostic variables are those that are predictive of disease outcomes, independent of the treatment received. For example, older patients may have increased risk of death compared to younger patients. Treatment effect modifiers are those variables that influence the relative effect of one treatment compared to another. For example patients with a better performance status may experience a larger treatment benefit than those with a worse performance status. Under this assumption, every prognostic variable and every treatment effect modifier that is imbalanced between the two studies must be available. This assumption is generally considered very difficult to meet.<span class="citation">[2]</span> There are several ways of identifying prognostic variables/treatment effect modifiers to be used in the MAIC analyses, some of which include:</p>
<ul>
<li>Clinical expertise (when available to a project)</li>
<li>Published papers/previous submissions (what has been identified in the disease area previously)</li>
<li>Univariable/multivariable regression analyses to identify which covariates have a significant effect on the outcome</li>
<li>Subgroup analyses of clinical trials may identify interactions between patient characteristics and the relative treatment effect</li>
</ul>
<div id="example-scenario" class="section level2">
<h2 class="hasAnchor">
<a href="#example-scenario" class="anchor"></a>Example Scenario</h2>
<p>For the purposes of this example, we present an unanchored MAIC of two treatments in lung cancer with the treatments being compared labelled ‘intervention’ and ‘comparator’. The two endpoints being compared are overall survival (a time to event outcome) and objective response (a binary outcome). The data used in this example have been simulated to resemble that of clinical trial data. The data available are:</p>
<ul>
<li>Individual patient data from a single arm study of ‘intervention’</li>
<li>Aggregate summary data for ‘comparator’. This could be from a single arm study of the comparator or from one arm of a randomized controlled trial.</li>
<li>Psuedo patient data from the comparator study. This is not required for the matching process but is needed to derive the relative treatment effects between the intervention and comparator.</li>
</ul>
<p>In this example scenario, age, sex, the Eastern Cooperative Oncology Group performance status (ECOG PS) and smoking status have been identified as imbalanced prognostic variables/treatment effect modifiers.</p>
</div>
</div>
<div id="set-up-packages-and-data" class="section level1">
<h1 class="hasAnchor">
<a href="#set-up-packages-and-data" class="anchor"></a>Set up packages and data</h1>
<div id="install-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#install-packages" class="anchor"></a>Install packages</h2>
<p>The following packages are required to run this example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">boot</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival">survival</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">MAIC</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/survminer/">survminer</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://davidgohel.github.io/flextable/">flextable</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ardata-fr.github.io/officeverse/">officer</a></span><span class="op">)</span>
<span class="co"># set seed to give reproducible example</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1894</span><span class="op">)</span></pre></div>
</div>
<div id="read-in-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#read-in-the-data" class="anchor"></a>Read in the data</h2>
<p>To perform unanchored MAICs, the following data is required:</p>
<ul>
<li>Individual patient data (IPD) from the intervention trial</li>
<li>Baseline data from the comparator trial</li>
<li>Pseudo data for the comparator trial (see <a href="#comp">Comparator pseudo data</a>)</li>
</ul>
<p>Simulated data for the above is provided with the <tt>MAIC</tt> package.</p>
<div id="intervention-trial-ipd" class="section level3">
<h3 class="hasAnchor">
<a href="#intervention-trial-ipd" class="anchor"></a>Intervention trial IPD</h3>
<p>This example reads in and combines data from three standard simulated data sets (adsl, adrs and adtte) which are saved as ‘.csv’ files. The data may need some manipulation to standardize the variable names to ensure they are the same in all datasets.</p>
<p>The variables needed for the time to event analyses are:</p>
<ul>
<li>Time - a numeric variable</li>
<li>Event - a binary variable (event=1, censor=0)</li>
<li>Treatment - a character variable with the name of the intervention treatment</li>
</ul>
<p>The variables needed for the binary event analyses are:</p>
<ul>
<li>Response - a binary variable (event=1, no event=0)</li>
<li>Treatment - a character variable with the name of the intervention treatment</li>
</ul>
<p>For the matching variables:</p>
<ul>
<li>All binary variables to be used in the matching should be coded 1 and 0 (see example for sex below).</li>
<li>The variable names need to be listed in a character vector called <tt>match_cov</tt>.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co">#### Intervention data</span>

<span class="co"># Read in ADaM data and rename variables of interest</span>

<span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"adsl.csv"</span>, package <span class="op">=</span> <span class="st">"MAIC"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">adrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"adrs.csv"</span>, package <span class="op">=</span> <span class="st">"MAIC"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">adtte</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"adtte.csv"</span>, package <span class="op">=</span> <span class="st">"MAIC"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">adsl</span> <span class="op">&lt;-</span> <span class="va">adsl</span> <span class="op">%&gt;%</span> <span class="co"># Data containing the matching variables</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>SEX<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">SEX</span><span class="op">==</span><span class="st">"Male"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co"># Coded 1 for males and 0 for females</span>

<span class="va">adrs</span> <span class="op">&lt;-</span> <span class="va">adrs</span> <span class="op">%&gt;%</span> <span class="co"># Response data</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PARAM</span><span class="op">==</span><span class="st">"Response"</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">ARM</span>, response<span class="op">=</span><span class="va">AVAL</span><span class="op">)</span>

<span class="va">adtte</span> <span class="op">&lt;-</span> <span class="va">adtte</span> <span class="op">%&gt;%</span> <span class="co"># Time to event data (overall survival)</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PARAMCD</span><span class="op">==</span><span class="st">"OS"</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Event<span class="op">=</span><span class="fl">1</span><span class="op">-</span><span class="va">CNSR</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#Set up coding as Event = 1, Censor = 0</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">ARM</span>, Time<span class="op">=</span><span class="va">AVAL</span>, <span class="va">Event</span><span class="op">)</span>

<span class="co"># Combine all intervention data</span>
<span class="va">intervention_input</span> <span class="op">&lt;-</span> <span class="va">adsl</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">adrs</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"ARM"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">adtte</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"ARM"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">intervention_input</span><span class="op">)</span>
<span class="co">#&gt;   USUBJID ARM AGE SEX SMOKE ECOG0 response     Time Event</span>
<span class="co">#&gt; 1       1   A  45   1     0     0        0 281.5195     0</span>
<span class="co">#&gt; 2       2   A  71   1     0     0        1 500.0000     0</span>
<span class="co">#&gt; 3       3   A  58   1     1     1        1 304.6406     0</span>
<span class="co">#&gt; 4       4   A  48   0     0     1        1 102.4731     0</span>
<span class="co">#&gt; 5       5   A  69   1     0     1        0 101.6632     0</span>
<span class="co">#&gt; 6       6   A  48   0     0     1        0 237.0593     1</span>

<span class="co"># List out matching covariates</span>
<span class="va">match_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AGE"</span>,
               <span class="st">"SEX"</span>,
               <span class="st">"SMOKE"</span>,
               <span class="st">"ECOG0"</span><span class="op">)</span></pre></div>
</div>
<div id="baseline-data-from-the-comparator-trial" class="section level3">
<h3 class="hasAnchor">
<a href="#baseline-data-from-the-comparator-trial" class="anchor"></a>Baseline data from the comparator trial</h3>
<p>The aggregate baseline characteristics (number of patients, mean and SD for continuous variables and proportion for binary variables) from the comparator trial are needed as a data frame. Naming of the covariates in this data frame (named below as <tt>target_pop_standard</tt>) should be consistent with the intervention data (<tt>intervention_input</tt>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># Baseline aggregate data for the comparator population</span>
<span class="va">target_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Aggregate data.csv"</span>,
                                   package <span class="op">=</span> <span class="st">"MAIC"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Renames target population cols to be consistent with match_cov</span>
<span class="va">match_cov</span>
<span class="co">#&gt; [1] "AGE"   "SEX"   "SMOKE" "ECOG0"</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">target_pop</span><span class="op">)</span>
<span class="co">#&gt;  [1] "N"          "age.mean"   "age.sd"     "N.male"     "prop.male" </span>
<span class="co">#&gt;  [6] "N.ecog0"    "prop.ecog0" "N.smoke"    "prop.smoke" "ARM"</span>
<span class="va">target_pop_standard</span> <span class="op">&lt;-</span> <span class="va">target_pop</span> <span class="op">%&gt;%</span>
  <span class="co">#EDIT</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>N<span class="op">=</span><span class="va">N</span>,
          Treatment<span class="op">=</span><span class="va">ARM</span>,
          AGE<span class="op">=</span><span class="va">age.mean</span>,
          SEX<span class="op">=</span><span class="va">prop.male</span>,
          SMOKE<span class="op">=</span><span class="va">prop.smoke</span>,
          ECOG0<span class="op">=</span><span class="va">prop.ecog0</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">Treatment</span>, <span class="va">AGE</span>, <span class="va">SEX</span>, <span class="va">SMOKE</span>, <span class="va">ECOG0</span><span class="op">)</span>

<span class="va">target_pop_standard</span>
<span class="co">#&gt;     N  Treatment      AGE  SEX     SMOKE ECOG0</span>
<span class="co">#&gt; 1 300 Comparator 50.06333 0.49 0.1933333  0.35</span></pre></div>
</div>
</div>
</div>
<div id="estimate-weights" class="section level1">
<h1 class="hasAnchor">
<a href="#estimate-weights" class="anchor"></a>Estimate weights</h1>
<div id="statistical-theory" class="section level2">
<h2 class="hasAnchor">
<a href="#statistical-theory" class="anchor"></a>Statistical theory</h2>
<p>As described by Signorovitch et al. (supplemental appendix), we must find a <span class="math inline">\(\beta\)</span>, such that re-weighting baseline characteristics for the intervention, <span class="math inline">\(x_{i,ild}\)</span> exactly matches the mean baseline characteristics for the comparator data source for which only aggregate data is available.<span class="citation">[1]</span></p>
<p>The weights are given by: <span class="math display">\[\hat{\omega}_i=\exp{(x_{i,ild}.\beta)}\qquad (1)\]</span> That is, we must find a solution to: <span class="math display">\[
\bar{x}_{agg}\sum_{i=1}^n \exp{(x_{i,ild}.\beta)}  = \sum_{i=1}^n
x_{i,ild}.\exp{(x_{i,ild}.\beta)}\qquad (2)  \]</span> This estimator is equivalent to solving the equation <span class="math display">\[ 0 = \sum_{i=1}^n (x_{i,ild} -  \bar{x}_{agg}
).\exp{(x_{i,ild}.\beta)}\qquad (3)\]</span> without loss of generality, it can be assumed that <span class="math inline">\(\bar{x}_{agg} = 0\)</span> (e.g we could transform baseline characteristics in both trials by subtracting <span class="math inline">\(\bar{x}_{agg}\)</span>) leaving the estimator <span class="math display">\[0 = \sum_{i=1}^n
(x_{i,ild})\exp{(x_{i,ild}.\beta)}\qquad (4)\]</span> The right hand side of this estimator is the first derivative of <span class="math display">\[ Q(\beta) = \sum_{i=1}^n  \exp{(x_{i,ild}.\beta)}\qquad (5) \]</span> As described by Signorovitch et al (supplemental appendix), <span class="math inline">\(Q(\beta)\)</span> is convex and therefore any finite solution to (2) is unique and corresponds to the global minimum of <span class="math inline">\(Q(\beta)\)</span>.</p>
<p>In order to facilitate estimation of patient weights, <span class="math inline">\(\hat{\omega}_i\)</span>, it is necessary to center the baseline characteristics of the intervention data using the mean baseline characteristics from the comparator data.</p>
<p>As described by Phillippo, balancing on both mean and standard deviation for continuous variables (where possible) may be considered in some cases. This is included in the example below.<span class="citation">[2]</span></p>
<p>The code below also specifies an object (<tt>cent_match_cov</tt>) that contains the names of the centered matching variables - this will be needed for the analyses below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co">#### center baseline characteristics</span>
<span class="co"># (subtract the aggregate comparator data from the corresponding column of intervention PLD)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">intervention_input</span><span class="op">)</span>
<span class="co">#&gt; [1] "USUBJID"  "ARM"      "AGE"      "SEX"      "SMOKE"    "ECOG0"    "response"</span>
<span class="co">#&gt; [8] "Time"     "Event"</span>

<span class="va">intervention_data</span> <span class="op">&lt;-</span> <span class="va">intervention_input</span> <span class="op">%&gt;%</span>
         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Age_centered <span class="op">=</span> <span class="va">AGE</span> <span class="op">-</span> <span class="va">target_pop</span><span class="op">$</span><span class="va">age.mean</span>,
                <span class="co"># matching on both mean and standard deviation for continuous variable (optional)</span>
                Age_squared_centered <span class="op">=</span> <span class="op">(</span><span class="va">AGE</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">target_pop</span><span class="op">$</span><span class="va">age.mean</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">target_pop</span><span class="op">$</span><span class="va">age.sd</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,
                Sex_centered <span class="op">=</span> <span class="va">SEX</span> <span class="op">-</span> <span class="va">target_pop</span><span class="op">$</span><span class="va">prop.male</span>,
                Smoke_centered <span class="op">=</span> <span class="va">SMOKE</span> <span class="op">-</span> <span class="va">target_pop</span><span class="op">$</span><span class="va">prop.smoke</span>,
                ECOG0_centered <span class="op">=</span> <span class="va">ECOG0</span> <span class="op">-</span> <span class="va">target_pop</span><span class="op">$</span><span class="va">prop.ecog0</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">intervention_data</span><span class="op">)</span>
<span class="co">#&gt;   USUBJID ARM AGE SEX SMOKE ECOG0 response     Time Event Age_centered</span>
<span class="co">#&gt; 1       1   A  45   1     0     0        0 281.5195     0    -5.063333</span>
<span class="co">#&gt; 2       2   A  71   1     0     0        1 500.0000     0    20.936667</span>
<span class="co">#&gt; 3       3   A  58   1     1     1        1 304.6406     0     7.936667</span>
<span class="co">#&gt; 4       4   A  48   0     0     1        1 102.4731     0    -2.063333</span>
<span class="co">#&gt; 5       5   A  69   1     0     1        0 101.6632     0    18.936667</span>
<span class="co">#&gt; 6       6   A  48   0     0     1        0 237.0593     1    -2.063333</span>
<span class="co">#&gt;   Age_squared_centered Sex_centered Smoke_centered ECOG0_centered</span>
<span class="co">#&gt; 1            -491.8049         0.51     -0.1933333          -0.35</span>
<span class="co">#&gt; 2            2524.1951         0.51     -0.1933333          -0.35</span>
<span class="co">#&gt; 3             847.1951         0.51      0.8066667           0.65</span>
<span class="co">#&gt; 4            -212.8049        -0.49     -0.1933333           0.65</span>
<span class="co">#&gt; 5            2244.1951         0.51     -0.1933333           0.65</span>
<span class="co">#&gt; 6            -212.8049        -0.49     -0.1933333           0.65</span>

<span class="co"># Set matching covariates</span>
<span class="va">cent_match_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Age_centered"</span>,
                    <span class="st">"Age_squared_centered"</span>,
                    <span class="st">"Sex_centered"</span>,
                    <span class="st">"Smoke_centered"</span>,
                    <span class="st">"ECOG0_centered"</span><span class="op">)</span></pre></div>
</div>
<div id="optimization-procedure" class="section level2">
<h2 class="hasAnchor">
<a href="#optimization-procedure" class="anchor"></a>Optimization procedure</h2>
<p>Following the centering of the baseline characteristics of the intervention study, patient weights can be estimated using the <tt>estimate_weights</tt> function in the <tt>MAIC</tt> package. This performs an optimization procedure to minimize <span class="math inline">\(Q(\beta) = \sum_{i=1}^n \exp{(x_{i,ild}.\beta)}\)</span> and outputs a list containing:</p>
<ul>
<li>A character vector containing the names of the matching variables</li>
<li>An analysis data frame of the intervention data with weights</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">est_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_weights.html">estimate_weights</a></span><span class="op">(</span>intervention_data <span class="op">=</span> <span class="va">intervention_data</span>,
                                matching_vars <span class="op">=</span> <span class="va">cent_match_cov</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span><span class="op">)</span>
<span class="co">#&gt;   USUBJID          ARM AGE SEX SMOKE ECOG0 response     Time Event Age_centered</span>
<span class="co">#&gt; 1       1 Intervention  45   1     0     0        0 281.5195     0    -5.063333</span>
<span class="co">#&gt; 2       2 Intervention  71   1     0     0        1 500.0000     0    20.936667</span>
<span class="co">#&gt; 3       3 Intervention  58   1     1     1        1 304.6406     0     7.936667</span>
<span class="co">#&gt; 4       4 Intervention  48   0     0     1        1 102.4731     0    -2.063333</span>
<span class="co">#&gt; 5       5 Intervention  69   1     0     1        0 101.6632     0    18.936667</span>
<span class="co">#&gt; 6       6 Intervention  48   0     0     1        0 237.0593     1    -2.063333</span>
<span class="co">#&gt;   Age_squared_centered Sex_centered Smoke_centered ECOG0_centered           wt</span>
<span class="co">#&gt; 1            -491.8049         0.51     -0.1933333          -0.35 1.301506e+00</span>
<span class="co">#&gt; 2            2524.1951         0.51     -0.1933333          -0.35 7.024764e-08</span>
<span class="co">#&gt; 3             847.1951         0.51      0.8066667           0.65 6.384284e-02</span>
<span class="co">#&gt; 4            -212.8049        -0.49     -0.1933333           0.65 1.204094e+00</span>
<span class="co">#&gt; 5            2244.1951         0.51     -0.1933333           0.65 1.371621e-06</span>
<span class="co">#&gt; 6            -212.8049        -0.49     -0.1933333           0.65 1.204094e+00</span>
<span class="co">#&gt;          wt_rs</span>
<span class="co">#&gt; 1 3.457953e+00</span>
<span class="co">#&gt; 2 1.866400e-07</span>
<span class="co">#&gt; 3 1.696231e-01</span>
<span class="co">#&gt; 4 3.199141e+00</span>
<span class="co">#&gt; 5 3.644239e-06</span>
<span class="co">#&gt; 6 3.199141e+00</span>

<span class="va">est_weights</span><span class="op">$</span><span class="va">matching_vars</span>
<span class="co">#&gt; [1] "Age_centered"         "Age_squared_centered" "Sex_centered"        </span>
<span class="co">#&gt; [4] "Smoke_centered"       "ECOG0_centered"</span></pre></div>
</div>
<div id="weight-diagnostics" class="section level2">
<h2 class="hasAnchor">
<a href="#weight-diagnostics" class="anchor"></a>Weight diagnostics</h2>
<p>Following the calculation of weights, it is necessary to determine whether the optimization procedure has worked correctly and whether the weights derived are sensible.</p>
<div id="are-the-weights-sensible" class="section level3">
<h3 class="hasAnchor">
<a href="#are-the-weights-sensible" class="anchor"></a>Are the weights sensible?</h3>
<div id="effective-sample-size" class="section level4">
<h4 class="hasAnchor">
<a href="#effective-sample-size" class="anchor"></a>Effective sample size</h4>
<p>For a weighted estimate, the effective sample size (ESS) is the number of independent non-weighted individuals that would be required to give an estimate with the same precision as the weighted sample estimate. The approximate effective sample size is calculated as: <span class="math display">\[ ESS =  \frac{({ \sum_{i=1}^n
\hat{\omega}_i })^2}{ \sum_{i=1}^n \hat{\omega^2}_i  } \]</span> A small ESS, relative to the original sample size, is an indication that the weights are highly variable and that the estimate may be unstable. This often occurs if there is very limited overlap in the distribution of the matching variables between the populations being compared. If there is insufficient overlap between populations it may not be possible to obtain reliable estimates of the weights</p>
<p>The <tt>MAIC</tt> package includes a function to estimate the ESS:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">ESS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_ess.html">estimate_ess</a></span><span class="op">(</span><span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span><span class="op">)</span>
<span class="va">ESS</span>
<span class="co">#&gt; [1] 157.0715</span></pre></div>
<p>In this example, the ESS is 31% of the total number of patients in the intervention arm (500 patients in total). As this is a considerable reduction from the total number of patients, estimates using this weighted data may be unreliable. The reliability of the estimate could be explored by considering matching on a subset of the matching variables, for example, those considered most important. However, unless all prognostic factors and effect modifiers are included in the adjustment, the estimates will remain biased.<span class="citation">[2,3]</span></p>
</div>
<div id="rescaled-weights" class="section level4">
<h4 class="hasAnchor">
<a href="#rescaled-weights" class="anchor"></a>Rescaled weights</h4>
<p>It is easier to examine the distribution of the weights by scaling them, so that the rescaled weights are relative to the original unit weights of each individual. In other words, a rescaled weight <span class="math inline">\(&gt;\)</span> 1 means that an individual carries more weight in the re-weighted population than the original data and a rescaled weight <span class="math inline">\(&lt;\)</span> 1 means that an individual carries less weight in the re-weighted population than the original data. The rescaled weights are calculated as:</p>
<p><span class="math display">\[\tilde{\omega}_i  =  \frac{  \hat{\omega}_i}{ \sum_{i=1}^n \hat{\omega}_i }.N \]</span></p>
<p>A histogram of the rescaled weights (along with a histogram of the weights) can be produced using the <tt>hist_wts</tt> function in the <tt>MAIC</tt> package. <tt>bin_width</tt> needs to be adapted depending on the sample size in the data set by using the <tt>bin</tt> statement.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co"># Plot histograms of unscaled and rescaled weights</span>
<span class="co"># bin_width needs to be adapted depending on the sample size in the data set</span>
<span class="va">histogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hist_wts.html">hist_wts</a></span><span class="op">(</span><span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span>, bin <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="va">histogram</span></pre></div>
<p><img src="MAIC_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>The distribution of rescaled weights can be further explored by producing a summary of the mean, standard deviation, median, minimum and maximum rescaled weight. The <tt>MAIC</tt> package includes the <tt>summarize_wts</tt> function to produce this summary for the rescaled weights and the weights.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">weight_summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_wts.html">summarize_wts</a></span><span class="op">(</span><span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span><span class="op">)</span>
<span class="va">weight_summ</span>
<span class="co">#&gt;               type      mean       sd     median          min      max</span>
<span class="co">#&gt; 1          Weights 0.3763805 0.556692 0.03467630 1.855194e-11 2.373310</span>
<span class="co">#&gt; 2 Rescaled weights 1.0000000 1.479067 0.09213098 4.929037e-11 6.305614</span></pre></div>
<p>To understand which individuals are carrying more or less weight in the re-weighted population than the original data the <tt>profile_wts</tt> function in the <tt>MAIC</tt> package creates a data set with a unique set of weights and the corresponding patient profile based on the matching variables. When matching on a continuous variable there will be multiple unique weights and the output from this function is less useful. When there is a small set of unique weights <tt>profile_wts</tt> is useful to describe those patients who have more or less influence on the weighted analyses.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">wts_profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profile_wts.html">profile_wts</a></span><span class="op">(</span><span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span>, vars <span class="op">=</span> <span class="va">match_cov</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">wts_profile</span><span class="op">)</span>
<span class="co">#&gt;   AGE SEX SMOKE ECOG0           wt        wt_rs</span>
<span class="co">#&gt; 1  45   1     0     0 1.301506e+00 3.457953e+00</span>
<span class="co">#&gt; 2  71   1     0     0 7.024764e-08 1.866400e-07</span>
<span class="co">#&gt; 3  58   1     1     1 6.384284e-02 1.696231e-01</span>
<span class="co">#&gt; 4  48   0     0     1 1.204094e+00 3.199141e+00</span>
<span class="co">#&gt; 5  69   1     0     1 1.371621e-06 3.644239e-06</span>
<span class="co">#&gt; 6  47   1     1     0 1.010290e+00 2.684226e+00</span></pre></div>
</div>
<div id="overall-weight-diagnostics-summary-function" class="section level4">
<h4 class="hasAnchor">
<a href="#overall-weight-diagnostics-summary-function" class="anchor"></a>Overall weight diagnostics summary function</h4>
<p>To quickly produce the weight diagnostics, the <tt>MAIC</tt> package includes the function <tt>wt_diagnostics</tt> which brings together the three functions:</p>
<ul>
<li><tt>ESS</tt></li>
<li><tt>weight_summ</tt></li>
<li><tt>wts_profile</tt></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co"># Function to produce a set of diagnostics.</span>
<span class="co"># Calls each of the diagnostic functions above except for plotting histograms</span>
<span class="va">diagnostics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wt_diagnostics.html">wt_diagnostics</a></span><span class="op">(</span><span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span>, vars <span class="op">=</span> <span class="va">match_cov</span><span class="op">)</span>

<span class="va">diagnostics</span><span class="op">$</span><span class="va">ESS</span>
<span class="co">#&gt; [1] 157.0715</span>

<span class="va">diagnostics</span><span class="op">$</span><span class="va">Summary_of_weights</span>
<span class="co">#&gt;               type      mean       sd     median          min      max</span>
<span class="co">#&gt; 1          Weights 0.3763805 0.556692 0.03467630 1.855194e-11 2.373310</span>
<span class="co">#&gt; 2 Rescaled weights 1.0000000 1.479067 0.09213098 4.929037e-11 6.305614</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">diagnostics</span><span class="op">$</span><span class="va">Weight_profiles</span><span class="op">)</span>
<span class="co">#&gt;   AGE SEX SMOKE ECOG0           wt        wt_rs</span>
<span class="co">#&gt; 1  45   1     0     0 1.301506e+00 3.457953e+00</span>
<span class="co">#&gt; 2  71   1     0     0 7.024764e-08 1.866400e-07</span>
<span class="co">#&gt; 3  58   1     1     1 6.384284e-02 1.696231e-01</span>
<span class="co">#&gt; 4  48   0     0     1 1.204094e+00 3.199141e+00</span>
<span class="co">#&gt; 5  69   1     0     1 1.371621e-06 3.644239e-06</span>
<span class="co">#&gt; 6  47   1     1     0 1.010290e+00 2.684226e+00</span></pre></div>
</div>
</div>
<div id="has-the-optimization-worked" class="section level3">
<h3 class="hasAnchor">
<a href="#has-the-optimization-worked" class="anchor"></a>Has the optimization worked?</h3>
<p>The following code checks whether the re-weighted baseline characteristics for the intervention-treated patients match those aggregate characteristics from the comparator trial and outputs a summary that can be used for reporting.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="co"># Create an object to hold the output</span>
<span class="va">baseline_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'Intervention'</span> <span class="op">=</span> <span class="cn">NA</span>, 
                         <span class="st">'Intervention_weighted'</span> <span class="op">=</span> <span class="cn">NA</span>, 
                         <span class="st">'Comparator'</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>

<span class="co"># Summarise matching variables for weighted intervention data</span>
<span class="va">baseline_summary</span><span class="op">$</span><span class="va">Intervention_weighted</span> <span class="op">&lt;-</span> <span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="va">AGE</span>, <span class="va">SEX</span>, <span class="va">SMOKE</span>, <span class="va">ECOG0</span>, <span class="va">wt</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_at</a></span><span class="op">(</span><span class="va">match_cov</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">wt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Summarise matching variables for unweighted intervention data</span>
<span class="va">baseline_summary</span><span class="op">$</span><span class="va">Intervention</span> <span class="op">&lt;-</span> <span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="va">AGE</span>, <span class="va">SEX</span>, <span class="va">SMOKE</span>, <span class="va">ECOG0</span>, <span class="va">wt</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_at</a></span><span class="op">(</span><span class="va">match_cov</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># baseline data for the comparator study</span>
<span class="va">baseline_summary</span><span class="op">$</span><span class="va">Comparator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="va">target_pop_standard</span>, <span class="va">AGE</span>, <span class="va">SEX</span>, <span class="va">SMOKE</span>, <span class="va">ECOG0</span><span class="op">)</span>

<span class="co"># Combine the three summaries</span>
<span class="co"># Takes a list of data frames and binds these together</span>
<span class="va">trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">baseline_summary</span><span class="op">)</span>

<span class="va">baseline_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">baseline_summary</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">transmute_all</a></span><span class="op">(</span><span class="va">sprintf</span>, fmt <span class="op">=</span> <span class="st">"%.2f"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#apply rounding for presentation</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>ARM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span>, <span class="va">AGE</span>, <span class="va">SEX</span>, <span class="va">SMOKE</span>, <span class="va">ECOG0</span><span class="op">)</span>

<span class="co"># Insert N of intervention  as number of patients</span>
<span class="va">baseline_summary</span><span class="op">$</span><span class="va">`N/ESS`</span><span class="op">[</span><span class="va">baseline_summary</span><span class="op">$</span><span class="va">ARM</span> <span class="op">==</span> <span class="st">"Intervention"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span><span class="op">)</span>

<span class="co"># Insert N for comparator from target_pop_standard</span>
<span class="va">baseline_summary</span><span class="op">$</span><span class="va">`N/ESS`</span><span class="op">[</span><span class="va">baseline_summary</span><span class="op">$</span><span class="va">ARM</span> <span class="op">==</span> <span class="st">"Comparator"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">target_pop_standard</span><span class="op">$</span><span class="va">N</span>

<span class="co"># Insert the ESS as the sample size for the weighted data</span>
<span class="co"># This is calculated above but can also be obtained using the estimate_ess function as shown below</span>
<span class="va">baseline_summary</span><span class="op">$</span><span class="va">`N/ESS`</span><span class="op">[</span><span class="va">baseline_summary</span><span class="op">$</span><span class="va">ARM</span> <span class="op">==</span> <span class="st">"Intervention_weighted"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/estimate_ess.html">estimate_ess</a></span><span class="op">(</span>wt_col <span class="op">=</span> <span class="st">'wt'</span><span class="op">)</span>

<span class="va">baseline_summary</span> <span class="op">&lt;-</span> <span class="va">baseline_summary</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="va">ARM</span>, `N/ESS`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">`N/ESS`</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">AGE</span>, <span class="va">SEX</span>, <span class="va">SMOKE</span>, <span class="va">ECOG0</span><span class="op">)</span>
<span class="va">baseline_summary</span>
<span class="co">#&gt;                     ARM N/ESS   AGE  SEX SMOKE ECOG0</span>
<span class="co">#&gt; 1          Intervention 500.0 59.85 0.38  0.32  0.41</span>
<span class="co">#&gt; 2 Intervention_weighted 157.1 50.06 0.49  0.19  0.35</span>
<span class="co">#&gt; 3            Comparator 300.0 50.06 0.49  0.19  0.35</span></pre></div>
</div>
</div>
</div>
<div id="incorporation-of-the-weights-in-statistical-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#incorporation-of-the-weights-in-statistical-analysis" class="anchor"></a>Incorporation of the weights in statistical analysis</h1>
<div id="comp" class="section level2">
<h2 class="hasAnchor">
<a href="#comp" class="anchor"></a>Comparator pseudo data</h2>
<p>Individual patient data was not available for the comparator study, therefore, pseudo individual patient data is required for these analyses to derive the relative treatment effects. These patients are given a weight of 1 for use in the weighted analysis.</p>
<p>Pseudo overall survival data was obtained for the comparator treatment by digitizing a reported overall survival Kaplan-Meier graph using the methodology of Guyot et al.<span class="citation">[4]</span> It is common for binary endpoints to be reported as a percentage of patients with the event and therefore the example code below simulates pseudo-data for objective response based on the total number of patients and the proportion of responders.</p>
<p>The comparator data will include pseudo individual patient data from two different endpoints and it should be highlighted that there is no 1:1 relationship between endpoints for a given patient since these are reconstructed data and not actual observed data.</p>
<p>Naming of variables in the comparator data should be consistent with those used in the intervention IPD.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="co">#### Comparator pseudo data</span>

<span class="co"># Read in digitised pseudo survival data, col names must match intervention_input</span>
<span class="va">comparator_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"psuedo_IPD.csv"</span>,
                                        package <span class="op">=</span> <span class="st">"MAIC"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Time<span class="op">=</span><span class="va">Time</span>, Event<span class="op">=</span><span class="va">Event</span><span class="op">)</span>


<span class="co"># Simulate response data based on the known proportion of responders</span>
<span class="va">comparator_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">comparator_surv</span><span class="op">)</span> <span class="co"># total number of patients in the comparator data</span>
<span class="va">comparator_prop_events</span> <span class="op">&lt;-</span> <span class="fl">0.4</span> <span class="co"># proportion of responders</span>
<span class="co"># Calculate number with event</span>
<span class="co"># Use round() to ensure we end up with a whole number of people</span>
<span class="co"># number without an event = Total N - number with event to ensure we keep the same number of patients</span>
<span class="va">n_with_event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">comparator_n</span><span class="op">*</span><span class="va">comparator_prop_events</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">comparator_binary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"response"</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n_with_event</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">comparator_n</span> <span class="op">-</span> <span class="va">n_with_event</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Join survival and response comparator data</span>
<span class="co"># (note the rows do not represent observations from a particular patient)</span>
<span class="va">comparator_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">comparator_surv</span>, <span class="va">comparator_binary</span><span class="op">)</span> <span class="op">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>wt<span class="op">=</span><span class="fl">1</span>, wt_rs<span class="op">=</span><span class="fl">1</span>, ARM<span class="op">=</span><span class="st">"Comparator"</span><span class="op">)</span> <span class="co"># All patients have weight = 1</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">comparator_input</span><span class="op">)</span>
<span class="co">#&gt;         Time Event response wt wt_rs        ARM</span>
<span class="co">#&gt; 1 20.2311676     1        1  1     1 Comparator</span>
<span class="co">#&gt; 2 28.7679537     1        1  1     1 Comparator</span>
<span class="co">#&gt; 3 41.0662129     0        1  1     1 Comparator</span>
<span class="co">#&gt; 4  0.8492261     1        1  1     1 Comparator</span>
<span class="co">#&gt; 5  9.0521882     0        1  1     1 Comparator</span>
<span class="co">#&gt; 6  3.4450075     1        1  1     1 Comparator</span>


<span class="co"># Join comparator data with the intervention data</span>
<span class="co"># Set factor levels to ensure "Comparator" is the reference treatment</span>
<span class="va">combined_data</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span>, <span class="va">comparator_input</span><span class="op">)</span>
<span class="va">combined_data</span><span class="op">$</span><span class="va">ARM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">combined_data</span><span class="op">$</span><span class="va">ARM</span><span class="op">)</span>, ref<span class="op">=</span><span class="st">"Comparator"</span><span class="op">)</span></pre></div>
</div>
<div id="estimating-the-relative-effect" class="section level2">
<h2 class="hasAnchor">
<a href="#estimating-the-relative-effect" class="anchor"></a>Estimating the relative effect</h2>
<p>Using the weights (not the rescaled weights) derived above, relative effects can be estimated using:</p>
<ul>
<li>
<tt>coxph</tt> for time to event endpoints via the use of the <tt>weights</tt> statement to estimate a weighted HR from a Cox proportional hazards model</li>
<li>
<tt>glm</tt> for binary endpoints via the use of the <tt>weight</tt> statement to estimate a weighted OR from logistic regression</li>
</ul>
<p>It is important to report the weighted relative effect with the unweighted relative effect to understand how the weighting has affected the analysis.</p>
<div id="bootstrapping-a-confidence-interval" class="section level3">
<h3 class="hasAnchor">
<a href="#bootstrapping-a-confidence-interval" class="anchor"></a>Bootstrapping a confidence interval</h3>
<p>The use of weights induces a within-subject correlation in outcomes, as observations can have weights that are unequal to one another <span class="citation">[5,6]</span>. As such, it is necessary to use a variance estimator to take into account the lack of independence of observations. The two common approaches to this are robust variance estimation and bootstrapping. A simulation study was conducted by Austin et al  to examine the different methods in the context of an inverse probability of treatment weighting (IPTW) survival analysis. The author concluded that the use of a bootstrap estimator resulted in approximately correct estimates of standard errors and confidence intervals with the correct coverage rate. The other estimators resulted in biased estimates of standard errors and confidence intervals with incorrect coverage rates. The use of a bootstrap type estimator is also intuitively appealing, a robust estimator assumes that the weights are known and not subject to any sampling uncertainty. However, a bootstrap estimator allows for quantification of the uncertainty in the estimation of the weights.</p>
<p>Bootstrapping involves:</p>
<ol style="list-style-type: decimal">
<li>Sampling, with replacement, from the patients in the intervention arm (a bootstrap sample)</li>
<li>Estimating a set of weights for each of these bootstrapped data sets and</li>
<li>Estimating a hazard ratio (HR)/odds ratio (OR) using each set of estimated weights.</li>
</ol>
<p>This procedure is repeated multiple times to obtain a distribution of HRs/ORs. For this example, bootstrap estimates of the HRs/ORs were calculated using the <tt>boot</tt> package. An argument for the <tt>boot</tt> function is <tt>statistic</tt> which is a function which when applied to data returns a vector containing the statistic(s) of interest. The <tt>bootstrap_HR</tt> and <tt>bootstrap_OR</tt> in the <tt>MAIC</tt> package can be used for this purpose.</p>
<p>Two different methods for estimating a 95% confidence interval (CI) from the bootstrap samples were explored:<span class="citation">[7–9]</span></p>
<ul>
<li>Percentile CIs
<ul>
<li>This method takes the 2.5th and 97.5th percentiles and can be implemented using the <tt>type=“perc”</tt> statement in the <tt>boot.ci</tt> function</li>
</ul>
</li>
<li>Bias-corrected and accelerated (BCa) CIs
<ul>
<li>This method attempts to correct for any bias and skewness in the distribution of bootstrap estimates and can be implemented using <tt>type=“bca”</tt> statement in the <tt>boot.ci</tt> function)</li>
<li>The BCa method also takes percentiles but they are not necessarily the 2.5th and 97.5th percentiles (the choice of percentiles depends on an acceleration parameter [estimated through jackknife re-sampling] and a bias correction factor [proportion of bootstrap estimates less than the original estimator])</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="example-for-survival-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-for-survival-data" class="anchor"></a>Example for survival data</h2>
<div id="kaplan-meier-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#kaplan-meier-plot" class="anchor"></a>Kaplan-Meier plot</h3>
<p>To visualize the effect of the weighting compared to the unadjusted data, it is useful to plot a Kaplan-Meier. The figure below shows there is a clear treatment benefit of the intervention compared to the comparator. The treatment effect increases once the data is weighted. This treatment effect is quantified in the next section.</p>
<p>To note, the number of patients at the start of the Kaplan-Meier plot in the weighted population is equivalent to the sum of the weights. This will be different to the ESS.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="co"># Unweighted intervention data</span>
<span class="va">KM_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> ,
                  data <span class="op">=</span> <span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span>,
                  type<span class="op">=</span><span class="st">"kaplan-meier"</span><span class="op">)</span>
<span class="co"># Weighted intervention data</span>
<span class="va">KM_int_wtd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> ,
                  data <span class="op">=</span> <span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span>,
                  weights <span class="op">=</span> <span class="va">wt</span>,
                  type<span class="op">=</span><span class="st">"kaplan-meier"</span><span class="op">)</span>
<span class="co"># Comparator data</span>
<span class="va">KM_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> ,
                  data <span class="op">=</span> <span class="va">comparator_input</span>,
                  type<span class="op">=</span><span class="st">"kaplan-meier"</span><span class="op">)</span>

<span class="co"># Combine the survfit objects ready for ggsurvplot</span>
<span class="va">KM_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Intervention <span class="op">=</span> <span class="va">KM_int</span>,
                Intervention_weighted <span class="op">=</span> <span class="va">KM_int_wtd</span>,
                Comparator <span class="op">=</span> <span class="va">KM_comp</span><span class="op">)</span>

<span class="co">#Produce the Kaplan-Meier plot</span>
<span class="va">KM_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span><span class="op">(</span><span class="va">KM_list</span>,
                      combine <span class="op">=</span> <span class="cn">TRUE</span>,
                      risk.table<span class="op">=</span><span class="cn">TRUE</span>, <span class="co"># numbers at risk displayed on the plot</span>
                      break.x.by<span class="op">=</span><span class="fl">50</span>,
                      xlab<span class="op">=</span><span class="st">"Time (days)"</span>,
                      censor<span class="op">=</span><span class="cn">FALSE</span>,
                      legend.title <span class="op">=</span> <span class="st">"Treatment"</span>,
                      title <span class="op">=</span> <span class="st">"Kaplan-Meier plot of overall survival"</span>,
                      legend.labs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Intervention"</span>, <span class="st">"Intervention weighted"</span>, <span class="st">"Comparator"</span><span class="op">)</span>,
                      font.legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
                      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">KM_plot</span></pre></div>
<p><img src="MAIC_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</div>
<div id="estimating-the-hazard-ratio-hr" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-the-hazard-ratio-hr" class="anchor"></a>Estimating the hazard ratio (HR)</h3>
<p>In this example, the weighted HR 0.29 (95% CI: 0.21, 0.40) shows a larger treatment effect (HR further from 1) than the unweighted HR 0.38 (95% CI: 0.30, 0.46). The median of the bootstrap HR samples is the same as the HR from the weighted Cox model to two decimal places (HR is 0.29). In this example, the percentile CI (0.22, 0.37) and BCa confidence interval (0.22, 0.37) are identical to two decimal places suggesting the bootstrap samples are relatively normally distributed (see <a href="#bshr">diagnostics</a>). Finally, it should be noted that results are relatively consistent across all methods, the intervention treatment significantly reduces the hazard of death compared with the comparator treatment.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="co">## Calculate HRs</span>

<span class="co"># Fit a Cox model without weights to estimate the unweighted HR</span>
<span class="va">unweighted_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="va">ARM</span>, data <span class="op">=</span> <span class="va">combined_data</span><span class="op">)</span>

<span class="va">HR_CI_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">unweighted_cox</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="st">"HR"</span> <span class="op">=</span> <span class="va">`exp(coef)`</span>, <span class="st">"HR_low_CI"</span> <span class="op">=</span> <span class="va">`lower .95`</span>, <span class="st">"HR_upp_CI"</span> <span class="op">=</span> <span class="va">`upper .95`</span><span class="op">)</span>

<span class="va">HR_CI_cox</span>
<span class="co">#&gt;                        HR HR_low_CI HR_upp_CI</span>
<span class="co">#&gt; ARMIntervention 0.3748981  0.303901 0.4624815</span>

<span class="co"># Fit a Cox model with weights to estimate the weighted HR</span>
<span class="va">weighted_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="va">ARM</span>, data <span class="op">=</span> <span class="va">combined_data</span>, weights <span class="op">=</span> <span class="va">wt</span><span class="op">)</span>

<span class="va">HR_CI_cox_wtd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">weighted_cox</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="st">"HR"</span> <span class="op">=</span> <span class="va">`exp(coef)`</span>, <span class="st">"HR_low_CI"</span> <span class="op">=</span> <span class="va">`lower .95`</span>, <span class="st">"HR_upp_CI"</span> <span class="op">=</span> <span class="va">`upper .95`</span><span class="op">)</span>

<span class="va">HR_CI_cox_wtd</span>
<span class="co">#&gt;                        HR HR_low_CI HR_upp_CI</span>
<span class="co">#&gt; ARMIntervention 0.2864753 0.2072051 0.3960718</span>

<span class="co">## Bootstrapping</span>

<span class="co"># Bootstrap 1000 HRs</span>
<span class="va">HR_bootstraps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.html">boot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span>, <span class="co"># intervention data</span>
                      statistic <span class="op">=</span> <span class="va">bootstrap_HR</span>, <span class="co"># bootstrap the HR (defined in the MAIC package)</span>
                      R<span class="op">=</span><span class="fl">1000</span>, <span class="co"># number of bootstrap samples</span>
                      comparator_data <span class="op">=</span> <span class="va">comparator_input</span>, <span class="co"># comparator pseudo data</span>
                      matching <span class="op">=</span> <span class="va">est_weights</span><span class="op">$</span><span class="va">matching_vars</span>, <span class="co"># matching variables</span>
                      model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">Event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="va">ARM</span> <span class="co"># model to fit</span>
                      <span class="op">)</span>

<span class="co"># Median of the bootstrap samples</span>
<span class="va">HR_median</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">HR_bootstraps</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>

<span class="co"># Bootstrap CI - Percentile CI</span>
<span class="va">boot_ci_HR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.ci.html">boot.ci</a></span><span class="op">(</span>boot.out <span class="op">=</span> <span class="va">HR_bootstraps</span>, index<span class="op">=</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"perc"</span><span class="op">)</span>

<span class="co"># Bootstrap CI - BCa CI</span>
<span class="va">boot_ci_HR_BCA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.ci.html">boot.ci</a></span><span class="op">(</span>boot.out <span class="op">=</span> <span class="va">HR_bootstraps</span>, index<span class="op">=</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"bca"</span><span class="op">)</span>

<span class="co">## Summary</span>

<span class="co"># Produce a summary of HRs and CIs</span>
<span class="va">HR_summ</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">HR_CI_cox</span>, <span class="va">HR_CI_cox_wtd</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># Unweighted and weighted HRs and CIs from Cox models</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HR (95% CI) from unadjusted Cox model"</span>,
                    <span class="st">"HR (95% CI) from weighted Cox model"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>

  <span class="co"># Median bootstrapped HR and 95% percentile CI</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"HR"</span> <span class="op">=</span> <span class="va">HR_median</span>,
                   <span class="st">"HR_low_CI"</span> <span class="op">=</span> <span class="va">boot_ci_HR</span><span class="op">$</span><span class="va">percent</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,
                   <span class="st">"HR_upp_CI"</span> <span class="op">=</span> <span class="va">boot_ci_HR</span><span class="op">$</span><span class="va">percent</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,
                   <span class="st">"Method"</span><span class="op">=</span><span class="st">"Bootstrap median HR (95% percentile CI)"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>

  <span class="co"># Median bootstrapped HR and 95% bias-corrected and accelerated bootstrap CI</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"HR"</span> <span class="op">=</span> <span class="va">HR_median</span>,
                   <span class="st">"HR_low_CI"</span> <span class="op">=</span> <span class="va">boot_ci_HR_BCA</span><span class="op">$</span><span class="va">bca</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,
                   <span class="st">"HR_upp_CI"</span> <span class="op">=</span> <span class="va">boot_ci_HR_BCA</span><span class="op">$</span><span class="va">bca</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,
                   <span class="st">"Method"</span><span class="op">=</span><span class="st">"Bootstrap median HR (95% BCa CI)"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">#apply rounding for numeric columns</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_if</a></span><span class="op">(</span>.predicate <span class="op">=</span> <span class="va">is.numeric</span>, <span class="va">sprintf</span>, fmt <span class="op">=</span> <span class="st">"%.3f"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">#format for output</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="va">Method</span>, HR_95_CI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">HR</span>, <span class="st">" ("</span>, <span class="va">HR_low_CI</span>, <span class="st">" to "</span>, <span class="va">HR_upp_CI</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># turns the results to a table suitable for word/ powerpoint</span>
<span class="va">HR_table</span> <span class="op">&lt;-</span> <span class="va">HR_summ</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">regulartable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#make it a flextable object</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_header_labels.html">set_header_labels</a></span><span class="op">(</span>Method <span class="op">=</span> <span class="st">"Method"</span>,  HR_95_CI <span class="op">=</span> <span class="st">"Hazard ratio (95% CI)"</span><span class="op">)</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/font.html">font</a></span><span class="op">(</span>font <span class="op">=</span> <span class="st">'Arial'</span>, part <span class="op">=</span> <span class="st">'all'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/fontsize.html">fontsize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, part <span class="op">=</span> <span class="st">'all'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bold.html">bold</a></span><span class="op">(</span>part <span class="op">=</span> <span class="st">'header'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/align.html">align</a></span><span class="op">(</span>align <span class="op">=</span> <span class="st">'center'</span>, part <span class="op">=</span> <span class="st">'all'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/align.html">align</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fl">1</span>, align <span class="op">=</span> <span class="st">'left'</span>, part <span class="op">=</span> <span class="st">'all'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_outer.html">border_outer</a></span><span class="op">(</span>border <span class="op">=</span> <span class="fu"><a href="https://davidgohel.github.io/officer/reference/fp_border.html">fp_border</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_inner_h.html">border_inner_h</a></span><span class="op">(</span>border <span class="op">=</span> <span class="fu"><a href="https://davidgohel.github.io/officer/reference/fp_border.html">fp_border</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_inner_v.html">border_inner_v</a></span><span class="op">(</span>border <span class="op">=</span> <span class="fu"><a href="https://davidgohel.github.io/officer/reference/fp_border.html">fp_border</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span>add_w <span class="op">=</span> <span class="fl">0.2</span>, add_h <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">HR_table</span></pre></div>
<div class="tabwid">
<style>.cl-8253e81c{font-family:'Arial';font-size:14px;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;}.cl-8253e858{font-family:'Arial';font-size:14px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;}.cl-82540838{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;line-height: 1.00;background-color:transparent;}.cl-82540860{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;line-height: 1.00;background-color:transparent;}.cl-82544bae{width:285px;background-color:transparent;vertical-align: middle;border-bottom: 1.00px solid rgba(0, 0, 0, 1.00);border-top: 1.00px solid rgba(0, 0, 0, 1.00);border-left: 1.00px solid rgba(0, 0, 0, 1.00);border-right: 1.00px solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-82544bd6{width:168px;background-color:transparent;vertical-align: middle;border-bottom: 1.00px solid rgba(0, 0, 0, 1.00);border-top: 1.00px solid rgba(0, 0, 0, 1.00);border-left: 1.00px solid rgba(0, 0, 0, 1.00);border-right: 1.00px solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table class="table">
<thead><tr style="overflow-wrap:break-word;">
<td class="cl-82544bae"><p class="cl-82540838"><span class="cl-8253e81c">Method</span></p></td>
<td class="cl-82544bd6"><p class="cl-82540860"><span class="cl-8253e81c">Hazard ratio (95% CI)</span></p></td>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-82544bae"><p class="cl-82540838"><span class="cl-8253e858">HR (95% CI) from unadjusted Cox model</span></p></td>
<td class="cl-82544bd6"><p class="cl-82540860"><span class="cl-8253e858">0.375 (0.304 to 0.462)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-82544bae"><p class="cl-82540838"><span class="cl-8253e858">HR (95% CI) from weighted Cox model</span></p></td>
<td class="cl-82544bd6"><p class="cl-82540860"><span class="cl-8253e858">0.286 (0.207 to 0.396)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-82544bae"><p class="cl-82540838"><span class="cl-8253e858">Bootstrap median HR (95% percentile CI)</span></p></td>
<td class="cl-82544bd6"><p class="cl-82540860"><span class="cl-8253e858">0.289 (0.218 to 0.369)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-82544bae"><p class="cl-82540838"><span class="cl-8253e858">Bootstrap median HR (95% BCa CI)</span></p></td>
<td class="cl-82544bd6"><p class="cl-82540860"><span class="cl-8253e858">0.289 (0.215 to 0.367)</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="bshr" class="section level3">
<h3 class="hasAnchor">
<a href="#bshr" class="anchor"></a>Bootstrapping diagnostics</h3>
<p>To test the distribution of the bootstrapped HRs, a histogram can be plotted. If the plot does not appear normally distributed, this may suggest that the BCa approach is more appropriate than the percentile approach.</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="co"># Summarize bootstrap estimates in a histogram</span>
<span class="co"># Vertical lines indicate the median and upper and lower CIs</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">HR_bootstraps</span><span class="op">$</span><span class="va">t</span>, main <span class="op">=</span> <span class="st">""</span>, xlab <span class="op">=</span> <span class="st">"Boostrapped HR"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">HR_bootstraps</span><span class="op">$</span><span class="va">t</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></pre></div>
<p><img src="MAIC_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
</div>
</div>
<div id="example-for-response-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-for-response-data" class="anchor"></a>Example for response data</h2>
<div id="estimating-the-odds-ratio-or" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-the-odds-ratio-or" class="anchor"></a>Estimating the odds ratio (OR)</h3>
<p>In this example, the weighted OR 3.79 (95% CI: 2.56, 5.60) shows a smaller treatment effect (closer to 1) than the unweighted OR 5.32 (95% CI: 3.89, 7.28) indicating a smaller difference between treatments. The median of the bootstrap OR samples was similar to the OR from the weighted logistic regression model to two decimal places. The median OR from the bootstrap samples was 3.78 compared with the OR of 3.79 from the weighted logistic regression model. For this endpoint, the percentile CI (2.69 to 5.44) and BCa confidence interval (2.67, 5.40) are similar, suggesting the bootstrap samples are relatively normally distributed (see <a href="#bsor">diagnostics</a>). Finally, it should be noted that results are relatively consistent across all methods, the intervention treatment significantly increases the odds of response compared with the comparator treatment.</p>
<p>When deriving the weighted OR using the GLM, the warnings have been suppressed, since the function expects integer values for response (i.e. 1 or 0) however, when the weights function is used, the response values are no longer a integer value.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="co">## Calculate ORs</span>

<span class="co"># Fit a logistic regression model without weights to estimate the unweighted OR</span>
<span class="va">unweighted_OR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">response</span><span class="op">~</span><span class="va">ARM</span>,
                     family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,
                     data <span class="op">=</span> <span class="va">combined_data</span><span class="op">)</span>

<span class="co"># Log odds ratio</span>
<span class="va">log_OR_CI_logit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">unweighted_OR</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint.default</a></span><span class="op">(</span><span class="va">unweighted_OR</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>

<span class="co"># Odds ratio</span>
<span class="va">OR_CI_logit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">log_OR_CI_logit</span><span class="op">)</span>
<span class="co">#tidy up naming</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">OR_CI_logit</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OR"</span>, <span class="st">"OR_low_CI"</span>, <span class="st">"OR_upp_CI"</span><span class="op">)</span>

<span class="co"># Fit a logistic regression model with weights to estimate the weighted OR</span>
<span class="va">weighted_OR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">response</span><span class="op">~</span><span class="va">ARM</span>,
                                    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,
                                    data <span class="op">=</span> <span class="va">combined_data</span>,
                                    weight <span class="op">=</span> <span class="va">wt</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Weighted log odds ratio</span>
<span class="va">log_OR_CI_logit_wtd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">weighted_OR</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint.default</a></span><span class="op">(</span><span class="va">weighted_OR</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>

<span class="co"># Weighted odds ratio</span>
<span class="va">OR_CI_logit_wtd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">log_OR_CI_logit_wtd</span><span class="op">)</span>
<span class="co">#tidy up naming</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">OR_CI_logit_wtd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OR"</span>, <span class="st">"OR_low_CI"</span>, <span class="st">"OR_upp_CI"</span><span class="op">)</span>

<span class="va">OR_CI_logit_wtd</span>
<span class="co">#&gt;        OR OR_low_CI OR_upp_CI </span>
<span class="co">#&gt;  3.786515  2.558141  5.604732</span>

<span class="co">## Bootstrapping</span>

<span class="co"># Bootstrap 1000 ORs</span>
<span class="va">OR_bootstraps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.html">boot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">est_weights</span><span class="op">$</span><span class="va">analysis_data</span>, <span class="co"># intervention data</span>
                      statistic <span class="op">=</span> <span class="va">bootstrap_OR</span>, <span class="co"># bootstrap the OR</span>
                      R <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># number of bootstrap samples</span>
                      comparator_data <span class="op">=</span> <span class="va">comparator_input</span>, <span class="co"># comparator pseudo data</span>
                      matching <span class="op">=</span> <span class="va">est_weights</span><span class="op">$</span><span class="va">matching_vars</span>, <span class="co"># matching variables</span>
                      model <span class="op">=</span> <span class="st">'response ~ ARM'</span> <span class="co"># model to fit</span>
                      <span class="op">)</span>


<span class="co"># Median of the bootstrap samples</span>
<span class="va">OR_median</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">OR_bootstraps</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>

<span class="co"># Bootstrap CI - Percentile CI</span>
<span class="va">boot_ci_OR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.ci.html">boot.ci</a></span><span class="op">(</span>boot.out <span class="op">=</span> <span class="va">OR_bootstraps</span>, index<span class="op">=</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"perc"</span><span class="op">)</span>

<span class="co"># Bootstrap CI - BCa CI</span>
<span class="va">boot_ci_OR_BCA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.ci.html">boot.ci</a></span><span class="op">(</span>boot.out <span class="op">=</span> <span class="va">OR_bootstraps</span>, index<span class="op">=</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"bca"</span><span class="op">)</span>


<span class="co">## Summary</span>

<span class="co"># Produce summary of ORs and CIs</span>
<span class="va">OR_summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">OR_CI_logit</span>, <span class="va">OR_CI_logit_wtd</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># Unweighted and weighted ORs and CIs</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OR (95% CI) from unadjusted logistic regression model"</span>,
                    <span class="st">"OR (95% CI) from weighted logistic regression model"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>

  <span class="co"># Median bootstrapped HR and 95% percentile CI</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"OR"</span> <span class="op">=</span> <span class="va">OR_median</span>,
                   <span class="st">"OR_low_CI"</span> <span class="op">=</span> <span class="va">boot_ci_OR</span><span class="op">$</span><span class="va">percent</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,
                   <span class="st">"OR_upp_CI"</span> <span class="op">=</span> <span class="va">boot_ci_OR</span><span class="op">$</span><span class="va">percent</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,
                   <span class="st">"Method"</span><span class="op">=</span><span class="st">"Bootstrap median HR (95% percentile CI)"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>

  <span class="co"># Median bootstrapped HR and 95% bias-corrected and accelerated bootstrap CI</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"OR"</span> <span class="op">=</span> <span class="va">OR_median</span>,
                   <span class="st">"OR_low_CI"</span> <span class="op">=</span> <span class="va">boot_ci_OR_BCA</span><span class="op">$</span><span class="va">bca</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,
                   <span class="st">"OR_upp_CI"</span> <span class="op">=</span> <span class="va">boot_ci_OR_BCA</span><span class="op">$</span><span class="va">bca</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,
                   <span class="st">"Method"</span><span class="op">=</span><span class="st">"Bootstrap median HR (95% BCa CI)"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">#apply rounding for numeric columns</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_if</a></span><span class="op">(</span>.predicate <span class="op">=</span> <span class="va">is.numeric</span>, <span class="va">sprintf</span>, fmt <span class="op">=</span> <span class="st">"%.3f"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">#format for output</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span><span class="va">Method</span>, OR_95_CI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">OR</span>, <span class="st">" ("</span>, <span class="va">OR_low_CI</span>, <span class="st">" to "</span>, <span class="va">OR_upp_CI</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># turns the results to a table suitable for word/ powerpoint</span>
<span class="va">OR_table</span> <span class="op">&lt;-</span> <span class="va">OR_summ</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">regulartable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#make it a flextable object</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_header_labels.html">set_header_labels</a></span><span class="op">(</span>Method <span class="op">=</span> <span class="st">"Method"</span>,  OR_95_CI <span class="op">=</span> <span class="st">"Odds ratio (95% CI)"</span><span class="op">)</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/font.html">font</a></span><span class="op">(</span>font <span class="op">=</span> <span class="st">'Arial'</span>, part <span class="op">=</span> <span class="st">'all'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/fontsize.html">fontsize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, part <span class="op">=</span> <span class="st">'all'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/bold.html">bold</a></span><span class="op">(</span>part <span class="op">=</span> <span class="st">'header'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/align.html">align</a></span><span class="op">(</span>align <span class="op">=</span> <span class="st">'center'</span>, part <span class="op">=</span> <span class="st">'all'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/align.html">align</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fl">1</span>, align <span class="op">=</span> <span class="st">'left'</span>, part <span class="op">=</span> <span class="st">'all'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_outer.html">border_outer</a></span><span class="op">(</span>border <span class="op">=</span> <span class="fu"><a href="https://davidgohel.github.io/officer/reference/fp_border.html">fp_border</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_inner_h.html">border_inner_h</a></span><span class="op">(</span>border <span class="op">=</span> <span class="fu"><a href="https://davidgohel.github.io/officer/reference/fp_border.html">fp_border</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/border_inner_v.html">border_inner_v</a></span><span class="op">(</span>border <span class="op">=</span> <span class="fu"><a href="https://davidgohel.github.io/officer/reference/fp_border.html">fp_border</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span>add_w <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">OR_table</span></pre></div>
<div class="tabwid">
<style>.cl-8c695a26{font-family:'Arial';font-size:14px;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;}.cl-8c695a4e{font-family:'Arial';font-size:14px;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 17, 17, 1.00);background-color:transparent;}.cl-8c69724a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;line-height: 1.00;background-color:transparent;}.cl-8c697268{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2px;padding-top:2px;padding-left:5px;padding-right:5px;line-height: 1.00;background-color:transparent;}.cl-8c69abc0{width:166px;background-color:transparent;vertical-align: middle;border-bottom: 1.00px solid rgba(0, 0, 0, 1.00);border-top: 1.00px solid rgba(0, 0, 0, 1.00);border-left: 1.00px solid rgba(0, 0, 0, 1.00);border-right: 1.00px solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8c69abde{width:370px;background-color:transparent;vertical-align: middle;border-bottom: 1.00px solid rgba(0, 0, 0, 1.00);border-top: 1.00px solid rgba(0, 0, 0, 1.00);border-left: 1.00px solid rgba(0, 0, 0, 1.00);border-right: 1.00px solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table class="table">
<thead><tr style="overflow-wrap:break-word;">
<td class="cl-8c69abde"><p class="cl-8c69724a"><span class="cl-8c695a26">Method</span></p></td>
<td class="cl-8c69abc0"><p class="cl-8c697268"><span class="cl-8c695a26">Odds ratio (95% CI)</span></p></td>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-8c69abde"><p class="cl-8c69724a"><span class="cl-8c695a4e">OR (95% CI) from unadjusted logistic regression model</span></p></td>
<td class="cl-8c69abc0"><p class="cl-8c697268"><span class="cl-8c695a4e">5.318 (3.888 to 7.275)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-8c69abde"><p class="cl-8c69724a"><span class="cl-8c695a4e">OR (95% CI) from weighted logistic regression model</span></p></td>
<td class="cl-8c69abc0"><p class="cl-8c697268"><span class="cl-8c695a4e">3.787 (2.558 to 5.605)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-8c69abde"><p class="cl-8c69724a"><span class="cl-8c695a4e">Bootstrap median HR (95% percentile CI)</span></p></td>
<td class="cl-8c69abc0"><p class="cl-8c697268"><span class="cl-8c695a4e">3.784 (2.693 to 5.448)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-8c69abde"><p class="cl-8c69724a"><span class="cl-8c695a4e">Bootstrap median HR (95% BCa CI)</span></p></td>
<td class="cl-8c69abc0"><p class="cl-8c697268"><span class="cl-8c695a4e">3.784 (2.669 to 5.402)</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="bsor" class="section level3">
<h3 class="hasAnchor">
<a href="#bsor" class="anchor"></a>Bootstrapping diagnostics</h3>
<p>To test the distribution of the bootstrapped ORs, a histogram can be plotted. If the plot does not appear normally distributed, this may suggest that the BCa approach is more appropriate than the percentile approach.</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="co"># Summarize bootstrap estimates in a histogram</span>
<span class="co"># Vertical lines indicate the median and upper and lower CIs</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">OR_bootstraps</span><span class="op">$</span><span class="va">t</span>, main <span class="op">=</span> <span class="st">""</span>, xlab <span class="op">=</span> <span class="st">"Boostrapped OR"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">OR_bootstraps</span><span class="op">$</span><span class="va">t</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></pre></div>
<p><img src="MAIC_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-signorovitch2012">
<p>[1] Signorovitch JE, Sikirica V, Erder MH, Xie J, Lu M, Hodgkins PS, et al. Matching-adjusted indirect comparisons: A new tool for timely comparative effectiveness research. Value in Health 2012;15:940–7.</p>
</div>
<div id="ref-phillippo2016a">
<p>[2] Phillippo D, Ades T, Dias S, Palmer S, Abrams KR, Welton N. NICE dsu technical support document 18: Methods for population-adjusted indirect comparisons in submissions to nice 2016.</p>
</div>
<div id="ref-phillippo2019population">
<p>[3] Phillippo DM, Dias S, Elsada A, Ades A, Welton NJ. Population adjustment methods for indirect comparisons: A review of national institute for health and care excellence technology appraisals. International Journal of Technology Assessment in Health Care 2019;35:221–8.</p>
</div>
<div id="ref-guyot2012">
<p>[4] Guyot P, Ades A, Ouwens MJ, Welton NJ. Enhanced secondary analysis of survival data: Reconstructing the data from published kaplan-meier survival curves. BMC Medical Research Methodology 2012;12:9.</p>
</div>
<div id="ref-austin2016variance">
<p>[5] Austin PC. Variance estimation when using inverse probability of treatment weighting (iptw) with survival analysis. Statistics in Medicine 2016;35:5642–55.</p>
</div>
<div id="ref-therneau2015adjusted">
<p>[6] Therneau TM, Crowson CS, Atkinson EJ. Adjusted survival curves. 2015.</p>
</div>
<div id="ref-efron1994">
<p>[7] Efron B, Tibshirani RJ. An introduction to the bootstrap. CRC press; 1994.</p>
</div>
<div id="ref-diciccio1996">
<p>[8] DiCiccio TJ, Efron B. Bootstrap confidence intervals. Statistical Science 1996:189–212.</p>
</div>
<div id="ref-efron1987">
<p>[9] Efron B. Better bootstrap confidence intervals. Journal of the American Statistical Association 1987;82:171–85.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Iain Bennett, Jo Gregory, Sarah Smith, Richard Birnie.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
