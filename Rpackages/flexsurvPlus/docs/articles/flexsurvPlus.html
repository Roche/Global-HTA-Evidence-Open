<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting parametric survival curves using the <tt>flexsurvPlus</tt> package • flexsurvPlus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fitting parametric survival curves using the &lt;tt&gt;flexsurvPlus&lt;/tt&gt; package">
<meta property="og:description" content="flexsurvPlus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flexsurvPlus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/flexsurvPlus.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fitting parametric survival curves using the <tt>flexsurvPlus</tt> package</h1>
                        <h4 class="author">Roche</h4>
            
            <h4 class="date">2020-10-06</h4>
      
      
      <div class="hidden name"><code>flexsurvPlus.Rmd</code></div>

    </div>

    
    
<style type="text/css">

body{ /* Normal  */
      font-size: 14px;
  }
td {  /* Table  */
  font-size: 10px;
}
h1.title {
  font-size: 38px;
}
h1 { /* Header 1 */
  font-size: 28px;
  }
h2 { /* Header 2 */
    font-size: 22px;
}
h3 { /* Header 3 */
  font-size: 18px;
}
code.r{ /* Code block */
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
</style>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This document follows the guidance by NICE (<span class="citation">[1]</span>) to fit parametric survival models to be used in an economic model.</p>
</div>
<div id="set-up-packages-and-data" class="section level1">
<h1 class="hasAnchor">
<a href="#set-up-packages-and-data" class="anchor"></a>Set up packages and data</h1>
<div id="install-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#install-packages" class="anchor"></a>Install packages</h2>
<p>The following packages are required to run this example:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">flexsurvPlus</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">survival</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">survminer</span>)
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="co">#&gt; Loading required package: ggpubr</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)

<span class="no">BM.blue</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">69</span>, <span class="fl">185</span>, <span class="fl">209</span>, <span class="kw">max</span><span class="kw">=</span><span class="fl">255</span>)
<span class="no">BM.red</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">225</span>, <span class="fl">55</span>, <span class="fl">60</span>, <span class="kw">max</span><span class="kw">=</span><span class="fl">255</span>)
<span class="no">BM.yellow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">238</span>, <span class="fl">224</span>, <span class="fl">30</span>, <span class="kw">max</span><span class="kw">=</span><span class="fl">255</span>)
<span class="no">BM.pink</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">211</span>,<span class="fl">78</span>,<span class="fl">147</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">255</span>)
<span class="no">BM.Dblue</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">0</span>,<span class="fl">45</span>,<span class="fl">92</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">255</span>)
<span class="no">BM.Dyellow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">214</span>, <span class="fl">200</span>, <span class="fl">16</span>, <span class="kw">max</span><span class="kw">=</span><span class="fl">255</span>)
<span class="no">BM.green</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>)
<span class="no">BM.Dyellow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">214</span>, <span class="fl">200</span>, <span class="fl">16</span>, <span class="kw">max</span><span class="kw">=</span><span class="fl">255</span>)
<span class="no">BM.black</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">255</span>)
<span class="no">BM.grey1</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">30</span>)
<span class="no">BM.grey2</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">30</span>)
<span class="no">BM.grey3</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">20</span>,<span class="fl">20</span>,<span class="fl">20</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">30</span>)
<span class="no">BM.grey3_dup</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">19</span>,<span class="fl">20</span>,<span class="fl">20</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">30</span>)
<span class="no">BM.lightPink</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">229</span>,<span class="fl">151</span>,<span class="fl">192</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">255</span>)
<span class="no">BM.orange</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">247</span>,<span class="fl">139</span>,<span class="fl">21</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">255</span>)
<span class="no">Nike.blue</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">51</span>,<span class="fl">51</span>,<span class="fl">255</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">255</span>)</pre></body></html></div>
</div>
<div id="read-in-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#read-in-the-data" class="anchor"></a>Read in the data</h2>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co">#### Intervention data</span>

<span class="co"># Read in ADaM data and rename variables of interest</span>

<span class="no">adtte</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"adtte.csv"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"flexsurvPlus"</span>, <span class="kw">mustWork</span> <span class="kw">=</span> <span class="fl">TRUE</span>))

<span class="co">#adtte &lt;- read.csv(file="G:/Clients/Roche/2797 Development of R Code for MAIC and mixture cure models/Project/4 Survival package/3 Build package/Simulate data/adtte.csv")</span>

<span class="co"># subset OS data and rename</span>
<span class="no">OS_data</span> <span class="kw">&lt;-</span> <span class="no">adtte</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">PARAMCD</span><span class="kw">==</span><span class="st">"OS"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">ARM</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">ARM</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">OS_days</span> <span class="kw">=</span> <span class="no">AVAL</span>,
         <span class="kw">OS_event</span> <span class="kw">=</span> <span class="no">EVNT</span>,
         <span class="kw">OS_cens</span> <span class="kw">=</span> <span class="no">CNSR</span>
            ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">PARAMCD</span>, -<span class="no">PARAM</span>)

<span class="co"># subset PFS data and rename</span>
<span class="no">PFS_data</span> <span class="kw">&lt;-</span> <span class="no">adtte</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">PARAMCD</span><span class="kw">==</span><span class="st">"PFS"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">PFS_days</span> <span class="kw">=</span> <span class="no">AVAL</span>,
         <span class="kw">PFS_event</span> <span class="kw">=</span> <span class="no">EVNT</span>,
         <span class="kw">PFS_cens</span> <span class="kw">=</span> <span class="no">CNSR</span>
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">PARAMCD</span>, -<span class="no">PARAM</span>)

<span class="no">analysis_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">OS_data</span>, <span class="no">PFS_data</span>)
<span class="co">#&gt; Joining, by = c("USUBJID", "ARM", "AVALU")</span>
<span class="no">analysis_data</span>$<span class="no">ARM</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">analysis_data</span>$<span class="no">ARM</span>), <span class="kw">ref</span><span class="kw">=</span><span class="st">"B"</span>)</pre></body></html></div>
</div>
</div>
<div id="exploratory-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#exploratory-analysis" class="anchor"></a>Exploratory analysis</h1>
<p>Before performing any statististical analysis, it is important to explore the data.</p>
<p>In this section, the following exploratory analysis is performed:</p>
<ul>
<li>Plot KM of data</li>
<li>…</li>
</ul>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">#### center baseline characteristics</span>
<span class="co"># (subtract the aggregate comparator data from the corresponding column of intervention PLD)</span>
<span class="no">km.est.OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">OS_days</span>, <span class="no">OS_event</span>) ~ <span class="no">ARM</span> , <span class="kw">data</span> <span class="kw">=</span> <span class="no">analysis_data</span>, <span class="kw">conf.type</span> <span class="kw">=</span> <span class="st">'plain'</span>)
<span class="no">km.est.PFS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">PFS_days</span>, <span class="no">PFS_event</span>) ~ <span class="no">ARM</span> , <span class="kw">data</span> <span class="kw">=</span> <span class="no">analysis_data</span>, <span class="kw">conf.type</span> <span class="kw">=</span> <span class="st">'plain'</span>)

<span class="no">KM_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">OS</span> <span class="kw">=</span> <span class="no">km.est.OS</span>, <span class="kw">PFS</span> <span class="kw">=</span> <span class="no">km.est.PFS</span>)

<span class="no">KM_plot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span>(<span class="no">KM_list</span>, <span class="kw">combine</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">risk.table</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">analysis_data</span>,
           <span class="kw">break.time.by</span> <span class="kw">=</span> <span class="fl">100</span>,
           <span class="kw">conf.int</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
           <span class="kw">censor</span><span class="kw">=</span><span class="fl">FALSE</span>,
           <span class="kw">legend.title</span> <span class="kw">=</span> <span class="st">''</span>,
           <span class="kw">xlab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Time (Days)'</span>),
           <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.72</span>,
           <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">600</span>))
<span class="no">KM_plot</span></pre></body></html></div>
<p><img src="flexsurvPlus_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
</div>
<div id="fitting-the-models" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-the-models" class="anchor"></a>Fitting the models</h1>
<p>The <tt>fit_models</tt> function in the <tt>SURV</tt> package will fit parametric survival models for multiple distributions using the flexsurv package. The <tt>get_params</tt> function manipulates the objects from <tt>fit_models</tt> to get the parameter estimates and AIC and BIC value. The <tt>runPSM</tt> function combines the two previous functions and manipulates the parameters so that they can be used in the survival curve estimation in excel.</p>
<p>These functions have been used to estimate 3 types of model:</p>
<ul>
<li>Treatment-effect models (TEM) with a common shape parameter for both treatments</li>
<li>Independent shape models with different shape parameters for each treatment</li>
<li>Separate models for each treatment - 2 models in total</li>
</ul>
<p>The of fit_models and get_params is shown to illustrate the underlying functionality for additional flexibility. Using runPSM with appropriate metadata is the primary way that a user would specify a particular analysis.</p>
<div id="fit-treatment-effect-models-tem" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-treatment-effect-models-tem" class="anchor"></a>Fit treatment-effect models (TEM)</h2>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">#Fit the models for seven standard distributions</span>
<span class="no">models_TEM_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit_models.html">fit_models</a></span>(<span class="kw">model.formula</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">OS_days</span>, <span class="no">OS_event</span>) ~ <span class="no">ARM</span>,
                            <span class="kw">data</span><span class="kw">=</span><span class="no">analysis_data</span>,
                            <span class="kw">distr</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'exp'</span>, <span class="st">'weibull'</span>, <span class="st">'gompertz'</span>, <span class="st">'lnorm'</span>, <span class="st">'llogis'</span>, <span class="st">'gengamma'</span>, <span class="st">'gamma'</span>))
<span class="no">models_TEM_OS</span>
<span class="co">#&gt; $exp</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;       data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; rate        NA   0.002849  0.002472  0.003285  0.000207        NA        NA</span>
<span class="co">#&gt; ARMA  0.375000   1.133741  0.934198  1.333284  0.101810  3.107259  2.545171</span>
<span class="co">#&gt;       U95%    </span>
<span class="co">#&gt; rate        NA</span>
<span class="co">#&gt; ARMA  3.793481</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.999, df = 2</span>
<span class="co">#&gt; AIC = 4855.998</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $weibull</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; shape        NA     0.9894    0.9145    1.0705    0.0397        NA        NA</span>
<span class="co">#&gt; scale        NA   353.1438  303.6234  410.7410   27.2227        NA        NA</span>
<span class="co">#&gt; ARMA     0.3750    -1.1399   -1.3467   -0.9331    0.1055    0.3199    0.2601</span>
<span class="co">#&gt;        U95%    </span>
<span class="co">#&gt; shape        NA</span>
<span class="co">#&gt; scale        NA</span>
<span class="co">#&gt; ARMA     0.3933</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.964, df = 3</span>
<span class="co">#&gt; AIC = 4857.928</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $gompertz</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        data mean  est        L95%       U95%       se         exp(est) </span>
<span class="co">#&gt; shape         NA  -0.000213  -0.001295   0.000869   0.000552         NA</span>
<span class="co">#&gt; rate          NA   0.002923   0.002411   0.003544   0.000287         NA</span>
<span class="co">#&gt; ARMA    0.375000   1.124274   0.918752   1.329796   0.104860   3.077982</span>
<span class="co">#&gt;        L95%       U95%     </span>
<span class="co">#&gt; shape         NA         NA</span>
<span class="co">#&gt; rate          NA         NA</span>
<span class="co">#&gt; ARMA    2.506160   3.780274</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.926, df = 3</span>
<span class="co">#&gt; AIC = 4857.851</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $lnorm</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;          data mean  est      L95%     U95%     se       exp(est)  L95%   </span>
<span class="co">#&gt; meanlog       NA     5.4852   5.3068   5.6636   0.0910       NA        NA</span>
<span class="co">#&gt; sdlog         NA     1.5274   1.4209   1.6419   0.0563       NA        NA</span>
<span class="co">#&gt; ARMA      0.3750    -1.2088  -1.4614  -0.9562   0.1289   0.2985    0.2319</span>
<span class="co">#&gt;          U95%   </span>
<span class="co">#&gt; meanlog       NA</span>
<span class="co">#&gt; sdlog         NA</span>
<span class="co">#&gt; ARMA      0.3843</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2450.702, df = 3</span>
<span class="co">#&gt; AIC = 4907.404</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $llogis</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; shape        NA     1.2408    1.1428    1.3471    0.0521        NA        NA</span>
<span class="co">#&gt; scale        NA   237.2853  202.7508  277.7020   19.0419        NA        NA</span>
<span class="co">#&gt; ARMA     0.3750    -1.1882   -1.4147   -0.9617    0.1156    0.3048    0.2430</span>
<span class="co">#&gt;        U95%    </span>
<span class="co">#&gt; shape        NA</span>
<span class="co">#&gt; scale        NA</span>
<span class="co">#&gt; ARMA     0.3822</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2432.545, df = 3</span>
<span class="co">#&gt; AIC = 4871.089</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $gengamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        data mean  est      L95%     U95%     se       exp(est)  L95%   </span>
<span class="co">#&gt; mu          NA     5.8404   5.6625   6.0184   0.0908       NA        NA</span>
<span class="co">#&gt; sigma       NA     1.0439   0.9108   1.1965   0.0726       NA        NA</span>
<span class="co">#&gt; Q           NA     0.9212   0.6508   1.1917   0.1380       NA        NA</span>
<span class="co">#&gt; ARMA    0.3750    -1.1500  -1.3618  -0.9381   0.1081   0.3166    0.2562</span>
<span class="co">#&gt;        U95%   </span>
<span class="co">#&gt; mu          NA</span>
<span class="co">#&gt; sigma       NA</span>
<span class="co">#&gt; Q           NA</span>
<span class="co">#&gt; ARMA    0.3914</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.806, df = 4</span>
<span class="co">#&gt; AIC = 4859.612</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $gamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; shape        NA   0.991716  0.889305  1.105920  0.055151        NA        NA</span>
<span class="co">#&gt; rate         NA   0.002812  0.002248  0.003518  0.000321        NA        NA</span>
<span class="co">#&gt; ARMA   0.375000   1.136564  0.932578  1.340550  0.104076  3.116043  2.541052</span>
<span class="co">#&gt;        U95%    </span>
<span class="co">#&gt; shape        NA</span>
<span class="co">#&gt; rate         NA</span>
<span class="co">#&gt; ARMA   3.821144</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.988, df = 3</span>
<span class="co">#&gt; AIC = 4857.976</span>

<span class="co">#get parameter estimates and model fit statistics</span>
<span class="no">params_TEM_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_params.html">get_params</a></span>(<span class="kw">models</span><span class="kw">=</span><span class="no">models_TEM_OS</span>)
<span class="no">params_TEM_OS</span>
<span class="co">#&gt; # A tibble: 7 x 5</span>
<span class="co">#&gt;   name     value      coef           AIC   BIC</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;     &lt;named list&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 exp      &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    4856. 4865.</span>
<span class="co">#&gt; 2 weibull  &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4858. 4872.</span>
<span class="co">#&gt; 3 gompertz &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4858. 4872.</span>
<span class="co">#&gt; 4 lnorm    &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4907. 4921.</span>
<span class="co">#&gt; 5 llogis   &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4871. 4885.</span>
<span class="co">#&gt; 6 gengamma &lt;flxsrvrg&gt; &lt;dbl [4]&gt;    4860. 4878.</span>
<span class="co">#&gt; 7 gamma    &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4858. 4872.</span>

<span class="co"># Meta data needed for labelling purposes</span>
<span class="no">parout_TEM_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">Study_name</span> <span class="kw">=</span> <span class="st">"Study ABC"</span>,
  <span class="kw">Treatment</span> <span class="kw">=</span> <span class="st">"All"</span>,
  <span class="kw">Datacut</span> <span class="kw">=</span> <span class="st">"Final"</span>,
  <span class="kw">Population</span> <span class="kw">=</span> <span class="st">"ITT"</span>,
  <span class="kw">Endpoint</span> <span class="kw">=</span> <span class="st">"OS"</span>,
  <span class="kw">Endpoint_def</span> <span class="kw">=</span> <span class="st">"NA"</span>,
  <span class="kw">Model</span> <span class="kw">=</span> <span class="st">"Common shape - Treatment"</span>,
  <span class="kw">SampleID</span> <span class="kw">=</span> <span class="st">"Mean estimate"</span>)

<span class="no">psm_TEM_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runPSM.html">runPSM</a></span>(<span class="kw">model.formula</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">OS_days</span>, <span class="no">OS_event</span>) ~ <span class="no">ARM</span>,
                               <span class="kw">data</span> <span class="kw">=</span> <span class="no">analysis_data</span>,
                               <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">parout_TEM_OS</span>,
                               <span class="kw">dist</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'exp'</span>, <span class="st">'weibull'</span>, <span class="st">'gompertz'</span>, <span class="st">'lnorm'</span>, <span class="st">'llogis'</span>, <span class="st">'gengamma'</span>, <span class="st">'gamma'</span>),
                               <span class="kw">model.type</span> <span class="kw">=</span> <span class="st">'Common shape'</span>,
                               <span class="kw">toi_name</span><span class="kw">=</span><span class="st">"A"</span>,
                               <span class="kw">ref_name</span><span class="kw">=</span><span class="st">"B"</span>)
<span class="no">psm_TEM_OS</span>
<span class="co">#&gt; $models</span>
<span class="co">#&gt; $models$exp</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;       data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; rate        NA   0.002849  0.002472  0.003285  0.000207        NA        NA</span>
<span class="co">#&gt; ARMA  0.375000   1.133741  0.934198  1.333284  0.101810  3.107259  2.545171</span>
<span class="co">#&gt;       U95%    </span>
<span class="co">#&gt; rate        NA</span>
<span class="co">#&gt; ARMA  3.793481</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.999, df = 2</span>
<span class="co">#&gt; AIC = 4855.998</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$weibull</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; shape        NA     0.9894    0.9145    1.0705    0.0397        NA        NA</span>
<span class="co">#&gt; scale        NA   353.1438  303.6234  410.7410   27.2227        NA        NA</span>
<span class="co">#&gt; ARMA     0.3750    -1.1399   -1.3467   -0.9331    0.1055    0.3199    0.2601</span>
<span class="co">#&gt;        U95%    </span>
<span class="co">#&gt; shape        NA</span>
<span class="co">#&gt; scale        NA</span>
<span class="co">#&gt; ARMA     0.3933</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.964, df = 3</span>
<span class="co">#&gt; AIC = 4857.928</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$gompertz</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        data mean  est        L95%       U95%       se         exp(est) </span>
<span class="co">#&gt; shape         NA  -0.000213  -0.001295   0.000869   0.000552         NA</span>
<span class="co">#&gt; rate          NA   0.002923   0.002411   0.003544   0.000287         NA</span>
<span class="co">#&gt; ARMA    0.375000   1.124274   0.918752   1.329796   0.104860   3.077982</span>
<span class="co">#&gt;        L95%       U95%     </span>
<span class="co">#&gt; shape         NA         NA</span>
<span class="co">#&gt; rate          NA         NA</span>
<span class="co">#&gt; ARMA    2.506160   3.780274</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.926, df = 3</span>
<span class="co">#&gt; AIC = 4857.851</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$lnorm</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;          data mean  est      L95%     U95%     se       exp(est)  L95%   </span>
<span class="co">#&gt; meanlog       NA     5.4852   5.3068   5.6636   0.0910       NA        NA</span>
<span class="co">#&gt; sdlog         NA     1.5274   1.4209   1.6419   0.0563       NA        NA</span>
<span class="co">#&gt; ARMA      0.3750    -1.2088  -1.4614  -0.9562   0.1289   0.2985    0.2319</span>
<span class="co">#&gt;          U95%   </span>
<span class="co">#&gt; meanlog       NA</span>
<span class="co">#&gt; sdlog         NA</span>
<span class="co">#&gt; ARMA      0.3843</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2450.702, df = 3</span>
<span class="co">#&gt; AIC = 4907.404</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$llogis</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; shape        NA     1.2408    1.1428    1.3471    0.0521        NA        NA</span>
<span class="co">#&gt; scale        NA   237.2853  202.7508  277.7020   19.0419        NA        NA</span>
<span class="co">#&gt; ARMA     0.3750    -1.1882   -1.4147   -0.9617    0.1156    0.3048    0.2430</span>
<span class="co">#&gt;        U95%    </span>
<span class="co">#&gt; shape        NA</span>
<span class="co">#&gt; scale        NA</span>
<span class="co">#&gt; ARMA     0.3822</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2432.545, df = 3</span>
<span class="co">#&gt; AIC = 4871.089</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$gengamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        data mean  est      L95%     U95%     se       exp(est)  L95%   </span>
<span class="co">#&gt; mu          NA     5.8404   5.6625   6.0184   0.0908       NA        NA</span>
<span class="co">#&gt; sigma       NA     1.0439   0.9108   1.1965   0.0726       NA        NA</span>
<span class="co">#&gt; Q           NA     0.9212   0.6508   1.1917   0.1380       NA        NA</span>
<span class="co">#&gt; ARMA    0.3750    -1.1500  -1.3618  -0.9381   0.1081   0.3166    0.2562</span>
<span class="co">#&gt;        U95%   </span>
<span class="co">#&gt; mu          NA</span>
<span class="co">#&gt; sigma       NA</span>
<span class="co">#&gt; Q           NA</span>
<span class="co">#&gt; ARMA    0.3914</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.806, df = 4</span>
<span class="co">#&gt; AIC = 4859.612</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $models$gamma</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; flexsurv::flexsurvreg(formula = model.formula, data = data, dist = dist)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates: </span>
<span class="co">#&gt;        data mean  est       L95%      U95%      se        exp(est)  L95%    </span>
<span class="co">#&gt; shape        NA   0.991716  0.889305  1.105920  0.055151        NA        NA</span>
<span class="co">#&gt; rate         NA   0.002812  0.002248  0.003518  0.000321        NA        NA</span>
<span class="co">#&gt; ARMA   0.375000   1.136564  0.932578  1.340550  0.104076  3.116043  2.541052</span>
<span class="co">#&gt;        U95%    </span>
<span class="co">#&gt; shape        NA</span>
<span class="co">#&gt; rate         NA</span>
<span class="co">#&gt; ARMA   3.821144</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; N = 800,  Events: 386,  Censored: 414</span>
<span class="co">#&gt; Total time at risk: 88818.65</span>
<span class="co">#&gt; Log-likelihood = -2425.988, df = 3</span>
<span class="co">#&gt; AIC = 4857.976</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $model_summary</span>
<span class="co">#&gt; # A tibble: 7 x 5</span>
<span class="co">#&gt;   name     value      coef           AIC   BIC</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;list&gt;     &lt;named list&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 exp      &lt;flxsrvrg&gt; &lt;dbl [2]&gt;    4856. 4865.</span>
<span class="co">#&gt; 2 weibull  &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4858. 4872.</span>
<span class="co">#&gt; 3 gompertz &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4858. 4872.</span>
<span class="co">#&gt; 4 lnorm    &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4907. 4921.</span>
<span class="co">#&gt; 5 llogis   &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4871. 4885.</span>
<span class="co">#&gt; 6 gengamma &lt;flxsrvrg&gt; &lt;dbl [4]&gt;    4860. 4878.</span>
<span class="co">#&gt; 7 gamma    &lt;flxsrvrg&gt; &lt;dbl [3]&gt;    4858. 4872.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $parameters</span>
<span class="co">#&gt;   Study_name Treatment Datacut Population Endpoint Endpoint_def</span>
<span class="co">#&gt; 1  Study ABC       All   Final        ITT       OS           NA</span>
<span class="co">#&gt;                      Model      SampleID exp.rate.A exp.rate.B exp.rate.TE</span>
<span class="co">#&gt; 1 Common shape - Treatment Mean estimate  -4.726913  -5.860654    1.133741</span>
<span class="co">#&gt;   weibull.scale.A weibull.scale.B weibull.shape.A weibull.shape.B</span>
<span class="co">#&gt; 1        4.727001        5.866875      -0.0106083      -0.0106083</span>
<span class="co">#&gt;   weibull.scale.TE gompertz.rate.A gompertz.rate.B gompertz.shape.A</span>
<span class="co">#&gt; 1        -1.139875       -4.710777       -5.835051    -0.0002127812</span>
<span class="co">#&gt;   gompertz.shape.B gompertz.rate.TE lnorm.meanlog.A lnorm.meanlog.B</span>
<span class="co">#&gt; 1    -0.0002127812         1.124274        4.276408         5.48523</span>
<span class="co">#&gt;   lnorm.sdlog.A lnorm.sdlog.B lnorm.meanlog.TE llogis.scale.A llogis.scale.B</span>
<span class="co">#&gt; 1     0.4235878     0.4235878        -1.208822       4.281024       5.469263</span>
<span class="co">#&gt;   llogis.shape.A llogis.shape.B llogis.scale.TE gengamma.mu.A gengamma.mu.B</span>
<span class="co">#&gt; 1      0.2157325      0.2157325       -1.188239      4.690469      5.840432</span>
<span class="co">#&gt;   gengamma.sigma.A gengamma.sigma.B gengamma.Q.A gengamma.Q.B gengamma.mu.TE</span>
<span class="co">#&gt; 1       0.04296199       0.04296199    0.9212455    0.9212455      -1.149962</span>
<span class="co">#&gt;   gamma.rate.A gamma.rate.B gamma.shape.A gamma.shape.B gamma.rate.TE</span>
<span class="co">#&gt; 1    -4.737217    -5.873781   -0.00831878   -0.00831878      1.136564</span></pre></body></html></div>
</div>
<div id="seperate-models-for-each-treatment" class="section level2">
<h2 class="hasAnchor">
<a href="#seperate-models-for-each-treatment" class="anchor"></a>Seperate models for each treatment</h2>
<p>These models have been fit using the <tt>runPSM</tt> function.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co">#split data set into individual arms</span>
<span class="no">analysis_data_TrtA</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">analysis_data</span>, <span class="no">ARM</span><span class="kw">==</span><span class="st">"A"</span>)
<span class="no">analysis_data_TrtB</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">analysis_data</span>, <span class="no">ARM</span><span class="kw">==</span><span class="st">"B"</span>)

<span class="co"># Fit models to Trt A </span>

<span class="co"># Meta data needed for labelling purposes</span>
<span class="no">parout_TrtA_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">Study_name</span> <span class="kw">=</span> <span class="st">"Study ABC"</span>,
  <span class="kw">Treatment</span> <span class="kw">=</span> <span class="st">"All"</span>,
  <span class="kw">Datacut</span> <span class="kw">=</span> <span class="st">"Final"</span>,
  <span class="kw">Population</span> <span class="kw">=</span> <span class="st">"ITT"</span>,
  <span class="kw">Endpoint</span> <span class="kw">=</span> <span class="st">"OS"</span>,
  <span class="kw">Endpoint_def</span> <span class="kw">=</span> <span class="st">"NA"</span>,
  <span class="kw">Model</span> <span class="kw">=</span> <span class="st">"Independent"</span>,
  <span class="kw">SampleID</span> <span class="kw">=</span> <span class="st">"Mean estimate"</span>)

<span class="no">psm_armA_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runPSM.html">runPSM</a></span>(<span class="kw">model.formula</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">OS_days</span>, <span class="no">OS_event</span>) ~ <span class="fl">1</span>,
                               <span class="kw">data</span> <span class="kw">=</span> <span class="no">analysis_data_TrtA</span>,
                               <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">parout_TrtA_OS</span>,
                               <span class="kw">dist</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'exp'</span>, <span class="st">'weibull'</span>, <span class="st">'gompertz'</span>, <span class="st">'lnorm'</span>, <span class="st">'llogis'</span>, <span class="st">'gengamma'</span>, <span class="st">'gamma'</span>),
                               <span class="kw">model.type</span> <span class="kw">=</span> <span class="st">'Separate'</span>,
                               <span class="kw">toi_name</span><span class="kw">=</span><span class="st">"A"</span>)

<span class="co"># Fit models to Trt B</span>

<span class="co"># Meta data needed for labeling purposes</span>
<span class="no">parout_TrtB_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">Study_name</span> <span class="kw">=</span> <span class="st">"Study ABC"</span>,
  <span class="kw">Treatment</span> <span class="kw">=</span> <span class="st">"All"</span>,
  <span class="kw">Datacut</span> <span class="kw">=</span> <span class="st">"Final"</span>,
  <span class="kw">Population</span> <span class="kw">=</span> <span class="st">"ITT"</span>,
  <span class="kw">Endpoint</span> <span class="kw">=</span> <span class="st">"OS"</span>,
  <span class="kw">Endpoint_def</span> <span class="kw">=</span> <span class="st">"NA"</span>,
  <span class="kw">Model</span> <span class="kw">=</span> <span class="st">"Independent"</span>,
  <span class="kw">SampleID</span> <span class="kw">=</span> <span class="st">"Mean estimate"</span>)

<span class="no">psm_armB_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runPSM.html">runPSM</a></span>(<span class="kw">model.formula</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">OS_days</span>, <span class="no">OS_event</span>) ~ <span class="fl">1</span>,
                               <span class="kw">data</span> <span class="kw">=</span> <span class="no">analysis_data_TrtB</span>,
                               <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">parout_TrtB_OS</span>,
                               <span class="kw">dist</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'exp'</span>, <span class="st">'weibull'</span>, <span class="st">'gompertz'</span>, <span class="st">'lnorm'</span>, <span class="st">'llogis'</span>, <span class="st">'gengamma'</span>, <span class="st">'gamma'</span>),
                               <span class="kw">model.type</span> <span class="kw">=</span> <span class="st">'Separate'</span>,
                               <span class="kw">toi_name</span><span class="kw">=</span><span class="st">"B"</span>)

<span class="co"># Combine the 2 independent models</span>
<span class="no">psm_indep_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span>(<span class="no">psm_armA_OS</span>$<span class="no">parameters</span>, <span class="no">psm_armB_OS</span>$<span class="no">parameters</span>)
<span class="co">#&gt; Joining, by = c("Study_name", "Treatment", "Datacut", "Population", "Endpoint", "Endpoint_def", "Model", "SampleID")</span></pre></body></html></div>
</div>
<div id="independant-shape-models" class="section level2">
<h2 class="hasAnchor">
<a href="#independant-shape-models" class="anchor"></a>Independant shape models</h2>
<p>These models are similar to the separate model for each treatment as they allow all parameters to vary by treatment, however it is performed using 1 model for 2 treatments, rather than 2 models as above. They have been fit using the <tt>runPSM</tt> function.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r">
<span class="co"># Independent shape models ------------------------------------------------</span>
<span class="co">#This only applies for models with 2 or more parameters,i.e. not exponential</span>

<span class="co">#Enter metadata</span>
<span class="no">metadata_OS_ind</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">Study_name</span> <span class="kw">=</span> <span class="st">"Study ABC"</span>,
  <span class="kw">Treatment</span> <span class="kw">=</span> <span class="st">"All"</span>,
  <span class="kw">Datacut</span> <span class="kw">=</span> <span class="st">"Final"</span>,
  <span class="kw">Population</span> <span class="kw">=</span> <span class="st">"ITT"</span>,
  <span class="kw">Endpoint</span> <span class="kw">=</span> <span class="st">"OS"</span>,
  <span class="kw">Endpoint_def</span> <span class="kw">=</span> <span class="st">"NA"</span>,
  <span class="kw">Model</span> <span class="kw">=</span> <span class="st">"Independent shape"</span>,
  <span class="kw">SampleID</span> <span class="kw">=</span> <span class="st">"Mean estimate"</span>
)

<span class="co"># All distributions that have a parameter named shape - weibull, gompertz, llogis, gamma</span>
<span class="no">psm_OS_ind_shape</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runPSM.html">runPSM</a></span>(<span class="kw">model.formula</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">OS_days</span>, <span class="no">OS_event</span>) ~ <span class="no">ARM</span> + <span class="fu">shape</span>(<span class="no">ARM</span>),
                     <span class="kw">data</span><span class="kw">=</span><span class="no">analysis_data</span>,
                     <span class="kw">dist</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'weibull'</span>, <span class="st">'gompertz'</span>, <span class="st">'llogis'</span>,  <span class="st">'gamma'</span>),
                     <span class="kw">model.type</span> <span class="kw">=</span> <span class="st">'Independent shape'</span>,
                     <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">metadata_OS_ind</span>,
                     <span class="kw">toi_name</span><span class="kw">=</span><span class="st">"A"</span>,
                     <span class="kw">ref_name</span><span class="kw">=</span><span class="st">"B"</span>)

<span class="co">#For the log normal distribution the shape parameter is named sdlog which</span>
<span class="co">#requires a different formula</span>
<span class="no">psm_OS_ind_lnorm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runPSM.html">runPSM</a></span>(<span class="kw">model.formula</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">OS_days</span>, <span class="no">OS_event</span>) ~ <span class="no">ARM</span> + <span class="fu">sdlog</span>(<span class="no">ARM</span>),
                           <span class="kw">data</span><span class="kw">=</span><span class="no">analysis_data</span>,
                           <span class="kw">dist</span> <span class="kw">=</span> <span class="st">'lnorm'</span>,
                           <span class="kw">model.type</span> <span class="kw">=</span> <span class="st">'Independent shape'</span>,
                           <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">metadata_OS_ind</span>,
                           <span class="kw">toi_name</span><span class="kw">=</span><span class="st">"A"</span>,
                           <span class="kw">ref_name</span><span class="kw">=</span><span class="st">"B"</span>)

<span class="co">#Generalised gamma model has two shape parameters in the flexsurv</span>
<span class="co">#parameterisation, sigma and Q.</span>
<span class="co">#Allowing both sigma and Q to be different between</span>
<span class="co">#treatment arms is equivalent to fitting separate models to each arm</span>
<span class="co">#Allowing only one of sigma or Q to be different between treatments is possible but hard to interpret</span>
<span class="co">#Not implemented in the underlying functions</span>
<span class="no">psm_OS_ind_gengamma</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runPSM.html">runPSM</a></span>(<span class="kw">model.formula</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">OS_days</span>, <span class="no">OS_event</span>) ~ <span class="no">ARM</span> + <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span>(<span class="no">ARM</span>) + <span class="fu">Q</span>(<span class="no">ARM</span>),
                              <span class="kw">data</span><span class="kw">=</span><span class="no">analysis_data</span>,
                              <span class="kw">dist</span> <span class="kw">=</span> <span class="st">'gengamma'</span>,
                              <span class="kw">model.type</span> <span class="kw">=</span> <span class="st">'Independent shape'</span>,
                              <span class="kw">metadata</span> <span class="kw">=</span> <span class="no">metadata_OS_ind</span>,
                              <span class="kw">toi_name</span><span class="kw">=</span><span class="st">"A"</span>,
                              <span class="kw">ref_name</span><span class="kw">=</span><span class="st">"B"</span>)</pre></body></html></div>
</div>
<div id="output-parameters-to-excel" class="section level2">
<h2 class="hasAnchor">
<a href="#output-parameters-to-excel" class="anchor"></a>Output parameters to excel</h2>
<p>Once all the models have been fit, they can be combined to output to excel such that there is 1 row per model.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r">
<span class="no">parameters_all</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span>(<span class="no">psm_OS_ind_shape</span>$<span class="no">parameters</span>, <span class="no">psm_OS_ind_lnorm</span>$<span class="no">parameters</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span>(<span class="no">psm_OS_ind_gengamma</span>$<span class="no">parameters</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span>(<span class="no">psm_TEM_OS</span>$<span class="no">parameters</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span>(<span class="no">psm_indep_OS</span>) <span class="kw">%&gt;%</span>
  <span class="co">#reorder columns</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">metadata_OS_ind</span>),
         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"exp"</span>), <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"weibull"</span>), <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"gompertz"</span>), <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"lnorm"</span>),
         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"llogis"</span>), <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"gengamma"</span>), <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"gamma"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">Model</span>)
<span class="co">#&gt; Joining, by = c("Study_name", "Treatment", "Datacut", "Population", "Endpoint", "Endpoint_def", "Model", "SampleID")</span>
<span class="co">#&gt; Joining, by = c("Study_name", "Treatment", "Datacut", "Population", "Endpoint", "Endpoint_def", "Model", "SampleID")</span>
<span class="co">#&gt; Joining, by = c("Study_name", "Treatment", "Datacut", "Population", "Endpoint", "Endpoint_def", "Model", "SampleID", "weibull.scale.A", "weibull.scale.B", "weibull.shape.A", "weibull.shape.B", "weibull.scale.TE", "gompertz.rate.A", "gompertz.rate.B", "gompertz.shape.A", "gompertz.shape.B", "gompertz.rate.TE", "llogis.scale.A", "llogis.scale.B", "llogis.shape.A", "llogis.shape.B", "llogis.scale.TE", "gamma.rate.A", "gamma.rate.B", "gamma.shape.A", "gamma.shape.B", "gamma.rate.TE", "lnorm.meanlog.A", "lnorm.meanlog.B", "lnorm.sdlog.A", "lnorm.sdlog.B", "lnorm.meanlog.TE", "gengamma.mu.A", "gengamma.mu.B", "gengamma.sigma.A", "gengamma.sigma.B", "gengamma.Q.A", "gengamma.Q.B", "gengamma.mu.TE")</span>
<span class="co">#&gt; Joining, by = c("Study_name", "Treatment", "Datacut", "Population", "Endpoint", "Endpoint_def", "Model", "SampleID", "weibull.scale.A", "weibull.scale.B", "weibull.shape.A", "weibull.shape.B", "gompertz.rate.A", "gompertz.rate.B", "gompertz.shape.A", "gompertz.shape.B", "llogis.scale.A", "llogis.scale.B", "llogis.shape.A", "llogis.shape.B", "gamma.rate.A", "gamma.rate.B", "gamma.shape.A", "gamma.shape.B", "lnorm.meanlog.A", "lnorm.meanlog.B", "lnorm.sdlog.A", "lnorm.sdlog.B", "gengamma.mu.A", "gengamma.mu.B", "gengamma.sigma.A", "gengamma.sigma.B", "gengamma.Q.A", "gengamma.Q.B", "exp.rate.A", "exp.rate.B")</span>

<span class="co"># block from vignette so compiles</span>
<span class="co"># write.csv(parameters_all, "G:/Clients/Roche/2797 Development of R Code for MAIC and mixture cure models/Project/4 Survival package/3 Build package/SURV/developing R code/params OS.csv")</span></pre></body></html></div>
</div>
</div>
<div id="estimate-survival-from-the-models-and-plot-the-curves" class="section level1">
<h1 class="hasAnchor">
<a href="#estimate-survival-from-the-models-and-plot-the-curves" class="anchor"></a>Estimate survival from the models and plot the curves</h1>
<p>Survival at a given time can be estimated using the <tt>get_curvefits</tt> function as shown below for treatment-effect models.</p>
<p>This can be used to cross check survival in excel models. The example is given below for the treatment-effect models.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># Landmark survival</span>

<span class="no">curvefits_TEM_OS_landmark</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_curvefits.html">get_curvefits</a></span>(<span class="kw">models</span> <span class="kw">=</span> <span class="no">psm_TEM_OS</span>$<span class="no">models</span>,
                                           <span class="kw">time</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">300</span>))
<span class="no">curvefits_df_TEM_OS_landmark</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(<span class="no">curvefits_TEM_OS_landmark</span>$<span class="no">curvefits</span>, <span class="kw">.id</span> <span class="kw">=</span> <span class="st">"Dist"</span>)  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span>(<span class="kw">names_from</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">Dist</span>, <span class="no">ARM</span>), <span class="kw">values_from</span>  <span class="kw">=</span> <span class="no">est</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>()
<span class="no">curvefits_df_TEM_OS_landmark</span>
<span class="co">#&gt;   time     exp_B      exp_A weibull_B  weibull_A gompertz_B gompertz_A</span>
<span class="co">#&gt; 1    0 1.0000000 1.00000000 1.0000000 1.00000000  1.0000000 1.00000000</span>
<span class="co">#&gt; 2  100 0.7520608 0.41255895 0.7505372 0.41212147  0.7488330 0.41054348</span>
<span class="co">#&gt; 3  200 0.5655955 0.17020488 0.5656671 0.17205272  0.5641759 0.17173483</span>
<span class="co">#&gt; 4  300 0.4253622 0.07021955 0.4269982 0.07217507  0.4275954 0.07316887</span>
<span class="co">#&gt;     lnorm_B   lnorm_A  llogis_B  llogis_A gengamma_B gengamma_A   gamma_B</span>
<span class="co">#&gt; 1 1.0000000 1.0000000 1.0000000 1.0000000  1.0000000 1.00000000 1.0000000</span>
<span class="co">#&gt; 2 0.7177497 0.4147906 0.7450039 0.4007861  0.7495611 0.40838244 0.7512597</span>
<span class="co">#&gt; 3 0.5486972 0.2517356 0.5528282 0.2205907  0.5638338 0.17452070 0.5657311</span>
<span class="co">#&gt; 4 0.4431115 0.1750247 0.4277628 0.1461258  0.4265918 0.07692335 0.4262962</span>
<span class="co">#&gt;      gamma_A</span>
<span class="co">#&gt; 1 1.00000000</span>
<span class="co">#&gt; 2 0.41253541</span>
<span class="co">#&gt; 3 0.17111969</span>
<span class="co">#&gt; 4 0.07106512</span></pre></body></html></div>
<p>get_curvefits can also be used to extract estimates of survival probability over time which can be overlaid with the KM curve in R if required.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># Data set for plots</span>
<span class="no">curvefits_TEM_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_curvefits.html">get_curvefits</a></span>(<span class="kw">models</span> <span class="kw">=</span> <span class="no">psm_TEM_OS</span>$<span class="no">models</span>,
                                  <span class="kw">time</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">to</span> <span class="kw">=</span> <span class="fl">500</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">10</span>))
<span class="no">curvefits_df_TEM_OS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(<span class="no">curvefits_TEM_OS</span>$<span class="no">curvefits</span>, <span class="kw">.id</span> <span class="kw">=</span> <span class="st">"Dist"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span>(<span class="kw">names_from</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">ARM</span>), <span class="kw">values_from</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">est</span>))


<span class="no">km.est.OS.TrtA</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">OS_days</span>, <span class="no">OS_event</span>) ~ <span class="fl">1</span> , <span class="kw">data</span> <span class="kw">=</span> <span class="no">analysis_data_TrtA</span>, <span class="kw">conf.type</span> <span class="kw">=</span> <span class="st">'plain'</span>)
<span class="no">km.est.OS.TrtB</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">OS_days</span>, <span class="no">OS_event</span>) ~ <span class="fl">1</span> , <span class="kw">data</span> <span class="kw">=</span> <span class="no">analysis_data_TrtB</span>, <span class="kw">conf.type</span> <span class="kw">=</span> <span class="st">'plain'</span>)

<span class="no">plot.OS.A</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span>(<span class="no">km.est.OS.TrtA</span>,
                   <span class="kw">combine</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                   <span class="kw">censor</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                   <span class="kw">risk.table</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                   <span class="kw">conf.int</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                   <span class="kw">break.x.by</span> <span class="kw">=</span> <span class="fl">100</span>,
                   <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">500</span>),
                   <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Time (days)"</span>,
                   <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.72</span>,
                   <span class="kw">linetype</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>),
                   <span class="kw">title</span>  <span class="kw">=</span>  <span class="st">'Kaplan-Meier of OS with standard distribution overlays'</span>,
                   <span class="kw">legend.title</span> <span class="kw">=</span> <span class="st">''</span>,
                   <span class="kw">legend.labs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"KM"</span>),
                   <span class="kw">surv.median.line</span> <span class="kw">=</span> <span class="st">'hv'</span>,
                   <span class="kw">palette</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">30</span>)),
                   <span class="kw">risk.table.y.text.col</span> <span class="kw">=</span> <span class="no">F</span>
)


<span class="no">plot.OS.A</span>$<span class="no">plot</span> <span class="kw">&lt;-</span> <span class="no">plot.OS.A</span>$<span class="no">plot</span> +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">time</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">A</span>,
                <span class="kw">colour</span> <span class="kw">=</span> <span class="no">Dist</span>,
                <span class="kw">linetype</span> <span class="kw">=</span> <span class="no">Dist</span>),
            <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.72</span>,
            <span class="kw">data</span> <span class="kw">=</span> <span class="no">curvefits_df_TEM_OS</span>) +
  <span class="fu">scale_color_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">BM.blue</span>, <span class="no">BM.pink</span>, <span class="no">BM.Dyellow</span>, <span class="no">BM.orange</span>, <span class="no">BM.grey1</span>, <span class="no">BM.lightPink</span>, <span class="no">BM.red</span>, <span class="no">BM.Dblue</span>))
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span>

<span class="no">plot.OS.A</span></pre></body></html></div>
<p><img src="flexsurvPlus_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="sourceCode" id="cb10"><html><body><pre class="r">
<span class="no">plot.OS.B</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span>(<span class="no">km.est.OS.TrtB</span>,
                        <span class="kw">combine</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                        <span class="kw">censor</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                        <span class="kw">risk.table</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                        <span class="kw">conf.int</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                        <span class="kw">break.x.by</span> <span class="kw">=</span> <span class="fl">100</span>,
                        <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">500</span>),
                        <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Time (days)"</span>,
                        <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.72</span>,
                        <span class="kw">linetype</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>),
                        <span class="kw">title</span>  <span class="kw">=</span>  <span class="st">'Kaplan-Meier of OS with standard distribution overlays'</span>,
                        <span class="kw">legend.title</span> <span class="kw">=</span> <span class="st">''</span>,
                        <span class="kw">legend.labs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"KM"</span>),
                        <span class="kw">surv.median.line</span> <span class="kw">=</span> <span class="st">'hv'</span>,
                        <span class="kw">palette</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="kw">max</span><span class="kw">=</span><span class="fl">30</span>)),
                        <span class="kw">risk.table.y.text.col</span> <span class="kw">=</span> <span class="no">F</span>
)


<span class="no">plot.OS.B</span>$<span class="no">plot</span> <span class="kw">&lt;-</span> <span class="no">plot.OS.B</span>$<span class="no">plot</span> +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">time</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">B</span>,
                <span class="kw">colour</span> <span class="kw">=</span> <span class="no">Dist</span>,
                <span class="kw">linetype</span> <span class="kw">=</span> <span class="no">Dist</span>),
            <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.72</span>,
            <span class="kw">data</span> <span class="kw">=</span> <span class="no">curvefits_df_TEM_OS</span>) +
  <span class="fu">scale_color_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">BM.blue</span>, <span class="no">BM.pink</span>, <span class="no">BM.Dyellow</span>, <span class="no">BM.orange</span>, <span class="no">BM.grey1</span>, <span class="no">BM.lightPink</span>, <span class="no">BM.red</span>, <span class="no">BM.Dblue</span>))
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span>

<span class="no">plot.OS.B</span></pre></body></html></div>
<p><img src="flexsurvPlus_files/figure-html/unnamed-chunk-9-2.png" width="672"></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-latimer2011nice">
<p>[1] Latimer N. NICE dsu technical support document 14: Survival analysis for economic evaluations alongside clinical trials-extrapolation with patient-level data. Sheffield: Report by the Decision Support Unit 2011;2013.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Iain Bennett, Jo Gregory, Sarah Smith, Richard Birnie.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
